"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[7991],{3905:(e,n,t)=>{t.d(n,{Zo:()=>c,kt:()=>k});var a=t(7294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var p=a.createContext({}),u=function(e){var n=a.useContext(p),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},c=function(e){var n=u(e.components);return a.createElement(p.Provider,{value:n},e.children)},s={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},m=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,o=e.originalType,p=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),m=u(t),k=r,d=m["".concat(p,".").concat(k)]||m[k]||s[k]||o;return t?a.createElement(d,i(i({ref:n},c),{},{components:t})):a.createElement(d,i({ref:n},c))}));function k(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var o=t.length,i=new Array(o);i[0]=m;var l={};for(var p in n)hasOwnProperty.call(n,p)&&(l[p]=n[p]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var u=2;u<o;u++)i[u]=t[u];return a.createElement.apply(null,i)}return a.createElement.apply(null,t)}m.displayName="MDXCreateElement"},2799:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>p,contentTitle:()=>i,default:()=>s,frontMatter:()=>o,metadata:()=>l,toc:()=>u});var a=t(7462),r=(t(7294),t(3905));const o={},i="\u9644\u5f55:\u5e76\u53d1\u5e95\u5c42\u539f\u7406",l={unversionedId:"Books/OnJava8/Appendix-Low-Level-Concurrency",id:"Books/OnJava8/Appendix-Low-Level-Concurrency",title:"\u9644\u5f55:\u5e76\u53d1\u5e95\u5c42\u539f\u7406",description:"\u5c3d\u7ba1\u4e0d\u5efa\u8bae\u4f60\u81ea\u5df1\u7f16\u5199\u5e95\u5c42 Java \u5e76\u53d1\u4ee3\u7801\uff0c\u4f46\u662f\u8fd9\u6837\u901a\u5e38\u6709\u52a9\u4e8e\u4e86\u89e3\u5b83\u662f\u5982\u4f55\u5de5\u4f5c\u7684\u3002",source:"@site/docs/Books/OnJava8/Appendix-Low-Level-Concurrency.md",sourceDirName:"Books/OnJava8",slug:"/Books/OnJava8/Appendix-Low-Level-Concurrency",permalink:"/docs/Books/OnJava8/Appendix-Low-Level-Concurrency",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Books/OnJava8/Appendix-Low-Level-Concurrency.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"\u9644\u5f55:\u6587\u6863\u6ce8\u91ca",permalink:"/docs/Books/OnJava8/Appendix-Javadoc"},next:{title:"\u9644\u5f55:\u65b0IO",permalink:"/docs/Books/OnJava8/Appendix-New-IO"}},p={},u=[{value:"\u4ec0\u4e48\u662f\u7ebf\u7a0b\uff1f",id:"\u4ec0\u4e48\u662f\u7ebf\u7a0b",level:2},{value:"\u6700\u4f73\u7ebf\u7a0b\u6570",id:"\u6700\u4f73\u7ebf\u7a0b\u6570",level:3},{value:"\u6211\u53ef\u4ee5\u521b\u5efa\u591a\u5c11\u4e2a\u7ebf\u7a0b\uff1f",id:"\u6211\u53ef\u4ee5\u521b\u5efa\u591a\u5c11\u4e2a\u7ebf\u7a0b",level:3},{value:"The WorkStealingPool (\u5de5\u4f5c\u7a83\u53d6\u7ebf\u7a0b\u6c60)",id:"the-workstealingpool-\u5de5\u4f5c\u7a83\u53d6\u7ebf\u7a0b\u6c60",level:3},{value:"\u5f02\u5e38\u6355\u83b7",id:"\u5f02\u5e38\u6355\u83b7",level:2},{value:"\u8d44\u6e90\u5171\u4eab",id:"\u8d44\u6e90\u5171\u4eab",level:2},{value:"\u8d44\u6e90\u7ade\u4e89",id:"\u8d44\u6e90\u7ade\u4e89",level:3},{value:"\u89e3\u51b3\u8d44\u6e90\u7ade\u4e89",id:"\u89e3\u51b3\u8d44\u6e90\u7ade\u4e89",level:3},{value:"\u540c\u6b65\u63a7\u5236 EventProducer",id:"\u540c\u6b65\u63a7\u5236-eventproducer",level:3},{value:"volatile \u5173\u952e\u5b57",id:"volatile-\u5173\u952e\u5b57",level:2},{value:"\u5b57\u5206\u88c2",id:"\u5b57\u5206\u88c2",level:3},{value:"\u53ef\u89c1\u6027",id:"\u53ef\u89c1\u6027",level:3},{value:"\u91cd\u6392\u4e0e <em>Happen-Before</em> \u539f\u5219",id:"\u91cd\u6392\u4e0e-happen-before-\u539f\u5219",level:3},{value:"\u4ec0\u4e48\u65f6\u5019\u4f7f\u7528 volatile",id:"\u4ec0\u4e48\u65f6\u5019\u4f7f\u7528-volatile",level:3},{value:"\u539f\u5b50\u6027",id:"\u539f\u5b50\u6027",level:2},{value:"Josh \u7684\u5e8f\u5217\u53f7",id:"josh-\u7684\u5e8f\u5217\u53f7",level:3},{value:"\u539f\u5b50\u7c7b",id:"\u539f\u5b50\u7c7b",level:3},{value:"\u4e34\u754c\u533a",id:"\u4e34\u754c\u533a",level:2},{value:"\u5728\u5176\u4ed6\u5bf9\u8c61\u4e0a\u540c\u6b65",id:"\u5728\u5176\u4ed6\u5bf9\u8c61\u4e0a\u540c\u6b65",level:3},{value:"\u4f7f\u7528\u663e\u5f0f\u9501\u5bf9\u8c61",id:"\u4f7f\u7528\u663e\u5f0f\u9501\u5bf9\u8c61",level:3},{value:"\u5e93\u7ec4\u4ef6",id:"\u5e93\u7ec4\u4ef6",level:2},{value:"DelayQueue",id:"delayqueue",level:3},{value:"PriorityBlockingQueue",id:"priorityblockingqueue",level:3},{value:"\u65e0\u9501\u96c6\u5408",id:"\u65e0\u9501\u96c6\u5408",level:3},{value:"\u590d\u5236\u7b56\u7565",id:"\u590d\u5236\u7b56\u7565",level:4},{value:"\u6bd4\u8f83\u5e76\u4ea4\u6362 (CAS)",id:"\u6bd4\u8f83\u5e76\u4ea4\u6362-cas",level:4},{value:"\u672c\u7ae0\u5c0f\u7ed3",id:"\u672c\u7ae0\u5c0f\u7ed3",level:2}],c={toc:u};function s(e){let{components:n,...t}=e;return(0,r.kt)("wrapper",(0,a.Z)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"\u9644\u5f55\u5e76\u53d1\u5e95\u5c42\u539f\u7406"},"\u9644\u5f55:\u5e76\u53d1\u5e95\u5c42\u539f\u7406"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"\u5c3d\u7ba1\u4e0d\u5efa\u8bae\u4f60\u81ea\u5df1\u7f16\u5199\u5e95\u5c42 Java \u5e76\u53d1\u4ee3\u7801\uff0c\u4f46\u662f\u8fd9\u6837\u901a\u5e38\u6709\u52a9\u4e8e\u4e86\u89e3\u5b83\u662f\u5982\u4f55\u5de5\u4f5c\u7684\u3002")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"./Concurrent-Programming"},"\u5e76\u53d1\u7f16\u7a0b")," \u7ae0\u8282\u4e2d\u4ecb\u7ecd\u4e86\u4e00\u4e9b\u7528\u4e8e\u9ad8\u7ea7\u5e76\u53d1\u7684\u6982\u5ff5\uff0c\u5305\u62ec\u4e3a Java \u5e76\u53d1\u7f16\u7a0b\u800c\u6700\u65b0\u63d0\u51fa\u7684\uff0c\u66f4\u5b89\u5168\u7684\u6982\u5ff5\uff08 parallel Streams \u548c CompletableFutures  \uff09\u3002\u672c\u9644\u5f55\u5219\u4ecb\u7ecd\u5728 Java \u4e2d\u5e95\u5c42\u5e76\u53d1\u6982\u5ff5\uff0c\u56e0\u6b64\u5728\u9605\u8bfb\u672c\u7bc7\u65f6\uff0c\u4f60\u80fd\u6709\u6240\u4e86\u89e3\u638c\u63e1\u8fd9\u4e9b\u4ee3\u7801\u3002\u4f60\u8fd8\u4f1a\u5c06\u8fdb\u4e00\u6b65\u4e86\u89e3\u5e76\u53d1\u7684\u666e\u904d\u95ee\u9898\u3002"),(0,r.kt)("p",null,"\u5728 Java \u7684\u65e9\u671f\u7248\u672c\u4e2d, \u5e95\u5c42\u5e76\u53d1\u6982\u5ff5\u662f\u5e76\u53d1\u7f16\u7a0b\u7684\u91cd\u8981\u7ec4\u6210\u90e8\u5206\u3002\u6211\u4eec\u4f1a\u7740\u773c\u4e8e\u56f4\u7ed5\u8fd9\u4e9b\u6280\u5de7\u7684\u590d\u6742\u6027\u4ee5\u53ca\u4e3a\u4f55\u4f60\u5e94\u8be5\u907f\u514d\u5b83\u4eec\u800c\u8c08\u3002 \u201c\u5e76\u53d1\u7f16\u7a0b\u201d \u7ae0\u8282\u5c55\u793a\u6700\u65b0\u7684 Java \u7248\u672c(\u5c24\u5176\u662f Java 8)\u6240\u63d0\u4f9b\u7684\u6539\u8fdb\u6280\u5de7\uff0c\u8fd9\u4e9b\u6280\u5de7\u4f7f\u5f97\u5e76\u53d1\u7684\u4f7f\u7528\uff0c\u5982\u679c\u672c\u6765\u4e0d\u5bb9\u6613\u4f7f\u7528\uff0c\u4e5f\u4f1a\u53d8\u5f97\u66f4\u5bb9\u6613\u4e9b\u3002"),(0,r.kt)("h2",{id:"\u4ec0\u4e48\u662f\u7ebf\u7a0b"},"\u4ec0\u4e48\u662f\u7ebf\u7a0b\uff1f"),(0,r.kt)("p",null,"\u5e76\u53d1\u5c06\u7a0b\u5e8f\u5212\u5206\u6210\u72ec\u7acb\u5206\u79bb\u8fd0\u884c\u7684\u4efb\u52a1\u3002\u6bcf\u4e2a\u4efb\u52a1\u90fd\u7531\u4e00\u4e2a ",(0,r.kt)("em",{parentName:"p"},"\u6267\u884c\u7ebf\u7a0b")," \u6765\u9a71\u52a8\uff0c\u6211\u4eec\u901a\u5e38\u5c06\u5176\u7b80\u79f0\u4e3a ",(0,r.kt)("em",{parentName:"p"},"\u7ebf\u7a0b")," \u3002\u800c\u4e00\u4e2a ",(0,r.kt)("em",{parentName:"p"},"\u7ebf\u7a0b")," \u5c31\u662f\u64cd\u4f5c\u7cfb\u7edf\u8fdb\u7a0b\u4e2d\u5355\u4e00\u987a\u5e8f\u7684\u63a7\u5236\u6d41\u3002\u56e0\u6b64\uff0c\u5355\u4e2a\u8fdb\u7a0b\u53ef\u4ee5\u6709\u591a\u4e2a\u5e76\u53d1\u6267\u884c\u7684\u4efb\u52a1\uff0c\u4f46\u662f\u4f60\u7684\u7a0b\u5e8f\u4f7f\u5f97\u6bcf\u4e2a\u4efb\u52a1\u90fd\u597d\u50cf\u6709\u81ea\u5df1\u7684\u5904\u7406\u5668\u4e00\u6837\u3002\u6b64\u7ebf\u7a0b\u6a21\u578b\u4e3a\u7f16\u7a0b\u5e26\u6765\u4e86\u4fbf\u5229\uff0c\u5b83\u7b80\u5316\u4e86\u5728\u5355\u4e00\u7a0b\u5e8f\u4e2d\u5904\u7406\u53d8\u620f\u6cd5\u822c\u7684\u591a\u4efb\u52a1\u8fc7\u7a0b\u3002\u64cd\u4f5c\u7cfb\u7edf\u5219\u4ece\u5904\u7406\u5668\u4e0a\u5206\u914d\u65f6\u95f4\u7247\u5230\u4f60\u7a0b\u5e8f\u7684\u6240\u6709\u7ebf\u7a0b\u4e2d\u3002"),(0,r.kt)("p",null,"Java \u5e76\u53d1\u7684\u6838\u5fc3\u673a\u5236\u662f ",(0,r.kt)("strong",{parentName:"p"},"Thread")," \u7c7b\uff0c\u5728\u8be5\u8bed\u8a00\u6700\u521d\u7248\u672c\u4e2d\uff0c ",(0,r.kt)("strong",{parentName:"p"},"Thread \uff08\u7ebf\u7a0b\uff09")," \u662f\u7531\u7a0b\u5e8f\u5458\u76f4\u63a5\u521b\u5efa\u548c\u7ba1\u7406\u7684\u3002\u968f\u7740\u8bed\u8a00\u7684\u53d1\u5c55\u4ee5\u53ca\u4eba\u4eec\u53d1\u73b0\u4e86\u66f4\u597d\u7684\u4e00\u4e9b\u65b9\u6cd5\uff0c\u4e2d\u95f4\u5c42\u673a\u5236 - \u7279\u522b\u662f ",(0,r.kt)("strong",{parentName:"p"},"Executor")," \u6846\u67b6  - \u88ab\u6dfb\u52a0\u8fdb\u6765\uff0c\u4ee5\u6d88\u9664\u81ea\u5df1\u7ba1\u7406\u7ebf\u7a0b\u65f6\u5019\u7684\u5fc3\u7406\u8d1f\u62c5\uff08\u53ca\u9519\u8bef\uff09\u3002 \u6700\u7ec8\uff0c\u751a\u81f3\u53d1\u5c55\u51fa\u6bd4 ",(0,r.kt)("strong",{parentName:"p"},"Executor")," \u66f4\u597d\u7684\u673a\u5236\uff0c\u5982 ",(0,r.kt)("a",{parentName:"p",href:"./Concurrent-Programming"},"\u5e76\u53d1\u7f16\u7a0b")," \u4e00\u7ae0\u6240\u793a\u3002"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Thread\uff08\u7ebf\u7a0b\uff09")," \u662f\u5c06\u4efb\u52a1\u5173\u8054\u5230\u5904\u7406\u5668\u7684\u8f6f\u4ef6\u6982\u5ff5\u3002\u867d\u7136\u521b\u5efa\u548c\u4f7f\u7528 ",(0,r.kt)("strong",{parentName:"p"},"Thread"),"  \u7c7b\u770b\u8d77\u6765\u4e0e\u4efb\u4f55\u5176\u4ed6\u7c7b\u90fd\u5f88\u76f8\u4f3c\uff0c\u4f46\u5b9e\u9645\u4e0a\u5b83\u4eec\u662f\u975e\u5e38\u4e0d\u540c\u7684\u3002\u5f53\u4f60\u521b\u5efa\u4e00\u4e2a ",(0,r.kt)("strong",{parentName:"p"},"Thread")," \u65f6\uff0cJVM \u5c06\u5206\u914d\u4e00\u5927\u5757\u5185\u5b58\u5230\u4e13\u4e3a\u7ebf\u7a0b\u4fdd\u7559\u7684\u7279\u6b8a\u533a\u57df\u4e0a\uff0c\u7528\u4e8e\u63d0\u4f9b\u8fd0\u884c\u4efb\u52a1\u65f6\u6240\u9700\u7684\u4e00\u5207\uff0c\u5305\u62ec\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u7a0b\u5e8f\u8ba1\u6570\u5668\uff0c\u6307\u660e\u8981\u6267\u884c\u7684\u4e0b\u4e00\u4e2a JVM \u5b57\u8282\u7801\u6307\u4ee4\u3002"),(0,r.kt)("li",{parentName:"ul"},"\u7528\u4e8e\u652f\u6301 Java \u4ee3\u7801\u6267\u884c\u7684\u6808\uff0c\u5305\u542b\u6709\u5173\u6b64\u7ebf\u7a0b\u5df2\u5230\u8fbe\u5f53\u65f6\u6267\u884c\u4f4d\u7f6e\u6240\u8c03\u7528\u65b9\u6cd5\u7684\u4fe1\u606f\u3002\u5b83\u4e5f\u5305\u542b\u6bcf\u4e2a\u6b63\u5728\u6267\u884c\u7684\u65b9\u6cd5\u7684\u6240\u6709\u5c40\u90e8\u53d8\u91cf(\u5305\u62ec\u539f\u8bed\u548c\u5806\u5bf9\u8c61\u7684\u5f15\u7528)\u3002\u6bcf\u4e2a\u7ebf\u7a0b\u7684\u6808\u901a\u5e38\u5728 64K \u5230 1M \u4e4b\u95f4 ",(0,r.kt)("sup",{parentName:"li",id:"fnref-1"},(0,r.kt)("a",{parentName:"sup",href:"#fn-1",className:"footnote-ref"},"1"))," \u3002"),(0,r.kt)("li",{parentName:"ul"},"\u7b2c\u4e8c\u4e2a\u5219\u7528\u4e8e native code\uff08\u672c\u673a\u65b9\u6cd5\u4ee3\u7801\uff09\u6267\u884c\u7684\u6808"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("em",{parentName:"li"},"thread-local variables")," \uff08\u7ebf\u7a0b\u672c\u5730\u53d8\u91cf\uff09\u7684\u5b58\u50a8\u533a\u57df"),(0,r.kt)("li",{parentName:"ul"},"\u7528\u4e8e\u63a7\u5236\u7ebf\u7a0b\u7684\u72b6\u6001\u7ba1\u7406\u53d8\u91cf")),(0,r.kt)("p",null,"\u5305\u62ec ",(0,r.kt)("inlineCode",{parentName:"p"},"main()")," \u5728\u5185\u7684\u6240\u6709\u4ee3\u7801\u90fd\u4f1a\u5728\u67d0\u4e2a\u7ebf\u7a0b\u5185\u8fd0\u884c\u3002 \u6bcf\u5f53\u8c03\u7528\u4e00\u4e2a\u65b9\u6cd5\u65f6\uff0c\u5f53\u524d\u7a0b\u5e8f\u8ba1\u6570\u5668\u88ab\u63a8\u5230\u8be5\u7ebf\u7a0b\u7684\u6808\u4e0a\uff0c\u7136\u540e\u6808\u6307\u9488\u5411\u4e0b\u79fb\u52a8\u4ee5\u8db3\u591f\u6765\u521b\u5efa\u4e00\u4e2a\u6808\u5e27\uff0c\u5176\u6808\u5e27\u91cc\u5b58\u50a8\u8be5\u65b9\u6cd5\u7684\u6240\u6709\u5c40\u90e8\u53d8\u91cf\uff0c\u53c2\u6570\u548c\u8fd4\u56de\u503c\u3002\u6240\u6709\u57fa\u672c\u7c7b\u578b\u53d8\u91cf\u90fd\u76f4\u63a5\u5728\u6808\u4e0a\uff0c\u867d\u7136\u65b9\u6cd5\u4e2d\u521b\u5efa\uff08\u6216\u65b9\u6cd5\u4e2d\u4f7f\u7528\uff09\u5bf9\u8c61\u7684\u4efb\u4f55\u5f15\u7528\u90fd\u4f4d\u4e8e\u6808\u5e27\u4e2d\uff0c\u4f46\u5bf9\u8c61\u672c\u8eab\u5b58\u4e8e\u5806\u4e2d\u3002\u8fd9\u4ec5\u4e14\u53ea\u6709\u4e00\u4e2a\u5806\uff0c\u88ab\u7a0b\u5e8f\u4e2d\u6240\u6709\u7ebf\u7a0b\u6240\u5171\u4eab\u3002"),(0,r.kt)("p",null,"\u9664\u6b64\u4ee5\u5916\uff0c\u7ebf\u7a0b\u5fc5\u987b\u7ed1\u5b9a\u5230\u64cd\u4f5c\u7cfb\u7edf\uff0c\u8fd9\u6837\u5b83\u5c31\u53ef\u4ee5\u5728\u67d0\u4e2a\u65f6\u5019\u8fde\u63a5\u5230\u5904\u7406\u5668\u3002\u8fd9\u662f\u4f5c\u4e3a\u7ebf\u7a0b\u6784\u5efa\u8fc7\u7a0b\u7684\u4e00\u90e8\u5206\u4e3a\u4f60\u7ba1\u7406\u7684\u3002Java \u4f7f\u7528\u5e95\u5c42\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u7684\u673a\u5236\u6765\u7ba1\u7406\u7ebf\u7a0b\u7684\u6267\u884c\u3002"),(0,r.kt)("h3",{id:"\u6700\u4f73\u7ebf\u7a0b\u6570"},"\u6700\u4f73\u7ebf\u7a0b\u6570"),(0,r.kt)("p",null,"\u5982\u679c\u4f60\u67e5\u770b\u7b2c 24 \u7ae0 ",(0,r.kt)("a",{parentName:"p",href:"./Concurrent-Programming"},"\u5e76\u53d1\u7f16\u7a0b")," \u4e2d\u4f7f\u7528 ",(0,r.kt)("em",{parentName:"p"},"CachedThreadPool")," \u7684\u7528\u4f8b\uff0c\u4f60\u4f1a\u53d1\u73b0 ",(0,r.kt)("strong",{parentName:"p"},"ExecutorService")," \u4e3a\u6bcf\u4e2a\u6211\u4eec\u63d0\u4ea4\u7684\u4efb\u52a1\u5206\u914d\u4e00\u4e2a\u7ebf\u7a0b\u3002\u7136\u800c\uff0c\u5e76\u884c\u6d41\uff08",(0,r.kt)("strong",{parentName:"p"},"parallel Stream"),"\uff09\u5728 ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/BruceEckel/OnJava8-Examples/blob/master/concurrent/CountingStream.java"},(0,r.kt)("strong",{parentName:"a"},"CountingStream.java"))," \u4e2d\u53ea\u5206\u914d\u4e86 8 \u4e2a\u7ebf\u7a0b\uff08id \u4e2d 1-7 \u4e3a\u5de5\u4f5c\u7ebf\u7a0b\uff0c8 \u4e3a  ",(0,r.kt)("inlineCode",{parentName:"p"},"main()")," \u65b9\u6cd5\u7684\u4e3b\u7ebf\u7a0b\uff0c\u5b83\u5de7\u5999\u5730\u5c06\u5176\u7528\u4f5c\u989d\u5916\u7684\u5e76\u884c\u6d41\uff09\u3002\u5982\u679c\u4f60\u5c1d\u8bd5\u63d0\u9ad8 ",(0,r.kt)("inlineCode",{parentName:"p"},"range()")," \u65b9\u6cd5\u4e2d\u7684\u4e0a\u9650\u503c\uff0c\u4f60\u4f1a\u770b\u5230\u6ca1\u6709\u521b\u5efa\u989d\u5916\u7684\u7ebf\u7a0b\u3002\u8fd9\u662f\u4e3a\u4ec0\u4e48\uff1f"),(0,r.kt)("p",null,"\u6211\u4eec\u53ef\u4ee5\u67e5\u51fa\u5f53\u524d\u673a\u5668\u4e0a\u5904\u7406\u5668\u7684\u6570\u91cf\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-Java"},"// lowlevel/NumberOfProcessors.java\n\npublic class NumberOfProcessors {\n  public static void main(String[] args) {\n    System.out.println(\n    Runtime.getRuntime().availableProcessors());\n  }\n}\n/* Output:\n8\n*/\n")),(0,r.kt)("p",null,"\u5728\u6211\u7684\u673a\u5668\u4e0a\uff08\u4f7f\u7528\u82f1\u7279\u5c14\u9177\u777fi7\uff09\uff0c\u6211\u6709\u56db\u4e2a\u5185\u6838\uff0c\u6bcf\u4e2a\u5185\u6838\u5448\u73b0\u4e24\u4e2a",(0,r.kt)("em",{parentName:"p"},"\u8d85\u7ebf\u7a0b"),"\uff08\u6307\u4e00\u79cd\u786c\u4ef6\u6280\u5de7\uff0c\u80fd\u5728\u5355\u4e2a\u5904\u7406\u5668\u4e0a\u4ea7\u751f\u975e\u5e38\u5feb\u901f\u7684\u4e0a\u4e0b\u6587\u5207\u6362\uff0c\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\u53ef\u4ee5\u4f7f\u5185\u6838\u770b\u8d77\u6765\u50cf\u8fd0\u884c\u4e24\u4e2a\u786c\u4ef6\u7ebf\u7a0b\uff09\u3002\u867d\u7136\u8fd9\u662f \u201c\u6700\u8fd1\u201d \u8ba1\u7b97\u673a\u4e0a\u7684\u5e38\u89c1\u914d\u7f6e(\u5728\u64b0\u5199\u672c\u6587\u65f6)\uff0c\u4f46\u4f60\u53ef\u80fd\u4f1a\u770b\u5230\u4e0d\u540c\u7684\u7ed3\u679c\uff0c\u5305\u62ec ",(0,r.kt)("strong",{parentName:"p"},"CountingStream.java ")," \u4e2d\u540c\u7b49\u6570\u91cf\u7684\u9ed8\u8ba4\u7ebf\u7a0b\u3002"),(0,r.kt)("p",null,"\u4f60\u7684\u64cd\u4f5c\u7cfb\u7edf\u53ef\u80fd\u6709\u529e\u6cd5\u6765\u67e5\u51fa\u5173\u4e8e\u5904\u7406\u5668\u7684\u66f4\u591a\u4fe1\u606f\uff0c\u4f8b\u5982\uff0c\u5728Windows 10\u4e0a\uff0c\u6309\u4e0b \u201c\u5f00\u59cb\u201d \u952e\uff0c\u8f93\u5165 \u201c\u4efb\u52a1\u7ba1\u7406\u5668\u201d \u548c Enter \u952e\u3002\u70b9\u51fb \u201c\u8be6\u7ec6\u4fe1\u606f\u201d \u3002\u9009\u62e9 \u201c\u6027\u80fd\u201d \u6807\u7b7e,\u4f60\u5c06\u4f1a\u770b\u5230\u5404\u79cd\u5404\u6837\u7684\u5173\u4e8e\u4f60\u7684\u786c\u4ef6\u4fe1\u606f,\u5305\u62ec\u201c\u5185\u6838\u201d \u548c \u201c\u903b\u8f91\u5904\u7406\u5668\u201d \u3002"),(0,r.kt)("p",null,"\u4e8b\u5b9e\u8bc1\u660e\uff0c\u201c\u901a\u7528\u201d\u7ebf\u7a0b\u7684\u6700\u4f73\u6570\u91cf\u5c31\u7b97\u662f\u53ef\u7528\u5904\u7406\u5668\u7684\u6570\u91cf(\u5bf9\u4e8e\u7279\u5b9a\u7684\u95ee\u9898\u53ef\u80fd\u4e0d\u662f\u8fd9\u6837)\u3002\u8fd9\u539f\u56e0\u6765\u81ea\u5728Java\u7ebf\u7a0b\u4e4b\u95f4\u5207\u6362\u4e0a\u4e0b\u6587\u7684\u4ee3\u4ef7\uff1a\u5b58\u50a8\u88ab\u6302\u8d77\u7ebf\u7a0b\u7684\u5f53\u524d\u72b6\u6001\uff0c\u5e76\u68c0\u7d22\u53e6\u4e00\u4e2a\u7ebf\u7a0b\u7684\u5f53\u524d\u72b6\u6001\uff0c\u4ee5\u4fbf\u4ece\u5b83\u8fdb\u5165\u6302\u8d77\u7684\u4f4d\u7f6e\u7ee7\u7eed\u6267\u884c\u3002\u5bf9\u4e8e 8 \u4e2a\u5904\u7406\u5668\u548c 8 \u4e2a\uff08\u8ba1\u7b97\u5bc6\u96c6\u578b\uff09Java\u7ebf\u7a0b\uff0cJVM \u5728\u8fd0\u884c\u8fd98\u4e2a\u4efb\u52a1\u65f6\u4ece\u4e0d\u9700\u8981\u5207\u6362\u4e0a\u4e0b\u6587\u3002\u5bf9\u4e8e\u6bd4\u5904\u7406\u5668\u6570\u91cf\u5c11\u7684\u4efb\u52a1\uff0c\u5206\u914d\u66f4\u591a\u7ebf\u7a0b\u6ca1\u6709\u5e2e\u52a9\u3002"),(0,r.kt)("p",null,"\u5b9a\u4e49\u4e86 \u201c\u903b\u8f91\u5904\u7406\u5668\u201d \u6570\u91cf\u7684 Intel \u8d85\u7ebf\u7a0b\uff0c\u4f46\u5e76\u6ca1\u6709\u589e\u52a0\u8ba1\u7b97\u80fd\u529b - \u8be5\u7279\u6027\u5728\u786c\u4ef6\u7ea7\u522b\u7ef4\u62a4\u989d\u5916\u7684\u7ebf\u7a0b\u4e0a\u4e0b\u6587\uff0c\u4ece\u800c\u52a0\u5feb\u4e86\u4e0a\u4e0b\u6587\u5207\u6362\uff0c\u8fd9\u6709\u52a9\u4e8e\u63d0\u9ad8\u7528\u6237\u754c\u9762\u7684\u54cd\u5e94\u80fd\u529b\u3002\u5bf9\u4e8e\u8ba1\u7b97\u5bc6\u96c6\u578b\u4efb\u52a1\uff0c\u8bf7\u8003\u8651\u5c06\u7ebf\u7a0b\u6570\u91cf\u4e0e\u7269\u7406\u5185\u6838(\u800c\u4e0d\u662f\u8d85\u7ebf\u7a0b)\u7684\u6570\u91cf\u5339\u914d\u3002\u5c3d\u7ba1Java\u8ba4\u4e3a\u6bcf\u4e2a\u8d85\u7ebf\u7a0b\u90fd\u662f\u4e00\u4e2a\u5904\u7406\u5668\uff0c\u4f46\u8fd9\u4f3c\u4e4e\u662f\u7531\u4e8e Intel \u5bf9\u8d85\u7ebf\u7a0b\u7684\u8fc7\u5ea6\u8425\u9500\u9020\u6210\u7684\u9519\u8bef\u3002\u5c3d\u7ba1\u5982\u6b64\uff0c\u4e3a\u4e86\u7b80\u5316\u7f16\u7a0b\uff0c\u6211\u53ea\u5141\u8bb8 JVM \u51b3\u5b9a\u9ed8\u8ba4\u7684\u7ebf\u7a0b\u6570\u3002 \u4f60\u5c06\u9700\u8981\u8bd5\u9a8c\u4f60\u7684\u4ea7\u54c1\u5e94\u7528\u3002 \u8fd9\u5e76\u4e0d\u610f\u5473\u7740\u5c06\u7ebf\u7a0b\u6570\u4e0e\u5904\u7406\u5668\u6570\u76f8\u5339\u914d\u5c31\u9002\u7528\u4e8e\u6240\u6709\u95ee\u9898; \u76f8\u53cd\uff0c\u5b83\u4e3b\u8981\u7528\u4e8e\u8ba1\u7b97\u5bc6\u96c6\u578b\u89e3\u51b3\u65b9\u6848\u3002"),(0,r.kt)("h3",{id:"\u6211\u53ef\u4ee5\u521b\u5efa\u591a\u5c11\u4e2a\u7ebf\u7a0b"},"\u6211\u53ef\u4ee5\u521b\u5efa\u591a\u5c11\u4e2a\u7ebf\u7a0b\uff1f"),(0,r.kt)("p",null,"Thread\uff08\u7ebf\u7a0b\uff09\u5bf9\u8c61\u7684\u6700\u5927\u90e8\u5206\u662f\u7528\u4e8e\u6267\u884c\u65b9\u6cd5\u7684 Java \u5806\u6808\u3002\u67e5\u770b Thread \uff08\u7ebf\u7a0b\uff09\u5bf9\u8c61\u7684\u5927\u5c0f\u56e0\u64cd\u4f5c\u7cfb\u7edf\u800c\u5f02\u3002\u8be5\u7a0b\u5e8f\u901a\u8fc7\u521b\u5efa Thread \u5bf9\u8c61\u6765\u6d4b\u8bd5\u5b83\uff0c\u76f4\u5230 JVM \u5185\u5b58\u4e0d\u8db3\u4e3a\u6b62\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'// lowlevel/ThreadSize.java\n// {ExcludeFromGradle} Takes a long time or hangs\nimport java.util.concurrent.*;\nimport onjava.Nap;\n\npublic class ThreadSize {\n  static class Dummy extends Thread {\n    @Override\n    public void run() { new Nap(1); }\n  }\n  public static void main(String[] args) {\n    ExecutorService exec =\n      Executors.newCachedThreadPool();\n    int count = 0;\n    try {\n      while(true) {\n        exec.execute(new Dummy());\n        count++;\n      }\n    } catch(Error e) {\n      System.out.println(\n      e.getClass().getSimpleName() + ": " + count);\n      System.exit(0);\n    } finally {\n      exec.shutdown();\n    }\n  }\n}\n')),(0,r.kt)("p",null,"\u53ea\u8981\u4f60\u4e0d\u65ad\u9012\u4ea4\u4efb\u52a1\uff0c",(0,r.kt)("strong",{parentName:"p"},"CachedThreadPool")," \u5c31\u4f1a\u7ee7\u7eed\u521b\u5efa\u7ebf\u7a0b\u3002\u5c06 ",(0,r.kt)("strong",{parentName:"p"},"Dummy")," \u5bf9\u8c61\u9012\u4ea4\u5230 ",(0,r.kt)("inlineCode",{parentName:"p"},"execute()")," \u65b9\u6cd5\u4ee5\u5f00\u59cb\u4efb\u52a1\uff0c\u5982\u679c\u7ebf\u7a0b\u6c60\u65e0\u53ef\u7528\u7ebf\u7a0b\uff0c\u5219\u5206\u914d\u4e00\u4e2a\u65b0\u7ebf\u7a0b\u3002\u6267\u884c\u7684\u6682\u505c\u65b9\u6cd5 ",(0,r.kt)("inlineCode",{parentName:"p"},"pause()")," \u8fd0\u884c\u65f6\u95f4\u5fc5\u987b\u8db3\u591f\u957f\uff0c\u4f7f\u4efb\u52a1\u4e0d\u4f1a\u5f00\u59cb\u5373\u5b8c\u6210(\u4ece\u800c\u4e3a\u65b0\u4efb\u52a1\u91ca\u653e\u73b0\u6709\u7ebf\u7a0b)\u3002\u53ea\u8981\u4efb\u52a1\u4e0d\u65ad\u8fdb\u5165\u800c\u6ca1\u6709\u5b8c\u6210\uff0c",(0,r.kt)("strong",{parentName:"p"},"CachedThreadPool")," \u6700\u7ec8\u5c31\u4f1a\u8017\u5c3d\u5185\u5b58\u3002"),(0,r.kt)("p",null,"\u6211\u5e76\u4e0d\u603b\u662f\u80fd\u591f\u5728\u6211\u5c1d\u8bd5\u7684\u6bcf\u53f0\u673a\u5668\u4e0a\u9020\u6210\u5185\u5b58\u4e0d\u8db3\u7684\u9519\u8bef\u3002\u5728\u4e00\u53f0\u673a\u5668\u4e0a\uff0c\u6211\u770b\u5230\u8fd9\u6837\u7684\u7ed3\u679c:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"> java ThreadSize\nOutOfMemoryError: 2816\n")),(0,r.kt)("p",null,"\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 ",(0,r.kt)("strong",{parentName:"p"},"-Xss")," \u6807\u8bb0\u51cf\u5c11\u6bcf\u4e2a\u7ebf\u7a0b\u6808\u5206\u914d\u7684\u5185\u5b58\u5927\u5c0f\u3002\u5141\u8bb8\u7684\u6700\u5c0f\u7ebf\u7a0b\u6808\u5927\u5c0f\u662f 64k:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},">java -Xss64K ThreadSize\nOutOfMemoryError: 4952\n")),(0,r.kt)("p",null,"\u5982\u679c\u6211\u4eec\u5c06\u7ebf\u7a0b\u6808\u5927\u5c0f\u589e\u52a0\u5230 2M \uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5206\u914d\u66f4\u5c11\u7684\u7ebf\u7a0b\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},">java -Xss2M ThreadSize\nOutOfMemoryError: 722\n")),(0,r.kt)("p",null,"Windows \u64cd\u4f5c\u7cfb\u7edf\u9ed8\u8ba4\u6808\u5927\u5c0f\u662f 320K\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u9a8c\u8bc1\u5b83\u7ed9\u51fa\u7684\u6570\u5b57\u4e0e\u6211\u4eec\u5b8c\u5168\u4e0d\u8bbe\u7f6e\u6808\u5927\u5c0f\u65f6\u7684\u6570\u5b57\u662f\u5927\u81f4\u76f8\u540c:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},">java -Xss320K ThreadSize\nOutOfMemoryError: 2816\n")),(0,r.kt)("p",null,"\u4f60\u8fd8\u53ef\u4ee5\u4f7f\u7528 ",(0,r.kt)("strong",{parentName:"p"},"-Xmx")," \u6807\u5fd7\u589e\u52a0 JVM \u7684\u6700\u5927\u5185\u5b58\u5206\u914d:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},">java -Xss64K -Xmx5M ThreadSize\nOutOfMemoryError: 5703\n")),(0,r.kt)("p",null,"\u8bf7\u6ce8\u610f\u7684\u662f\u64cd\u4f5c\u7cfb\u7edf\u8fd8\u53ef\u80fd\u5bf9\u5141\u8bb8\u7684\u7ebf\u7a0b\u6570\u65bd\u52a0\u9650\u5236\u3002"),(0,r.kt)("p",null,"\u56e0\u6b64\uff0c\u201c\u6211\u53ef\u4ee5\u62e5\u6709\u591a\u5c11\u7ebf\u7a0b\u201d\u8fd9\u4e00\u95ee\u9898\u7684\u7b54\u6848\u662f\u201c\u51e0\u5343\u4e2a\u201d\u3002\u4f46\u662f\uff0c\u5982\u679c\u4f60\u53d1\u73b0\u81ea\u5df1\u5206\u914d\u4e86\u6570\u5343\u4e2a\u7ebf\u7a0b\uff0c\u90a3\u4e48\u4f60\u53ef\u80fd\u9700\u8981\u91cd\u65b0\u8003\u8651\u4f60\u7684\u505a\u6cd5; \u6070\u5f53\u7684\u95ee\u9898\u662f\u201c\u6211\u9700\u8981\u591a\u5c11\u7ebf\u7a0b\uff1f\u201d"),(0,r.kt)("h3",{id:"the-workstealingpool-\u5de5\u4f5c\u7a83\u53d6\u7ebf\u7a0b\u6c60"},"The WorkStealingPool (\u5de5\u4f5c\u7a83\u53d6\u7ebf\u7a0b\u6c60)"),(0,r.kt)("p",null,"\u8fd9\u662f\u4e00\u4e2a ",(0,r.kt)("strong",{parentName:"p"},"ExecutorService")," \uff0c\u5b83\u4f7f\u7528\u6240\u6709\u53ef\u7528\u7684(\u7531JVM\u62a5\u544a) \u5904\u7406\u5668\u81ea\u52a8\u521b\u5efa\u7ebf\u7a0b\u6c60\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"// lowlevel/WorkStealingPool.java\nimport java.util.stream.*;\nimport java.util.concurrent.*;\n\nclass ShowThread implements Runnable {\n  @Override\n  public void run() {\n    System.out.println(\n    Thread.currentThread().getName());\n  }\n}\n\npublic class WorkStealingPool {\n  public static void main(String[] args)\n    throws InterruptedException {\n    System.out.println(\n      Runtime.getRuntime().availableProcessors());\n    ExecutorService exec =\n      Executors.newWorkStealingPool();\n    IntStream.range(0, 10)\n      .mapToObj(n -> new ShowThread())\n      .forEach(exec::execute);\n    exec.awaitTermination(1, TimeUnit.SECONDS);\n  }\n}\n/* Output:\n8\nForkJoinPool-1-worker-2\nForkJoinPool-1-worker-1\nForkJoinPool-1-worker-2\nForkJoinPool-1-worker-3\nForkJoinPool-1-worker-2\nForkJoinPool-1-worker-1\nForkJoinPool-1-worker-3\nForkJoinPool-1-worker-1\nForkJoinPool-1-worker-4\nForkJoinPool-1-worker-2\n*/\n")),(0,r.kt)("p",null,"\u5de5\u4f5c\u7a83\u53d6\u7b97\u6cd5\u5141\u8bb8\u5df2\u7ecf\u8017\u5c3d\u8f93\u5165\u961f\u5217\u4e2d\u7684\u5de5\u4f5c\u9879\u7684\u7ebf\u7a0b\u4ece\u5176\u4ed6\u961f\u5217\u201c\u7a83\u53d6\u201d\u5de5\u4f5c\u9879\u3002\u76ee\u6807\u662f\u5728\u5904\u7406\u5668\u4e4b\u95f4\u5206\u914d\u5de5\u4f5c\u9879\uff0c\u4ece\u800c\u6700\u5927\u9650\u5ea6\u5730\u5229\u7528\u6240\u6709\u53ef\u7528\u7684\u5904\u7406\u5668\u6765\u5b8c\u6210\u8ba1\u7b97\u5bc6\u96c6\u578b\u4efb\u52a1\u3002\u8fd9\u9879\u7b97\u6cd5\u4e5f\u7528\u4e8e Java \u7684fork/join \u6846\u67b6\u3002"),(0,r.kt)("h2",{id:"\u5f02\u5e38\u6355\u83b7"},"\u5f02\u5e38\u6355\u83b7"),(0,r.kt)("p",null,"\u8fd9\u53ef\u80fd\u4f1a\u8ba9\u4f60\u611f\u5230\u60ca\u8bb6\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"// lowlevel/SwallowedException.java\nimport java.util.concurrent.*;\n\npublic class SwallowedException {\n  public static void main(String[] args)\n    throws InterruptedException {\n    ExecutorService exec =\n      Executors.newSingleThreadExecutor();\n    exec.submit(() -> {\n      throw new RuntimeException();\n    });\n    exec.shutdown();\n  }\n}\n")),(0,r.kt)("p",null,"\u8fd9\u4e2a\u7a0b\u5e8f\u4ec0\u4e48\u4e5f\u4e0d\u8f93\u51fa\uff08\u7136\u800c\uff0c\u5982\u679c\u4f60\u7528 ",(0,r.kt)("strong",{parentName:"p"},"execute")," \u65b9\u6cd5\u66ff\u6362 ",(0,r.kt)("inlineCode",{parentName:"p"},"submit()")," \u65b9\u6cd5\uff0c\u4f60\u5c31\u5c06\u4f1a\u770b\u5230\u5f02\u5e38\u629b\u51fa\u3002\u8fd9\u8bf4\u660e\u5728\u7ebf\u7a0b\u4e2d\u629b\u51fa\u5f02\u5e38\u662f\u5f88\u68d8\u624b\u7684\uff0c\u9700\u8981\u7279\u522b\u6ce8\u610f\u7684\u4e8b\u60c5\u3002"),(0,r.kt)("p",null,"\u4f60\u65e0\u6cd5\u6355\u83b7\u5230\u4ece\u7ebf\u7a0b\u9003\u9038\u7684\u5f02\u5e38\u3002\u4e00\u65e6\u5f02\u5e38\u8d8a\u8fc7\u4e86\u4efb\u52a1\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"run()")," \u65b9\u6cd5\uff0c\u5b83\u5c31\u4f1a\u4f20\u9012\u81f3\u63a7\u5236\u53f0\uff0c\u9664\u975e\u4f60\u91c7\u53d6\u7279\u6b8a\u6b65\u9aa4\u6765\u6355\u83b7\u6b64\u7c7b\u9519\u8bef\u5f02\u5e38\u3002"),(0,r.kt)("p",null,"\u4e0b\u9762\u662f\u4e00\u4e2a\u629b\u51fa\u5f02\u5e38\u7684\u4ee3\u7801\uff0c\u8be5\u5f02\u5e38\u4f1a\u4f20\u9012\u5230\u5b83\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"run()")," \u65b9\u6cd5\u4e4b\u5916\uff0c\u800c ",(0,r.kt)("inlineCode",{parentName:"p"},"main()")," \u65b9\u6cd5\u4f1a\u663e\u793a\u8fd0\u884c\u5b83\u65f6\u4f1a\u53d1\u751f\u4ec0\u4e48\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'// lowlevel/ExceptionThread.java\n// {ThrowsException}\nimport java.util.concurrent.*;\n\npublic class ExceptionThread implements Runnable {\n  @Override\n  public void run() {\n    throw new RuntimeException();\n  }\n  public static void main(String[] args) {\n    ExecutorService es =\n      Executors.newCachedThreadPool();\n    es.execute(new ExceptionThread());\n    es.shutdown();\n  }\n}\n/* Output:\n___[ Error Output ]___\nException in thread "pool-1-thread-1"\njava.lang.RuntimeException\n        at ExceptionThread.run(ExceptionThread.java:8)\n        at java.util.concurrent.ThreadPoolExecutor.runW\norker(ThreadPoolExecutor.java:1142)\n        at java.util.concurrent.ThreadPoolExecutor$Work\ner.run(ThreadPoolExecutor.java:617)\n        at java.lang.Thread.run(Thread.java:745)\n*/\n')),(0,r.kt)("p",null,"\u8f93\u51fa\u662f(\u7ecf\u8fc7\u8c03\u6574\u4e00\u4e9b\u9650\u5b9a\u7b26\u4ee5\u9002\u5e94\u9605\u8bfb)\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'Exception in thread "pool-1-thread-1" RuntimeException\n  at ExceptionThread.run(ExceptionThread.java:9)\n  at ThreadPoolExecutor.runWorker(...)\n  at ThreadPoolExecutor$Worker.run(...)\n  at java.lang.Thread.run(Thread.java:745)\n')),(0,r.kt)("p",null,"\u5373\u4f7f\u5728 ",(0,r.kt)("inlineCode",{parentName:"p"},"main()")," \u65b9\u6cd5\u4f53\u5185\u5305\u88f9 ",(0,r.kt)("strong",{parentName:"p"},"try-catch")," \u4ee3\u7801\u5757\u6765\u6355\u83b7\u5f02\u5e38\u4e5f\u4e0d\u6210\u529f\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'// lowlevel/NaiveExceptionHandling.java\n// {ThrowsException}\nimport java.util.concurrent.*;\n\npublic class NaiveExceptionHandling {\n  public static void main(String[] args) {\n    ExecutorService es =\n      Executors.newCachedThreadPool();\n    try {\n      es.execute(new ExceptionThread());\n    } catch(RuntimeException ue) {\n      // This statement will NOT execute!\n      System.out.println("Exception was handled!");\n    } finally {\n      es.shutdown();\n    }\n  }\n}\n/* Output:\n___[ Error Output ]___\nException in thread "pool-1-thread-1"\njava.lang.RuntimeException\n        at ExceptionThread.run(ExceptionThread.java:8)\n        at java.util.concurrent.ThreadPoolExecutor.runW\norker(ThreadPoolExecutor.java:1142)\n        at java.util.concurrent.ThreadPoolExecutor$Work\ner.run(ThreadPoolExecutor.java:617)\n        at java.lang.Thread.run(Thread.java:745)\n*/\n')),(0,r.kt)("p",null,"\u8fd9\u4f1a\u4ea7\u751f\u4e0e\u524d\u4e00\u4e2a\u793a\u4f8b\u76f8\u540c\u7684\u7ed3\u679c:\u672a\u6355\u83b7\u5f02\u5e38\u3002"),(0,r.kt)("p",null,"\u4e3a\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u9700\u8981\u6539\u53d8 ",(0,r.kt)("strong",{parentName:"p"},"Executor")," \uff08\u6267\u884c\u5668\uff09\u751f\u6210\u7ebf\u7a0b\u7684\u65b9\u5f0f\u3002 ",(0,r.kt)("strong",{parentName:"p"},"Thread.UncaughtExceptionHandler")," \u662f\u4e00\u4e2a\u6dfb\u52a0\u7ed9\u6bcf\u4e2a ",(0,r.kt)("strong",{parentName:"p"},"Thread")," \u5bf9\u8c61\uff0c\u7528\u4e8e\u8fdb\u884c\u5f02\u5e38\u5904\u7406\u7684\u63a5\u53e3\u3002"),(0,r.kt)("p",null,"\u5f53\u8be5\u7ebf\u7a0b\u5373\u5c06\u6b7b\u4e8e\u672a\u6355\u83b7\u7684\u5f02\u5e38\u65f6\uff0c\u5c06\u81ea\u52a8\u8c03\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"Thread.UncaughtExceptionHandler.uncaughtException()"),"\n\u65b9\u6cd5\u3002\u4e3a\u4e86\u8c03\u7528\u8be5\u65b9\u6cd5\uff0c\u6211\u4eec\u521b\u5efa\u4e00\u4e2a\u65b0\u7684 ",(0,r.kt)("strong",{parentName:"p"},"ThreadFactory")," \u7c7b\u578b\u6765\u8ba9 ",(0,r.kt)("strong",{parentName:"p"},"Thread.UncaughtExceptionHandler")," \u5bf9\u8c61\u9644\u52a0\u5230\u6bcf\u4e2a\u5b83\u6240\u65b0\u521b\u5efa\u7684 ",(0,r.kt)("strong",{parentName:"p"},"Thread"),"\uff08\u7ebf\u7a0b\uff09\u5bf9\u8c61\u4e0a\u3002\u6211\u4eec\u8d4b\u503c\u8be5\u5de5\u5382\u5bf9\u8c61\u7ed9 ",(0,r.kt)("strong",{parentName:"p"},"Executors")," \u5bf9\u8c61\u7684 \u65b9\u6cd5\uff0c\u8ba9\u5b83\u7684\u65b9\u6cd5\u6765\u751f\u6210\u65b0\u7684 ",(0,r.kt)("strong",{parentName:"p"},"ExecutorService")," \u5bf9\u8c61\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'// lowlevel/CaptureUncaughtException.java\nimport java.util.concurrent.*;\n\nclass ExceptionThread2 implements Runnable {\n  @Override\n  public void run() {\n    Thread t = Thread.currentThread();\n    System.out.println("run() by " + t.getName());\n    System.out.println(\n      "eh = " + t.getUncaughtExceptionHandler());\n    throw new RuntimeException();\n  }\n}\n\nclass MyUncaughtExceptionHandler implements\nThread.UncaughtExceptionHandler {\n  @Override\n  public void uncaughtException(Thread t, Throwable e) {\n    System.out.println("caught " + e);\n  }\n}\n\nclass HandlerThreadFactory implements ThreadFactory {\n  @Override\n  public Thread newThread(Runnable r) {\n    System.out.println(this + " creating new Thread");\n    Thread t = new Thread(r);\n    System.out.println("created " + t);\n    t.setUncaughtExceptionHandler(\n      new MyUncaughtExceptionHandler());\n    System.out.println(\n      "eh = " + t.getUncaughtExceptionHandler());\n    return t;\n  }\n}\n\npublic class CaptureUncaughtException {\n  public static void main(String[] args) {\n    ExecutorService exec =\n      Executors.newCachedThreadPool(\n        new HandlerThreadFactory());\n    exec.execute(new ExceptionThread2());\n    exec.shutdown();\n  }\n}\n/* Output:\nHandlerThreadFactory@4e25154f creating new Thread\ncreated Thread[Thread-0,5,main]\neh = MyUncaughtExceptionHandler@70dea4e\nrun() by Thread-0\neh = MyUncaughtExceptionHandler@70dea4e\ncaught java.lang.RuntimeException\n*/\n')),(0,r.kt)("p",null,"\u989d\u5916\u4f1a\u5728\u4ee3\u7801\u4e2d\u6dfb\u52a0\u8ddf\u8e2a\u673a\u5236\uff0c\u7528\u6765\u9a8c\u8bc1\u5de5\u5382\u5bf9\u8c61\u521b\u5efa\u7684\u7ebf\u7a0b\u662f\u5426\u83b7\u5f97\u65b0 ",(0,r.kt)("strong",{parentName:"p"},"UncaughtExceptionHandler")," \u3002\u73b0\u5728\u672a\u6355\u83b7\u7684\u5f02\u5e38\u7531 ",(0,r.kt)("strong",{parentName:"p"},"uncaughtException")," \u65b9\u6cd5\u6355\u83b7\u3002"),(0,r.kt)("p",null,"\u4e0a\u9762\u7684\u793a\u4f8b\u6839\u636e\u5177\u4f53\u60c5\u51b5\u6765\u8bbe\u7f6e\u5904\u7406\u5668\u3002\u5982\u679c\u4f60\u77e5\u9053\u4f60\u5c06\u8981\u5728\u4ee3\u7801\u4e2d\u5904\u5904\u4f7f\u7528\u76f8\u540c\u7684\u5f02\u5e38\u5904\u7406\u5668\uff0c\u90a3\u4e48\u66f4\u7b80\u5355\u7684\u65b9\u5f0f\u662f\u5728 ",(0,r.kt)("strong",{parentName:"p"},"Thread")," \u7c7b\u4e2d\u8bbe\u7f6e\u4e00\u4e2a ",(0,r.kt)("strong",{parentName:"p"},"static"),"\uff08\u9759\u6001\uff09 \u5b57\u6bb5\uff0c\u5e76\u5c06\u8fd9\u4e2a\u5904\u7406\u5668\u8bbe\u7f6e\u4e3a\u9ed8\u8ba4\u7684\u672a\u6355\u83b7\u5f02\u5e38\u5904\u7406\u5668\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"// lowlevel/SettingDefaultHandler.java\nimport java.util.concurrent.*;\n\npublic class SettingDefaultHandler {\n  public static void main(String[] args) {\n    Thread.setDefaultUncaughtExceptionHandler(\n      new MyUncaughtExceptionHandler());\n    ExecutorService es =\n      Executors.newCachedThreadPool();\n    es.execute(new ExceptionThread());\n    es.shutdown();\n  }\n}\n/* Output:\ncaught java.lang.RuntimeException\n*/\n")),(0,r.kt)("p",null,"\u53ea\u6709\u5728\u6bcf\u4e2a\u7ebf\u7a0b\u6ca1\u6709\u8bbe\u7f6e\u5f02\u5e38\u5904\u7406\u5668\u65f6\u5019\uff0c\u9ed8\u8ba4\u5904\u7406\u5668\u624d\u4f1a\u88ab\u8c03\u7528\u3002\u7cfb\u7edf\u4f1a\u68c0\u67e5\u7ebf\u7a0b\u4e13\u6709\u7684\u7248\u672c\uff0c\u5982\u679c\u6ca1\u6709\uff0c\u5219\u68c0\u67e5\u662f\u5426\u7ebf\u7a0b\u7ec4\u4e2d\u6709\u4e13\u6709\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"uncaughtException()")," \u65b9\u6cd5\uff1b\u5982\u679c\u90fd\u6ca1\u6709\uff0c\u5c31\u4f1a\u8c03\u7528 ",(0,r.kt)("strong",{parentName:"p"},"defaultUncaughtExceptionHandler")," \u65b9\u6cd5\u3002"),(0,r.kt)("p",null,"\u53ef\u4ee5\u5c06\u6b64\u65b9\u6cd5\u4e0e ",(0,r.kt)("strong",{parentName:"p"},"CompletableFuture")," \u7684\u6539\u8fdb\u65b9\u6cd5\u8fdb\u884c\u6bd4\u8f83\u3002"),(0,r.kt)("h2",{id:"\u8d44\u6e90\u5171\u4eab"},"\u8d44\u6e90\u5171\u4eab"),(0,r.kt)("p",null,"\u4f60\u53ef\u4ee5\u5c06\u5355\u7ebf\u7a0b\u7a0b\u5e8f\u770b\u4f5c\u4e00\u4e2a\u5b64\u72ec\u7684\u5b9e\u4f53\uff0c\u5728\u4f60\u7684\u95ee\u9898\u7a7a\u95f4\u4e2d\u79fb\u52a8\u5e76\u540c\u4e00\u65f6\u95f4\u53ea\u505a\u4e00\u4ef6\u4e8b\u3002\u56e0\u4e3a\u53ea\u6709\u4e00\u4e2a\u5b9e\u4f53\uff0c\u4f60\u6c38\u8fdc\u4e0d\u4f1a\u60f3\u5230\u4e24\u4e2a\u5b9e\u4f53\u8bd5\u56fe\u540c\u65f6\u4f7f\u7528\u76f8\u540c\u8d44\u6e90\u7684\u95ee\u9898\uff1a\u95ee\u9898\u72b9\u5982\u4e24\u4e2a\u4eba\u8bd5\u56fe\u540c\u65f6\u505c\u653e\u5728\u540c\u4e00\u4e2a\u7a7a\u95f4\uff0c\u540c\u65f6\u8d70\u8fc7\u4e00\u6247\u95e8\uff0c\u751a\u81f3\u540c\u65f6\u8bf4\u8bdd\u3002"),(0,r.kt)("p",null,"\u901a\u8fc7\u5e76\u53d1\uff0c\u4e8b\u60c5\u4e0d\u518d\u5b64\u5355\uff0c\u4f46\u73b0\u5728\u4e24\u4e2a\u6216\u66f4\u591a\u4efb\u52a1\u53ef\u80fd\u4f1a\u76f8\u4e92\u5e72\u6270\u3002\u5982\u679c\u4f60\u4e0d\u963b\u6b62\u8fd9\u79cd\u51b2\u7a81\uff0c\u4f60\u5c06\u6709\u4e24\u4e2a\u4efb\u52a1\u540c\u65f6\u5c1d\u8bd5\u8bbf\u95ee\u540c\u4e00\u4e2a\u94f6\u884c\u5e10\u6237\uff0c\u6253\u5370\u5230\u540c\u4e00\u4e2a\u6253\u5370\u673a\uff0c\u8c03\u6574\u540c\u4e00\u4e2a\u9600\u95e8\uff0c\u7b49\u7b49\u3002"),(0,r.kt)("h3",{id:"\u8d44\u6e90\u7ade\u4e89"},"\u8d44\u6e90\u7ade\u4e89"),(0,r.kt)("p",null,"\u5f53\u4f60\u542f\u52a8\u4e00\u4e2a\u4efb\u52a1\u6765\u6267\u884c\u67d0\u4e9b\u5de5\u4f5c\u65f6\uff0c\u53ef\u4ee5\u901a\u8fc7\u4e24\u79cd\u4e0d\u540c\u7684\u65b9\u5f0f\u6355\u83b7\u8be5\u5de5\u4f5c\u7684\u7ed3\u679c:\u901a\u8fc7\u526f\u4f5c\u7528\u6216\u901a\u8fc7\u8fd4\u56de\u503c\u3002"),(0,r.kt)("p",null,"\u4ece\u7f16\u7a0b\u65b9\u5f0f\u4e0a\u770b\uff0c\u526f\u4f5c\u7528\u4f3c\u4e4e\u66f4\u5bb9\u6613:\u4f60\u53ea\u9700\u4f7f\u7528\u7ed3\u679c\u6765\u64cd\u4f5c\u73af\u5883\u4e2d\u7684\u67d0\u4e9b\u4e1c\u897f\u3002\u4f8b\u5982\uff0c\u4f60\u7684\u4efb\u52a1\u53ef\u80fd\u4f1a\u6267\u884c\u4e00\u4e9b\u8ba1\u7b97\uff0c\u7136\u540e\u76f4\u63a5\u5c06\u5176\u7ed3\u679c\u5199\u5165\u96c6\u5408\u3002"),(0,r.kt)("p",null,"\u4f34\u968f\u8fd9\u79cd\u65b9\u5f0f\u7684\u95ee\u9898\u662f\u96c6\u5408\u901a\u5e38\u662f\u5171\u4eab\u8d44\u6e90\u3002\u5f53\u8fd0\u884c\u591a\u4e2a\u4efb\u52a1\u65f6\uff0c\u4efb\u4f55\u4efb\u52a1\u90fd\u53ef\u80fd\u540c\u65f6\u8bfb\u5199 ",(0,r.kt)("em",{parentName:"p"},"\u5171\u4eab\u8d44\u6e90")," \u3002\u8fd9\u63ed\u793a\u4e86 ",(0,r.kt)("em",{parentName:"p"},"\u8d44\u6e90\u7ade\u4e89")," \u95ee\u9898\uff0c\u8fd9\u662f\u5904\u7406\u4efb\u52a1\u65f6\u7684\u4e3b\u8981\u9677\u9631\u4e4b\u4e00\u3002"),(0,r.kt)("p",null,"\u5728\u5355\u7ebf\u7a0b\u7cfb\u7edf\u4e2d\uff0c\u4f60\u4e0d\u9700\u8981\u8003\u8651\u8d44\u6e90\u7ade\u4e89\uff0c\u56e0\u4e3a\u4f60\u6c38\u8fdc\u4e0d\u53ef\u80fd\u540c\u65f6\u505a\u591a\u4ef6\u4e8b\u3002\u5f53\u4f60\u6709\u591a\u4e2a\u4efb\u52a1\u65f6\uff0c\u4f60\u5c31\u5fc5\u987b\u59cb\u7ec8\u9632\u6b62\u8d44\u6e90\u7ade\u4e89\u3002"),(0,r.kt)("p",null,"\u89e3\u51b3\u6b64\u95ee\u9898\u7684\u7684\u4e00\u79cd\u65b9\u6cd5\u662f\u4f7f\u7528\u80fd\u591f\u5e94\u5bf9\u8d44\u6e90\u7ade\u4e89\u7684\u96c6\u5408\uff0c\u5982\u679c\u591a\u4e2a\u4efb\u52a1\u540c\u65f6\u5c1d\u8bd5\u5bf9\u6b64\u7c7b\u96c6\u5408\u8fdb\u884c\u5199\u5165\uff0c\u90a3\u4e48\u6b64\u7c7b\u96c6\u5408\u53ef\u4ee5\u5e94\u4ed8\u8be5\u95ee\u9898\u3002\u5728 Java \u5e76\u53d1\u5e93\u4e2d\uff0c\u4f60\u5c06\u53d1\u73b0\u8bb8\u591a\u5c1d\u8bd5\u89e3\u51b3\u8d44\u6e90\u7ade\u4e89\u95ee\u9898\u7684\u7c7b\uff1b\u5728\u672c\u9644\u5f55\u4e2d\uff0c\u4f60\u5c06\u770b\u5230\u5176\u4e2d\u7684\u4e00\u4e9b\uff0c\u4f46\u8986\u76d6\u8303\u56f4\u5e76\u4e0d\u5168\u9762\u3002"),(0,r.kt)("p",null,"\u8bf7\u601d\u8003\u4ee5\u4e0b\u7684\u793a\u4f8b\uff0c\u5176\u4e2d\u4e00\u4e2a\u4efb\u52a1\u8d1f\u8d23\u751f\u6210\u5076\u6570\uff0c\u5176\u4ed6\u4efb\u52a1\u5219\u8d1f\u8d23\u6d88\u8d39\u8fd9\u4e9b\u6570\u5b57\u3002\u5728\u8fd9\u91cc\uff0c\u6d88\u8d39\u8005\u4efb\u52a1\u7684\u552f\u4e00\u5de5\u4f5c\u5c31\u662f\u68c0\u67e5\u5076\u6570\u7684\u6709\u6548\u6027\u3002"),(0,r.kt)("p",null,"\u6211\u4eec\u5c06\u5b9a\u4e49\u6d88\u8d39\u8005\u4efb\u52a1 ",(0,r.kt)("strong",{parentName:"p"},"EvenChecker")," \u7c7b\uff0c\u4ee5\u4fbf\u5728\u540e\u7eed\u793a\u4f8b\u4e2d\u53ef\u590d\u7528\u3002\u4e3a\u4e86\u5c06 ",(0,r.kt)("strong",{parentName:"p"},"EvenChecker")," \u4e0e\u6211\u4eec\u7684\u5404\u79cd\u5b9e\u9a8c\u751f\u6210\u5668\u7c7b\u89e3\u8026\uff0c\u6211\u4eec\u9996\u5148\u521b\u5efa\u540d\u4e3a ",(0,r.kt)("strong",{parentName:"p"},"IntGenerator")," \u7684\u62bd\u8c61\u7c7b\uff0c\u5b83\u5305\u542b ",(0,r.kt)("strong",{parentName:"p"},"EvenChecker")," \u5fc5\u987b\u77e5\u9053\u7684\u6700\u4f4e\u5fc5\u8981\u65b9\u6cd5\uff1a\u5b83\u5305\u542b ",(0,r.kt)("inlineCode",{parentName:"p"},"next()")," \u65b9\u6cd5\uff0c\u4ee5\u53ca\u53ef\u4ee5\u53d6\u6d88\u5b83\u6267\u884c\u751f\u6210\u7684\u65b9\u6cd5\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"// lowlevel/IntGenerator.java\nimport java.util.concurrent.atomic.AtomicBoolean;\n\npublic abstract class IntGenerator {\n  private AtomicBoolean canceled =\n    new AtomicBoolean();\n  public abstract int next();\n  public void cancel() { canceled.set(true); }\n  public boolean isCanceled() {\n    return canceled.get();\n  }\n}\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"cancel()")," \u65b9\u6cd5\u6539\u53d8 ",(0,r.kt)("strong",{parentName:"p"},"AtomicBoolean")," \u7c7b\u578b\u7684 ",(0,r.kt)("strong",{parentName:"p"},"canceled")," \u6807\u5fd7\u4f4d\u7684\u72b6\u6001\uff0c \u800c ",(0,r.kt)("inlineCode",{parentName:"p"},"isCanceled()")," \u65b9\u6cd5\u5219\u544a\u8bc9\u6807\u5fd7\u4f4d\u662f\u5426\u8bbe\u7f6e\u3002\u56e0\u4e3a ",(0,r.kt)("strong",{parentName:"p"},"canceled")," \u6807\u5fd7\u4f4d\u662f ",(0,r.kt)("strong",{parentName:"p"},"AtomicBoolean")," \u7c7b\u578b\uff0c\u7531\u4e8e\u5b83\u662f\u539f\u5b50\u6027\u7684\uff0c\u8fd9\u610f\u5473\u7740\u5206\u914d\u548c\u503c\u8fd4\u56de\u7b49\u7b80\u5355\u64cd\u4f5c\u53d1\u751f\u65f6\u6ca1\u6709\u4e2d\u65ad\u7684\u53ef\u80fd\u6027\uff0c\u56e0\u6b64\u4f60\u65e0\u6cd5\u5728\u8fd9\u4e9b\u7b80\u5355\u64cd\u4f5c\u4e2d\u770b\u5230\u8be5\u5b57\u6bb5\u5904\u4e8e\u4e2d\u95f4\u72b6\u6001\u3002\u4f60\u5c06\u5728\u672c\u9644\u5f55\u7684\u540e\u9762\u90e8\u5206\u4e86\u89e3\u6709\u5173\u539f\u5b50\u6027\u548c ",(0,r.kt)("strong",{parentName:"p"},"Atomic")," \u7c7b\u7684\u66f4\u591a\u4fe1\u606f"),(0,r.kt)("p",null,"\u4efb\u4f55 ",(0,r.kt)("strong",{parentName:"p"},"IntGenerator")," \u90fd\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u7684 ",(0,r.kt)("strong",{parentName:"p"},"EvenChecker")," \u7c7b\u8fdb\u884c\u6d4b\u8bd5:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'// lowlevel/EvenChecker.java\nimport java.util.*;\nimport java.util.stream.*;\nimport java.util.concurrent.*;\nimport onjava.TimedAbort;\n\npublic class EvenChecker implements Runnable {\n  private IntGenerator generator;\n  private final int id;\n  public EvenChecker(IntGenerator generator, int id) {\n    this.generator = generator;\n    this.id = id;\n  }\n  @Override\n  public void run() {\n    while(!generator.isCanceled()) {\n      int val = generator.next();\n      if(val % 2 != 0) {\n        System.out.println(val + " not even!");\n        generator.cancel(); // Cancels all EvenCheckers\n      }\n    }\n  }\n  // Test any IntGenerator:\n  public static void test(IntGenerator gp, int count) {\n    List<CompletableFuture<Void>> checkers =\n      IntStream.range(0, count)\n        .mapToObj(i -> new EvenChecker(gp, i))\n        .map(CompletableFuture::runAsync)\n        .collect(Collectors.toList());\n    checkers.forEach(CompletableFuture::join);\n  }\n  // Default value for count:\n  public static void test(IntGenerator gp) {\n    new TimedAbort(4, "No odd numbers discovered");\n    test(gp, 10);\n  }\n}\n')),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"test()")," \u65b9\u6cd5\u5f00\u542f\u4e86\u8bb8\u591a\u8bbf\u95ee\u540c\u4e00\u4e2a ",(0,r.kt)("strong",{parentName:"p"},"IntGenerator")," \u7684 ",(0,r.kt)("strong",{parentName:"p"},"EvenChecker"),"\u3002",(0,r.kt)("strong",{parentName:"p"},"EvenChecker")," \u4efb\u52a1\u4eec\u4f1a\u4e0d\u65ad\u8bfb\u53d6\u548c\u6d4b\u8bd5\u4e0e\u5176\u5173\u8054\u7684 ",(0,r.kt)("strong",{parentName:"p"},"IntGenerator")," \u5bf9\u8c61\u4e2d\u7684\u751f\u6210\u503c\u3002\u5982\u679c ",(0,r.kt)("strong",{parentName:"p"},"IntGenerator")," \u5bfc\u81f4\u5931\u8d25\uff0c",(0,r.kt)("inlineCode",{parentName:"p"},"test()")," \u65b9\u6cd5\u4f1a\u62a5\u544a\u5e76\u8fd4\u56de\u3002"),(0,r.kt)("p",null,"\u4f9d\u8d56\u4e8e ",(0,r.kt)("strong",{parentName:"p"},"IntGenerator")," \u5bf9\u8c61\u7684\u6240\u6709 ",(0,r.kt)("strong",{parentName:"p"},"EvenChecker")," \u4efb\u52a1\u90fd\u4f1a\u68c0\u67e5\u5b83\u662f\u5426\u5df2\u88ab\u53d6\u6d88\u3002\u5982\u679c ",(0,r.kt)("inlineCode",{parentName:"p"},"generator.isCanceled()")," \u8fd4\u56de\u503c\u4e3a true \uff0c\u5219 ",(0,r.kt)("inlineCode",{parentName:"p"},"run()")," \u65b9\u6cd5\u8fd4\u56de\u3002 \u4efb\u4f55 ",(0,r.kt)("strong",{parentName:"p"},"EvenChecker")," \u4efb\u52a1\u90fd\u53ef\u4ee5\u5728 ",(0,r.kt)("strong",{parentName:"p"},"IntGenerator")," \u4e0a\u8c03\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"cancel()")," \uff0c\u8fd9\u4f1a\u5bfc\u81f4\u4f7f\u7528\u8be5 ",(0,r.kt)("strong",{parentName:"p"},"IntGenerator")," \u7684\u5176\u4ed6\u6240\u6709 ",(0,r.kt)("strong",{parentName:"p"},"EvenChecker")," \u6b63\u5e38\u5173\u95ed\u3002"),(0,r.kt)("p",null,"\u5728\u672c\u8bbe\u8ba1\u4e2d\uff0c\u5171\u4eab\u516c\u5171\u8d44\u6e90\uff08 ",(0,r.kt)("strong",{parentName:"p"},"IntGenerator")," \uff09\u7684\u4efb\u52a1\u4f1a\u76d1\u89c6\u8be5\u8d44\u6e90\u7684\u7ec8\u6b62\u4fe1\u53f7\u3002\u8fd9\u6d88\u9664\u6240\u8c13\u7684\u7ade\u4e89\u6761\u4ef6\uff0c\u5176\u4e2d\u4e24\u4e2a\u6216\u66f4\u591a\u7684\u4efb\u52a1\u7ade\u4e89\u54cd\u5e94\u67d0\u4e2a\u6761\u4ef6\u5e76\u56e0\u6b64\u51b2\u7a81\u6216\u4e0d\u4e00\u81f4\u7ed3\u679c\u7684\u60c5\u51b5\u3002"),(0,r.kt)("p",null,"\u4f60\u5fc5\u987b\u4ed4\u7ec6\u8003\u8651\u5e76\u9632\u6b62\u5e76\u53d1\u7cfb\u7edf\u5931\u8d25\u7684\u6240\u6709\u53ef\u80fd\u9014\u5f84\u3002\u4f8b\u5982\uff0c\u4e00\u4e2a\u4efb\u52a1\u4e0d\u80fd\u4f9d\u8d56\u4e8e\u53e6\u4e00\u4e2a\u4efb\u52a1\uff0c\u56e0\u4e3a\u4efb\u52a1\u5173\u95ed\u7684\u987a\u5e8f\u65e0\u6cd5\u5f97\u5230\u4fdd\u8bc1\u3002\u8fd9\u91cc\uff0c\u901a\u8fc7\u4f7f\u4efb\u52a1\u4f9d\u8d56\u4e8e\u975e\u4efb\u52a1\u5bf9\u8c61\uff0c\u6211\u4eec\u53ef\u4ee5\u6d88\u9664\u6f5c\u5728\u7684\u7ade\u4e89\u6761\u4ef6\u3002"),(0,r.kt)("p",null,"\u4e00\u822c\u6765\u8bf4\uff0c\u6211\u4eec\u5047\u8bbe ",(0,r.kt)("inlineCode",{parentName:"p"},"test()")," \u65b9\u6cd5\u6700\u7ec8\u5931\u8d25\uff0c\u56e0\u4e3a\u5404\u4e2a ",(0,r.kt)("strong",{parentName:"p"},"EvenChecker")," \u7684\u4efb\u52a1\u5728 ",(0,r.kt)("strong",{parentName:"p"},"IntGenerator")," \u5904\u4e8e \u201c\u4e0d\u6070\u5f53\u7684\u201d \u72b6\u6001\u65f6\uff0c\u4ecd\u80fd\u591f\u8bbf\u95ee\u5176\u4e2d\u7684\u4fe1\u606f\u3002\u4f46\u662f\uff0c\u76f4\u5230 ",(0,r.kt)("strong",{parentName:"p"},"IntGenerator")," \u5b8c\u6210\u8bb8\u591a\u5faa\u73af\u4e4b\u524d\uff0c\u5b83\u53ef\u80fd\u65e0\u6cd5\u68c0\u6d4b\u5230\u95ee\u9898\uff0c\u5177\u4f53\u53d6\u51b3\u4e8e\u64cd\u4f5c\u7cfb\u7edf\u7684\u8be6\u7ec6\u4fe1\u606f\u548c\u5176\u4ed6\u5b9e\u73b0\u7ec6\u8282\u3002\u4e3a\u786e\u4fdd\u672c\u4e66\u7684\u81ea\u52a8\u6784\u5efa\u4e0d\u4f1a\u5361\u4f4f\uff0c\u6211\u4eec\u4f7f\u7528 ",(0,r.kt)("strong",{parentName:"p"},"TimedAbort")," \u7c7b\uff0c\u5728\u6b64\u5904\u5b9a\u4e49\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'// onjava/TimedAbort.java\n// Terminate a program after t seconds\npackage onjava;\nimport java.util.concurrent.*;\n\npublic class TimedAbort {\n  private volatile boolean restart = true;\n  public TimedAbort(double t, String msg) {\n    CompletableFuture.runAsync(() -> {\n      try {\n        while(restart) {\n          restart = false;\n          TimeUnit.MILLISECONDS\n            .sleep((int)(1000 * t));\n        }\n      } catch(InterruptedException e) {\n        throw new RuntimeException(e);\n      }\n      System.out.println(msg);\n      System.exit(0);\n    });\n  }\n  public TimedAbort(double t) {\n    this(t, "TimedAbort " + t);\n  }\n  public void restart() { restart = true; }\n}\n')),(0,r.kt)("p",null,"\u6211\u4eec\u4f7f\u7528 lambda \u8868\u8fbe\u5f0f\u521b\u5efa\u4e00\u4e2a ",(0,r.kt)("strong",{parentName:"p"},"Runnable")," \uff0c\u8be5\u8868\u8fbe\u5f0f\u4f7f\u7528 ",(0,r.kt)("strong",{parentName:"p"},"CompletableFuture")," \u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"runAsync()")," \u9759\u6001\u65b9\u6cd5\u6267\u884c\u3002  ",(0,r.kt)("inlineCode",{parentName:"p"},"runAsync()")," \u65b9\u6cd5\u7684\u503c\u4f1a\u7acb\u5373\u8fd4\u56de\u3002 \u56e0\u6b64\uff0c",(0,r.kt)("strong",{parentName:"p"},"TimedAbort")," \u4e0d\u4f1a\u4fdd\u6301\u4efb\u4f55\u6253\u5f00\u7684\u4efb\u52a1\uff0c\u5426\u5219\u5df2\u5b8c\u6210\u4efb\u52a1\uff0c\u4f46\u5982\u679c\u5b83\u9700\u8981\u592a\u957f\u65f6\u95f4\uff0c\u5b83\u4ecd\u5c06\u7ec8\u6b62\u8be5\u4efb\u52a1\uff08 ",(0,r.kt)("strong",{parentName:"p"},"TimedAbort")," \u6709\u65f6\u88ab\u79f0\u4e3a\u5b88\u62a4\u8fdb\u7a0b\uff09\u3002"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"TimedAbort")," \u8fd8\u5141\u8bb8\u4f60 ",(0,r.kt)("inlineCode",{parentName:"p"},"restart()")," \u65b9\u6cd5\u91cd\u542f\u4efb\u52a1\uff0c\u5728\u6709\u67d0\u4e9b\u6709\u7528\u7684\u6d3b\u52a8\u8fdb\u884c\u65f6\u4fdd\u6301\u7a0b\u5e8f\u6253\u5f00\u3002"),(0,r.kt)("p",null,"\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u6b63\u5728\u8fd0\u884c\u7684 ",(0,r.kt)("strong",{parentName:"p"},"TimedAbort")," \u793a\u4f8b:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'// lowlevel/TestAbort.java\nimport onjava.*;\n\npublic class TestAbort {\n  public static void main(String[] args) {\n    new TimedAbort(1);\n    System.out.println("Napping for 4");\n    new Nap(4);\n  }\n}\n/* Output:\nNapping for 4\nTimedAbort 1.0\n*/\n')),(0,r.kt)("p",null,"\u5982\u679c\u4f60\u6ce8\u91ca\u6389 ",(0,r.kt)("strong",{parentName:"p"},"Nap")," \u521b\u5efa\u5b9e\u5217\u90a3\u884c\uff0c\u7a0b\u5e8f\u6267\u884c\u4f1a\u7acb\u5373\u9000\u51fa\uff0c\u8868\u660e ",(0,r.kt)("strong",{parentName:"p"},"TimedAbort")," \u6ca1\u6709\u7ef4\u6301\u7a0b\u5e8f\u6253\u5f00\u3002"),(0,r.kt)("p",null,"\u6211\u4eec\u5c06\u770b\u5230\u7b2c\u4e00\u4e2a ",(0,r.kt)("strong",{parentName:"p"},"IntGenerator")," \u793a\u4f8b\u6709\u4e00\u4e2a\u751f\u6210\u4e00\u7cfb\u5217\u5076\u6570\u503c\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"next()")," \u65b9\u6cd5\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"// lowlevel/EvenProducer.java\n// When threads collide\n// {VisuallyInspectOutput}\n\npublic class EvenProducer extends IntGenerator {\n  private int currentEvenValue = 0;\n  @Override\n  public int next() {\n    ++currentEvenValue; // [1]\n    ++currentEvenValue;\n    return currentEvenValue;\n  }\n  public static void main(String[] args) {\n    EvenChecker.test(new EvenProducer());\n  }\n}\n/* Output:\n419 not even!\n425 not even!\n423 not even!\n421 not even!\n417 not even!\n*/\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"[1]"," \u4e00\u4e2a\u4efb\u52a1\u6709\u53ef\u80fd\u5728\u53e6\u5916\u4e00\u4e2a\u4efb\u52a1\u6267\u884c\u7b2c\u4e00\u4e2a\u5bf9 ",(0,r.kt)("strong",{parentName:"li"},"currentEvenValue")," \u7684\u81ea\u589e\u64cd\u4f5c\u4e4b\u540e\uff0c\u4f46\u662f\u6ca1\u6709\u6267\u884c\u7b2c\u4e8c\u4e2a\u64cd\u4f5c\u4e4b\u524d\uff0c\u8c03\u7528 ",(0,r.kt)("inlineCode",{parentName:"li"},"next()")," \u65b9\u6cd5\u3002\u8fd9\u5c06\u4f7f\u8fd9\u4e2a\u503c\u5904\u4e8e \u201c\u4e0d\u6070\u5f53\u201d \u7684\u72b6\u6001\u3002")),(0,r.kt)("p",null,"\u4e3a\u4e86\u8bc1\u660e\u8fd9\u662f\u53ef\u80fd\u53d1\u751f\u7684\uff0c ",(0,r.kt)("inlineCode",{parentName:"p"},"EvenChecker.test()")," \u521b\u5efa\u4e86\u4e00\u7ec4 ",(0,r.kt)("strong",{parentName:"p"},"EventChecker")," \u5bf9\u8c61\uff0c\u4ee5\u8fde\u7eed\u8bfb\u53d6 ",(0,r.kt)("strong",{parentName:"p"},"EvenProducer")," \u7684\u8f93\u51fa\u5e76\u6d4b\u8bd5\u68c0\u67e5\u6bcf\u4e2a\u6570\u503c\u662f\u5426\u90fd\u662f\u5076\u6570\u3002\u5982\u679c\u4e0d\u662f\uff0c\u5c31\u4f1a\u62a5\u544a\u9519\u8bef\uff0c\u800c\u7a0b\u5e8f\u4e5f\u5c06\u5173\u95ed\u3002"),(0,r.kt)("p",null,"\u591a\u7ebf\u7a0b\u7a0b\u5e8f\u7684\u90e8\u5206\u95ee\u9898\u662f\uff0c\u5373\u4f7f\u5b58\u5728 bug \uff0c\u5982\u679c\u5931\u8d25\u7684\u53ef\u80fd\u6027\u5f88\u4f4e\uff0c\u7a0b\u5e8f\u4ecd\u7136\u53ef\u4ee5\u6b63\u786e\u663e\u793a\u3002"),(0,r.kt)("p",null,"\u91cd\u8981\u7684\u662f\u8981\u6ce8\u610f\u5230\u81ea\u589e\u64cd\u4f5c\u81ea\u8eab\u9700\u8981\u591a\u4e2a\u6b65\u9aa4\uff0c\u5e76\u4e14\u5728\u81ea\u589e\u8fc7\u7a0b\u4e2d\u4efb\u52a1\u53ef\u80fd\u4f1a\u88ab\u7ebf\u7a0b\u673a\u5236\u6302\u8d77 - \u4e5f\u5c31\u662f\u8bf4\uff0c\u5728 Java \u4e2d\uff0c\u81ea\u589e\u4e0d\u662f\u539f\u5b50\u6027\u7684\u64cd\u4f5c\u3002\u56e0\u6b64\uff0c\u5982\u679c\u4e0d\u4fdd\u62a4\u4efb\u52a1\uff0c\u5373\u4f7f\u5355\u7eaf\u7684\u81ea\u589e\u4e5f\u4e0d\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\u3002"),(0,r.kt)("p",null,"\u8be5\u793a\u4f8b\u7a0b\u5e8f\u5e76\u4e0d\u603b\u662f\u5728\u7b2c\u4e00\u6b21\u975e\u5076\u6570\u4ea7\u751f\u65f6\u7ec8\u6b62\u3002\u6240\u6709\u4efb\u52a1\u90fd\u4e0d\u4f1a\u7acb\u5373\u5173\u95ed\uff0c\u8fd9\u662f\u5e76\u53d1\u7a0b\u5e8f\u7684\u5178\u578b\u7279\u5f81\u3002"),(0,r.kt)("h3",{id:"\u89e3\u51b3\u8d44\u6e90\u7ade\u4e89"},"\u89e3\u51b3\u8d44\u6e90\u7ade\u4e89"),(0,r.kt)("p",null,"\u524d\u9762\u7684\u793a\u4f8b\u63ed\u793a\u4e86\u5f53\u4f60\u4f7f\u7528\u7ebf\u7a0b\u65f6\u7684\u57fa\u672c\u95ee\u9898\uff1a\u4f60\u6c38\u8fdc\u4e0d\u77e5\u9053\u7ebf\u7a0b\u54ea\u4e2a\u65f6\u523b\u8fd0\u884c\u3002\u60f3\u8c61\u4e00\u4e0b\u5750\u5728\u4e00\u5f20\u684c\u5b50\u4e0a\uff0c\u7528\u53c9\u5b50\uff0c\u5c06\u6700\u540e\u4e00\u5757\u98df\u7269\u653e\u5728\u76d8\u5b50\u4e0a\uff0c\u5f53\u53c9\u5b50\u5230\u8fbe\u65f6\uff0c\u98df\u7269\u7a81\u7136\u6d88\u5931...\u4ec5\u56e0\u4e3a\u4f60\u7684\u7ebf\u7a0b\u88ab\u6302\u8d77\u800c\u53e6\u4e00\u4e2a\u7528\u9910\u8005\u8fdb\u6765\u5403\u4e86\u98df\u7269\u4e86\u3002\u8fd9\u5c31\u662f\u5728\u7f16\u5199\u5e76\u53d1\u7a0b\u5e8f\u65f6\u8981\u5904\u7406\u7684\u95ee\u9898\u3002\u4e3a\u4e86\u4f7f\u5e76\u53d1\u5de5\u4f5c\u6709\u6548\uff0c\u4f60\u9700\u8981\u67d0\u79cd\u65b9\u5f0f\u6765\u963b\u6b62\u4e24\u4e2a\u4efb\u52a1\u8bbf\u95ee\u540c\u4e00\u4e2a\u8d44\u6e90\uff0c\u81f3\u5c11\u5728\u5173\u952e\u65f6\u671f\u662f\u8fd9\u6837\u3002"),(0,r.kt)("p",null,"\u9632\u6b62\u8fd9\u79cd\u51b2\u7a81\u7684\u65b9\u6cd5\u5c31\u662f\u5f53\u8d44\u6e90\u88ab\u4e00\u4e2a\u4efb\u52a1\u4f7f\u7528\u65f6\uff0c\u5728\u5176\u4e0a\u52a0\u9501\u3002\u7b2c\u4e00\u4e2a\u8bbf\u95ee\u67d0\u9879\u8d44\u6e90\u7684\u4efb\u52a1\u5fc5\u987b\u9501\u5b9a\u8fd9\u9879\u8d44\u6e90\uff0c\u4f7f\u5176\u4ed6\u4efb\u52a1\u5728\u5176\u88ab\u89e3\u9501\u4e4b\u524d\uff0c\u5c31\u65e0\u6cd5\u8bbf\u95ee\u5b83\uff0c\u800c\u5728\u5176\u88ab\u89e3\u9501\u65f6\u5019\uff0c\u53e6\u4e00\u4e2a\u4efb\u52a1\u5c31\u53ef\u4ee5\u9501\u5b9a\u5e76\u4f7f\u7528\u5b83\uff0c\u4ee5\u6b64\u7c7b\u63a8\u3002\u5982\u679c\u6c7d\u8f66\u524d\u6392\u5ea7\u4f4d\u662f\u53d7\u9650\u8d44\u6e90\uff0c\u90a3\u4e48\u5927\u558a\u7740 \u201c\u51b2\u5440\u201d \u7684\u5b69\u5b50\u5c31\u4f1a\uff08\u5728\u8fd9\u6b21\u65c5\u9014\u8fc7\u7a0b\u4e2d\uff09\u83b7\u5f97\u8be5\u8d44\u6e90\u7684\u9501\u3002"),(0,r.kt)("p",null,"\u4e3a\u4e86\u89e3\u51b3\u7ebf\u7a0b\u51b2\u7a81\u7684\u95ee\u9898\uff0c\u57fa\u672c\u7684\u5e76\u53d1\u65b9\u6848\u5c06\u5e8f\u5217\u5316\u8bbf\u95ee\u5171\u4eab\u8d44\u6e90\u3002\u8fd9\u610f\u5473\u7740\u4e00\u6b21\u53ea\u5141\u8bb8\u4e00\u4e2a\u4efb\u52a1\u8bbf\u95ee\u5171\u4eab\u8d44\u6e90\u3002\u8fd9\u901a\u5e38\u662f\u901a\u8fc7\u5728\u8bbf\u95ee\u8d44\u6e90\u7684\u4ee3\u7801\u7247\u6bb5\u5468\u56f4\u52a0\u4e0a\u4e00\u4e2a\u5b50\u53e5\u6765\u5b9e\u73b0\u7684\uff0c\u8be5\u5b50\u53e5\u4e00\u6b21\u53ea\u5141\u8bb8\u4e00\u4e2a\u4efb\u52a1\u8bbf\u95ee\u8fd9\u6bb5\u4ee3\u7801\u3002\u56e0\u4e3a\u8fd9\u4e2a\u5b50\u53e5\u4ea7\u751f ",(0,r.kt)("em",{parentName:"p"},"\u4e92\u65a5")," \u6548\u679c\uff0c\u6240\u4ee5\u8fd9\u79cd\u673a\u5236\u7684\u901a\u5e38\u79f0\u4e3a\u662f ",(0,r.kt)("em",{parentName:"p"},"mutex")," \uff08\u4e92\u65a5\u91cf\uff09\u3002"),(0,r.kt)("p",null,"\u8003\u8651\u4e00\u4e0b\u5c4b\u5b50\u91cc\u7684\u6d74\u5ba4\uff1a\u591a\u4e2a\u4eba\uff08\u5373\u591a\u4e2a\u7531\u7ebf\u7a0b\u9a71\u52a8\u7684\u4efb\u52a1\uff09\u90fd\u5e0c\u671b\u80fd\u72ec\u7acb\u4f7f\u7528\u6d74\u5ba4\uff08\u5373\u5171\u4eab\u8d44\u6e90\uff09\u3002\u4e3a\u4e86\u4f7f\u7528\u6d74\u5ba4\uff0c\u4e00\u4e2a\u4eba\u5148\u6572\u95e8\u6765\u770b\u770b\u662f\u5426\u53ef\u7528\u3002\u5982\u679c\u6ca1\u4eba\u7684\u8bdd\uff0c\u4ed6\u5c31\u80fd\u8fdb\u5165\u6d74\u5ba4\u5e76\u9501\u4e0a\u95e8\u3002\u4efb\u4f55\u5176\u4ed6\u60f3\u4f7f\u7528\u6d74\u5ba4\u7684\u4efb\u52a1\u5c31\u4f1a\u88ab \u201c\u963b\u6321\u201d\uff0c\u56e0\u6b64\u8fd9\u4e9b\u4efb\u52a1\u5c31\u5728\u95e8\u53e3\u7b49\u5f85\uff0c\u76f4\u5230\u6d74\u5ba4\u662f\u53ef\u7528\u7684\u3002"),(0,r.kt)("p",null,"\u5f53\u6d74\u5ba4\u4f7f\u7528\u5b8c\u6bd5\uff0c\u5c31\u662f\u65f6\u5019\u7ed9\u5176\u4ed6\u4efb\u52a1\u8fdb\u5165\uff0c\u8fd9\u65f6\u6bd4\u55bb\u5c31\u6709\u70b9\u4e0d\u51c6\u786e\u4e86\u3002\u4e8b\u5b9e\u4e0a\u6ca1\u6709\u4eba\u6392\u961f\uff0c\u6211\u4eec\u4e5f\u4e0d\u77e5\u9053\u4e0b\u4e00\u4e2a\u4f7f\u7528\u6d74\u5ba4\u662f\u8c01\uff0c\u56e0\u4e3a\u7ebf\u7a0b\u8c03\u5ea6\u673a\u5236\u5e76\u4e0d\u662f\u786e\u5b9a\u6027\u7684\u3002\u76f8\u53cd\uff0c\u5c31\u597d\u50cf\u5728\u6d74\u5ba4\u524d\u9762\u6709\u4e00\u7ec4\u88ab\u963b\u6b62\u7684\u4efb\u52a1\u4e00\u6837\uff0c\u5f53\u9501\u5b9a\u6d74\u5ba4\u7684\u4efb\u52a1\u89e3\u9501\u5e76\u51fa\u73b0\u65f6\uff0c\u7ebf\u7a0b\u8c03\u5ea6\u673a\u5236\u5c06\u4f1a\u51b3\u5b9a\u4e0b\u4e00\u4e2a\u8981\u8fdb\u5165\u7684\u4efb\u52a1\u3002"),(0,r.kt)("p",null,"Java \u4ee5\u63d0\u4f9b\u5173\u952e\u5b57 ",(0,r.kt)("strong",{parentName:"p"},"synchronized")," \u7684\u5f62\u5f0f\uff0c\u4e3a\u9632\u6b62\u8d44\u6e90\u51b2\u7a81\u63d0\u4f9b\u4e86\u5185\u7f6e\u652f\u6301\u3002\u5f53\u4efb\u52a1\u5e0c\u671b\u6267\u884c\u88ab ",(0,r.kt)("strong",{parentName:"p"},"synchronized")," \u5173\u952e\u5b57\u4fdd\u62a4\u7684\u4ee3\u7801\u7247\u6bb5\u7684\u65f6\u5019\uff0cJava \u7f16\u8bd1\u5668\u4f1a\u751f\u6210\u4ee3\u7801\u4ee5\u67e5\u770b\u9501\u662f\u5426\u53ef\u7528\u3002\u5982\u679c\u53ef\u7528\uff0c\u8be5\u4efb\u52a1\u83b7\u53d6\u9501\uff0c\u6267\u884c\u4ee3\u7801\uff0c\u7136\u540e\u91ca\u653e\u9501\u3002"),(0,r.kt)("p",null,"\u5171\u4eab\u8d44\u6e90\u4e00\u822c\u662f\u4ee5\u5bf9\u8c61\u5f62\u5f0f\u5b58\u5728\u7684\u5185\u5b58\u7247\u6bb5\uff0c\u4f46\u4e5f\u53ef\u4ee5\u662f\u6587\u4ef6\u3001I/O \u7aef\u53e3\uff0c\u6216\u8005\u7c7b\u4f3c\u6253\u5370\u673a\u7684\u4e1c\u897f\u3002\u8981\u63a7\u5236\u5bf9\u5171\u4eab\u8d44\u6e90\u7684\u8bbf\u95ee\uff0c\u5f97\u5148\u628a\u5b83\u5305\u88c5\u8fdb\u4e00\u4e2a\u5bf9\u8c61\u3002\u7136\u540e\u628a\u4efb\u4f55\u8bbf\u95ee\u8be5\u8d44\u6e90\u7684\u65b9\u6cd5\u6807\u8bb0\u4e3a ",(0,r.kt)("strong",{parentName:"p"},"synchronized")," \u3002 \u5982\u679c\u4e00\u4e2a\u4efb\u52a1\u5728\u8c03\u7528\u5176\u4e2d\u4e00\u4e2a ",(0,r.kt)("strong",{parentName:"p"},"synchronized")," \u65b9\u6cd5\u4e4b\u5185\uff0c\u90a3\u4e48\u5728\u8fd9\u4e2a\u4efb\u52a1\u4ece\u8be5\u65b9\u6cd5\u8fd4\u56de\u4e4b\u524d\uff0c\u5176\u4ed6\u6240\u6709\u8981\u8c03\u7528\u8be5\u5bf9\u8c61\u7684 ",(0,r.kt)("strong",{parentName:"p"},"synchronized")," \u65b9\u6cd5\u7684\u4efb\u52a1\u90fd\u4f1a\u88ab\u963b\u585e\u3002"),(0,r.kt)("p",null,"\u901a\u5e38\u4f60\u4f1a\u5c06\u5b57\u6bb5\u8bbe\u4e3a ",(0,r.kt)("strong",{parentName:"p"},"private"),"\uff0c\u5e76\u4ec5\u901a\u8fc7\u65b9\u6cd5\u8bbf\u95ee\u8fd9\u4e9b\u5b57\u6bb5\u3002\u4f60\u53ef\u7528\u901a\u8fc7\u4f7f\u7528 ",(0,r.kt)("strong",{parentName:"p"},"synchronized")," \u5173\u952e\u5b57\u58f0\u660e\u65b9\u6cd5\u6765\u9632\u6b62\u8d44\u6e90\u51b2\u7a81\u3002\u5982\u4e0b\u6240\u793a\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"synchronized void f() { /* ... */ }\nsynchronized void g() { /* ... */ }\n")),(0,r.kt)("p",null,"\u6240\u6709\u5bf9\u8c61\u90fd\u81ea\u52a8\u5305\u542b\u72ec\u7acb\u7684\u9501\uff08\u4e5f\u79f0\u4e3a ",(0,r.kt)("em",{parentName:"p"},"monitor"),"\uff0c\u5373\u76d1\u89c6\u5668\uff09\u3002\u5f53\u4f60\u8c03\u7528\u5bf9\u8c61\u4e0a\u4efb\u4f55 ",(0,r.kt)("strong",{parentName:"p"},"synchronized")," \u65b9\u6cd5\uff0c\u6b64\u5bf9\u8c61\u5c06\u88ab\u52a0\u9501\uff0c\u5e76\u4e14\u8be5\u5bf9\u8c61\u4e0a\u7684\u7684\u5176\u4ed6 ",(0,r.kt)("strong",{parentName:"p"},"synchronized")," \u65b9\u6cd5\u8c03\u7528\u53ea\u6709\u7b49\u5230\u524d\u4e00\u4e2a\u65b9\u6cd5\u6267\u884c\u5b8c\u6210\u5e76\u91ca\u653e\u4e86\u9501\u4e4b\u540e\u624d\u80fd\u88ab\u8c03\u7528\u3002\u5982\u679c\u4e00\u4e2a\u4efb\u52a1\u5bf9\u5bf9\u8c61\u8c03\u7528\u4e86 ",(0,r.kt)("inlineCode",{parentName:"p"},"f()")," \uff0c\u5bf9\u4e8e\u540c\u4e00\u4e2a\u5bf9\u8c61\u800c\u8a00\uff0c\u5c31\u53ea\u80fd\u7b49\u5230 ",(0,r.kt)("inlineCode",{parentName:"p"},"f()")," \u8c03\u7528\u7ed3\u675f\u5e76\u91ca\u653e\u4e86\u9501\u4e4b\u540e\uff0c\u5176\u4ed6\u4efb\u52a1\u624d\u80fd\u8c03\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"f()")," \u548c ",(0,r.kt)("inlineCode",{parentName:"p"},"g()"),"\u3002\u6240\u4ee5\uff0c\u67d0\u4e2a\u7279\u5b9a\u5bf9\u8c61\u7684\u6240\u6709 ",(0,r.kt)("strong",{parentName:"p"},"synchronized")," \u65b9\u6cd5\u5171\u4eab\u540c\u4e00\u4e2a\u9501\uff0c\u8fd9\u4e2a\u9501\u53ef\u4ee5\u9632\u6b62\u591a\u4e2a\u4efb\u52a1\u540c\u65f6\u5199\u5165\u5bf9\u8c61\u5185\u5b58\u3002"),(0,r.kt)("p",null,"\u5728\u4f7f\u7528\u5e76\u53d1\u65f6\uff0c\u5c06\u5b57\u6bb5\u8bbe\u4e3a ",(0,r.kt)("strong",{parentName:"p"},"private")," \u7279\u522b\u91cd\u8981\uff1b\u5426\u5219\uff0c",(0,r.kt)("strong",{parentName:"p"},"synchronized")," \u5173\u952e\u5b57\u4e0d\u80fd\u963b\u6b62\u5176\u4ed6\u4efb\u52a1\u76f4\u63a5\u8bbf\u95ee\u5b57\u6bb5\uff0c\u4ece\u800c\u4ea7\u751f\u8d44\u6e90\u51b2\u7a81\u3002"),(0,r.kt)("p",null,"\u4e00\u4e2a\u7ebf\u7a0b\u53ef\u4ee5\u83b7\u53d6\u5bf9\u8c61\u7684\u9501\u591a\u6b21\u3002\u5982\u679c\u4e00\u4e2a\u65b9\u6cd5\u8c03\u7528\u5728\u540c\u4e00\u4e2a\u5bf9\u8c61\u4e0a\u7684\u7b2c\u4e8c\u4e2a\u65b9\u6cd5\uff0c\u800c\u540e\u8005\u53c8\u5728\u540c\u4e00\u4e2a\u5bf9\u8c61\u4e0a\u8c03\u7528\u53e6\u4e00\u4e2a\u65b9\u6cd5\uff0c\u5c31\u4f1a\u53d1\u751f\u8fd9\u79cd\u60c5\u51b5\u3002 JVM \u4f1a\u8ddf\u8e2a\u5bf9\u8c61\u88ab\u9501\u5b9a\u7684\u6b21\u6570\u3002\u5982\u679c\u5bf9\u8c61\u5df2\u89e3\u9501\uff0c\u5219\u5176\u8ba1\u6570\u4e3a 0 \u3002\u5f53\u4e00\u4e2a\u7ebf\u7a0b\u9996\u6b21\u83b7\u5f97\u9501\u65f6\uff0c\u8ba1\u6570\u53d8\u4e3a 1 \u3002\u6bcf\u6b21\u540c\u4e00\u7ebf\u7a0b\u5728\u540c\u4e00\u5bf9\u8c61\u4e0a\u83b7\u53d6\u53e6\u4e00\u4e2a\u9501\u65f6\uff0c\u8ba1\u6570\u5c31\u4f1a\u81ea\u589e\u3002\u663e\u7136\uff0c\u53ea\u6709\u9996\u5148\u83b7\u5f97\u9501\u7684\u7ebf\u7a0b\u624d\u5141\u8bb8\u591a\u6b21\u83b7\u53d6\u591a\u4e2a\u9501\u3002\u6bcf\u5f53\u7ebf\u7a0b\u79bb\u5f00 ",(0,r.kt)("strong",{parentName:"p"},"synchronized")," \u65b9\u6cd5\u65f6\uff0c\u8ba1\u6570\u9012\u51cf\uff0c\u76f4\u5230\u8ba1\u6570\u53d8\u4e3a 0 \uff0c\u5b8c\u5168\u91ca\u653e\u9501\u4ee5\u7ed9\u5176\u4ed6\u7ebf\u7a0b\u4f7f\u7528\u3002\u6bcf\u4e2a\u7c7b\u4e5f\u6709\u4e00\u4e2a\u9501\uff08\u4f5c\u4e3a\u8be5\u7c7b\u7684 ",(0,r.kt)("strong",{parentName:"p"},"Class")," \u5bf9\u8c61\u7684\u4e00\u90e8\u5206\uff09\uff0c\u56e0\u6b64 ",(0,r.kt)("strong",{parentName:"p"},"synchronized")," \u9759\u6001\u65b9\u6cd5\u53ef\u4ee5\u5728\u7c7b\u8303\u56f4\u7684\u57fa\u7840\u4e0a\u5f7c\u6b64\u9501\u5b9a\uff0c\u4e0d\u8ba9\u540c\u65f6\u8bbf\u95ee\u9759\u6001\u6570\u636e\u3002"),(0,r.kt)("p",null,"\u4f60\u5e94\u8be5\u4ec0\u4e48\u65f6\u5019\u4f7f\u7528\u540c\u6b65\u5462\uff1f\u53ef\u4ee5\u6c38\u8fdc ",(0,r.kt)("em",{parentName:"p"},"Brian")," \u7684\u540c\u6b65\u6cd5\u5219",(0,r.kt)("sup",{parentName:"p",id:"fnref-2"},(0,r.kt)("a",{parentName:"sup",href:"#fn-2",className:"footnote-ref"},"2")),"\u3002"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"\u5982\u679c\u4f60\u6b63\u5728\u5199\u4e00\u4e2a\u53d8\u91cf\uff0c\u5b83\u53ef\u80fd\u63a5\u4e0b\u6765\u88ab\u53e6\u4e00\u4e2a\u7ebf\u7a0b\u8bfb\u53d6\uff0c\u6216\u8005\u6b63\u5728\u8bfb\u53d6\u4e00\u4e2a\u4e0a\u4e00\u6b21\u5df2\u7ecf\u88ab\u53e6\u4e00\u4e2a\u7ebf\u7a0b\u5199\u8fc7\u7684\u53d8\u91cf\uff0c\u90a3\u4e48\u4f60\u5fc5\u987b\u4f7f\u7528\u540c\u6b65\uff0c\u5e76\u4e14\uff0c\u8bfb\u5199\u7ebf\u7a0b\u90fd\u5fc5\u987b\u7528\u76f8\u540c\u7684\u76d1\u89c6\u5668\u9501\u540c\u6b65\u3002")),(0,r.kt)("p",null,"\u5982\u679c\u5728\u4f60\u7684\u7c7b\u4e2d\u6709\u8d85\u8fc7\u4e00\u4e2a\u65b9\u6cd5\u5728\u5904\u7406\u4e34\u754c\u6570\u636e\uff0c\u90a3\u4e48\u4f60\u5fc5\u987b\u540c\u6b65\u6240\u6709\u76f8\u5173\u65b9\u6cd5\u3002\u5982\u679c\u53ea\u540c\u6b65\u5176\u4e2d\u4e00\u4e2a\u65b9\u6cd5\uff0c\u90a3\u4e48\u5176\u4ed6\u65b9\u6cd5\u53ef\u4ee5\u5ffd\u7565\u5bf9\u8c61\u9501\uff0c\u5e76\u4e14\u53ef\u4ee5\u4e0d\u53d7\u60e9\u7f5a\u5730\u8c03\u7528\u3002\u8fd9\u662f\u5f88\u91cd\u8981\u7684\u4e00\u70b9\uff1a\u6bcf\u4e2a\u8bbf\u95ee\u4e34\u754c\u5171\u4eab\u8d44\u6e90\u7684\u65b9\u6cd5\u90fd\u5fc5\u987b\u88ab\u540c\u6b65\uff0c\u5426\u5219\u5c06\u4e0d\u4f1a\u6b63\u786e\u5730\u5de5\u4f5c\u3002"),(0,r.kt)("h3",{id:"\u540c\u6b65\u63a7\u5236-eventproducer"},"\u540c\u6b65\u63a7\u5236 EventProducer"),(0,r.kt)("p",null,"\u901a\u8fc7\u5728 ",(0,r.kt)("strong",{parentName:"p"},"EvenProducer.java")," \u6587\u4ef6\u4e2d\u6dfb\u52a0 ",(0,r.kt)("strong",{parentName:"p"},"synchronized")," \u5173\u952e\u5b57\uff0c\u53ef\u4ee5\u9632\u6b62\u4e0d\u5e0c\u671b\u7684\u7ebf\u7a0b\u8bbf\u95ee\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"// lowlevel/SynchronizedEvenProducer.java\n// Simplifying mutexes with the synchronized keyword\nimport onjava.Nap;\n\npublic class\nSynchronizedEvenProducer extends IntGenerator {\n  private int currentEvenValue = 0;\n  @Override\n  public synchronized int next() {\n    ++currentEvenValue;\n    new Nap(0.01); // Cause failure faster\n    ++currentEvenValue;\n    return currentEvenValue;\n  }\n  public static void main(String[] args) {\n    EvenChecker.test(new SynchronizedEvenProducer());\n  }\n}\n/* Output:\nNo odd numbers discovered\n*/\n")),(0,r.kt)("p",null,"\u5728\u4e24\u4e2a\u81ea\u589e\u64cd\u4f5c\u4e4b\u95f4\u63d2\u5165 ",(0,r.kt)("inlineCode",{parentName:"p"},"Nap()")," \u6784\u9020\u5668\u65b9\u6cd5\uff0c\u4ee5\u63d0\u9ad8\u5728 ",(0,r.kt)("strong",{parentName:"p"},"currentEvenValue")," \u662f\u5947\u6570\u7684\u72b6\u6001\u65f6\u4e0a\u4e0b\u6587\u5207\u6362\u7684\u53ef\u80fd\u6027\u3002\u56e0\u4e3a\u4e92\u65a5\u9501\u53ef\u4ee5\u963b\u6b62\u591a\u4e2a\u4efb\u52a1\u540c\u65f6\u8fdb\u5165\u4e34\u754c\u533a\uff0c\u6240\u6709\u8fd9\u4e0d\u4f1a\u4ea7\u751f\u5931\u8d25\u3002\u7b2c\u4e00\u4e2a\u8fdb\u5165 ",(0,r.kt)("inlineCode",{parentName:"p"},"next()")," \u65b9\u6cd5\u7684\u4efb\u52a1\u5c06\u83b7\u5f97\u9501\uff0c\u4efb\u4f55\u8bd5\u56fe\u83b7\u53d6\u9501\u7684\u540e\u7eed\u4efb\u52a1\u90fd\u5c06\u88ab\u963b\u585e\uff0c\u76f4\u5230\u7b2c\u4e00\u4e2a\u4efb\u52a1\u91ca\u653e\u9501\u3002\u6b64\u65f6\uff0c\u8c03\u5ea6\u673a\u5236\u9009\u62e9\u53e6\u4e00\u4e2a\u7b49\u5f85\u9501\u7684\u4efb\u52a1\u3002\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\uff0c\u4efb\u4f55\u65f6\u523b\u53ea\u80fd\u6709\u4e00\u4e2a\u4efb\u52a1\u901a\u8fc7\u4e92\u65a5\u9501\u4fdd\u62a4\u7684\u4ee3\u7801\u3002"),(0,r.kt)("h2",{id:"volatile-\u5173\u952e\u5b57"},"volatile \u5173\u952e\u5b57"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"volatile")," \u53ef\u80fd\u662f Java \u4e2d\u6700\u5fae\u5999\u548c\u6700\u96be\u7528\u7684\u5173\u952e\u5b57\u3002\u5e78\u8fd0\u7684\u662f\uff0c\u5728\u73b0\u4ee3 Java \u4e2d\uff0c\u4f60\u51e0\u4e4e\u603b\u80fd\u907f\u514d\u4f7f\u7528\u5b83\uff0c\u5982\u679c\u4f60\u786e\u5b9e\u770b\u5230\u5b83\u5728\u4ee3\u7801\u4e2d\u4f7f\u7528\uff0c\u4f60\u5e94\u8be5\u4fdd\u6301\u6000\u7591\u6001\u5ea6\u548c\u6000\u7591 - \u8fd9\u5f88\u6709\u53ef\u80fd\u4ee3\u7801\u662f\u8fc7\u65f6\u7684\uff0c\u6216\u8005\u7f16\u5199\u4ee3\u7801\u7684\u4eba\u4e0d\u6e05\u695a\u4f7f\u7528\u5b83\u5728\u5927\u4f53\u4e0a\uff08\u6216\u4e24\u8005\u90fd\u6709\uff09\u6613\u53d8\u6027\uff08",(0,r.kt)("strong",{parentName:"p"},"volatile"),"\uff09 \u6216\u5e76\u53d1\u6027\u7684\u540e\u679c\u3002"),(0,r.kt)("p",null,"\u4f7f\u7528 ",(0,r.kt)("strong",{parentName:"p"},"volatile")," \u6709\u4e09\u4e2a\u7406\u7531\u3002"),(0,r.kt)("h3",{id:"\u5b57\u5206\u88c2"},"\u5b57\u5206\u88c2"),(0,r.kt)("p",null,"\u5f53\u4f60\u7684 Java \u6570\u636e\u7c7b\u578b\u8db3\u591f\u5927\uff08\u5728 Java \u4e2d ",(0,r.kt)("strong",{parentName:"p"},"long")," \u548c ",(0,r.kt)("strong",{parentName:"p"},"double")," \u7c7b\u578b\u90fd\u662f 64 \u4f4d\uff09\uff0c\u5199\u5165\u53d8\u91cf\u7684\u8fc7\u7a0b\u5206\u4e24\u6b65\u8fdb\u884c\uff0c\u5c31\u4f1a\u53d1\u751f ",(0,r.kt)("em",{parentName:"p"},"Word tearing")," \uff08\u5b57\u5206\u88c2\uff09\u60c5\u51b5\u3002 JVM \u88ab\u5141\u8bb8\u5c0664\u4f4d\u6570\u91cf\u7684\u8bfb\u5199\u4f5c\u4e3a\u4e24\u4e2a\u5355\u72ec\u768432\u4f4d\u64cd\u4f5c\u6267\u884c",(0,r.kt)("sup",{parentName:"p",id:"fnref-3"},(0,r.kt)("a",{parentName:"sup",href:"#fn-3",className:"footnote-ref"},"3")),"\uff0c\u8fd9\u589e\u52a0\u4e86\u5728\u8bfb\u5199\u8fc7\u7a0b\u4e2d\u53d1\u751f\u4e0a\u4e0b\u6587\u5207\u6362\u7684\u53ef\u80fd\u6027\uff0c\u56e0\u6b64\u5176\u4ed6\u4efb\u52a1\u4f1a\u770b\u5230\u4e0d\u6b63\u786e\u7684\u7ed3\u679c\u3002\u8fd9\u88ab\u79f0\u4e3a ",(0,r.kt)("em",{parentName:"p"},"Word tearing")," \uff08\u5b57\u5206\u88c2\uff09\uff0c\u56e0\u4e3a\u4f60\u53ef\u80fd\u53ea\u770b\u5230\u5176\u4e2d\u4e00\u90e8\u5206\u4fee\u6539\u540e\u7684\u503c\u3002\u57fa\u672c\u4e0a\uff0c\u4efb\u52a1\u6709\u65f6\u53ef\u4ee5\u5728\u7b2c\u4e00\u6b65\u4e4b\u540e\u4f46\u5728\u7b2c\u4e8c\u6b65\u4e4b\u524d\u8bfb\u53d6\u53d8\u91cf\uff0c\u4ece\u800c\u4ea7\u751f\u5783\u573e\u503c\uff08\u5bf9\u4e8e\u4f8b\u5982 ",(0,r.kt)("strong",{parentName:"p"},"boolean")," \u6216 ",(0,r.kt)("strong",{parentName:"p"},"int")," \u7c7b\u578b\u7684\u5c0f\u53d8\u91cf\u662f\u6ca1\u6709\u95ee\u9898\u7684\uff1b\u4efb\u4f55 ",(0,r.kt)("strong",{parentName:"p"},"long")," \u6216 ",(0,r.kt)("strong",{parentName:"p"},"double")," \u7c7b\u578b\u5219\u9664\u5916\uff09\u3002"),(0,r.kt)("p",null,"\u5728\u7f3a\u4e4f\u4efb\u4f55\u5176\u4ed6\u4fdd\u62a4\u7684\u60c5\u51b5\u4e0b\uff0c\u7528 ",(0,r.kt)("strong",{parentName:"p"},"volatile")," \u4fee\u9970\u7b26\u5b9a\u4e49\u4e00\u4e2a ",(0,r.kt)("strong",{parentName:"p"},"long")," \u6216 ",(0,r.kt)("strong",{parentName:"p"},"double")," \u53d8\u91cf\uff0c\u53ef\u963b\u6b62\u5b57\u5206\u88c2\u60c5\u51b5\u3002\u7136\u800c\uff0c\u5982\u679c\u4f7f\u7528 ",(0,r.kt)("strong",{parentName:"p"},"synchronized")," \u6216 ",(0,r.kt)("strong",{parentName:"p"},"java.util.concurrent.atomic")," \u7c7b\u4e4b\u4e00\u4fdd\u62a4\u8fd9\u4e9b\u53d8\u91cf\uff0c\u5219 ",(0,r.kt)("strong",{parentName:"p"},"volatile")," \u5c06\u88ab\u53d6\u4ee3\u3002\u6b64\u5916\uff0c",(0,r.kt)("strong",{parentName:"p"},"volatile")," \u4e0d\u4f1a\u5f71\u54cd\u5230\u589e\u91cf\u64cd\u4f5c\u5e76\u4e0d\u662f\u539f\u5b50\u64cd\u4f5c\u7684\u4e8b\u5b9e\u3002"),(0,r.kt)("h3",{id:"\u53ef\u89c1\u6027"},"\u53ef\u89c1\u6027"),(0,r.kt)("p",null,"\u7b2c\u4e8c\u4e2a\u95ee\u9898\u5c5e\u4e8e ",(0,r.kt)("a",{parentName:"p",href:"./Concurrent-Programming#%E5%9B%9B%E5%8F%A5%E6%A0%BC%E8%A8%80"},"Java \u5e76\u53d1\u7684\u56db\u53e5\u683c\u8a00"),"\u91cc\u7b2c\u4e8c\u53e5\u683c\u8a00 \u201c\u4e00\u5207\u90fd\u91cd\u8981\u201d \u7684\u90e8\u5206\u3002\u4f60\u5fc5\u987b\u5047\u8bbe\u6bcf\u4e2a\u4efb\u52a1\u62e5\u6709\u81ea\u5df1\u7684\u5904\u7406\u5668\uff0c\u5e76\u4e14\u6bcf\u4e2a\u5904\u7406\u5668\u90fd\u6709\u81ea\u5df1\u7684\u672c\u5730\u5185\u5b58\u7f13\u5b58\u3002\u8be5\u7f13\u5b58\u51c6\u8bb8\u5904\u7406\u5668\u8fd0\u884c\u7684\u66f4\u5feb\uff0c\u56e0\u4e3a\u5904\u7406\u5668\u5e76\u4e0d\u603b\u662f\u9700\u8981\u4ece\u6bd4\u8d77\u4f7f\u7528\u7f13\u5b58\u663e\u8457\u82b1\u8d39\u66f4\u591a\u65f6\u95f4\u7684\u4e3b\u5185\u5b58\u4e2d\u83b7\u53d6\u6570\u636e\u3002"),(0,r.kt)("p",null,"\u51fa\u73b0\u8fd9\u4e2a\u95ee\u9898\u662f\u56e0\u4e3a Java \u5c1d\u8bd5\u5c3d\u53ef\u80fd\u5730\u63d0\u9ad8\u6267\u884c\u6548\u7387\u3002\u7f13\u5b58\u7684\u4e3b\u8981\u76ee\u7684\u662f\u907f\u514d\u4ece\u4e3b\u5185\u5b58\u4e2d\u8bfb\u53d6\u6570\u636e\u3002\u5f53\u5e76\u53d1\u65f6\uff0c\u6709\u65f6\u4e0d\u6e05\u695a Java \u4ec0\u4e48\u65f6\u5019\u5e94\u8be5\u5c06\u503c\u4ece\u4e3b\u5185\u5b58\u5237\u65b0\u5230\u672c\u5730\u7f13\u5b58 \u2014 \u800c\u8fd9\u4e2a\u95ee\u9898\u79f0\u4e3a ",(0,r.kt)("em",{parentName:"p"},"\u7f13\u5b58\u4e00\u81f4\u6027")," \uff08 ",(0,r.kt)("em",{parentName:"p"},"cache coherence")," \uff09\u3002"),(0,r.kt)("p",null,"\u6bcf\u4e2a\u7ebf\u7a0b\u90fd\u53ef\u4ee5\u5728\u5904\u7406\u5668\u7f13\u5b58\u4e2d\u5b58\u50a8\u53d8\u91cf\u7684\u672c\u5730\u526f\u672c\u3002\u5c06\u5b57\u6bb5\u5b9a\u4e49\u4e3a ",(0,r.kt)("strong",{parentName:"p"},"volatile")," \u53ef\u4ee5\u9632\u6b62\u8fd9\u4e9b\u7f16\u8bd1\u5668\u4f18\u5316\uff0c\u8fd9\u6837\u8bfb\u5199\u5c31\u53ef\u4ee5\u76f4\u63a5\u8fdb\u5165\u5185\u5b58\uff0c\u800c\u4e0d\u4f1a\u88ab\u7f13\u5b58\u3002\u4e00\u65e6\u8be5\u5b57\u6bb5\u53d1\u751f\u5199\u64cd\u4f5c\uff0c\u6240\u6709\u4efb\u52a1\u7684\u8bfb\u64cd\u4f5c\u90fd\u5c06\u770b\u5230\u66f4\u6539\u3002\u5982\u679c\u4e00\u4e2a ",(0,r.kt)("strong",{parentName:"p"},"volatile")," \u5b57\u6bb5\u521a\u597d\u5b58\u50a8\u5728\u672c\u5730\u7f13\u5b58\uff0c\u5219\u4f1a\u7acb\u5373\u5c06\u5176\u5199\u5165\u4e3b\u5185\u5b58\uff0c\u5e76\u4e14\u8be5\u5b57\u6bb5\u7684\u4efb\u4f55\u8bfb\u53d6\u90fd\u59cb\u7ec8\u53d1\u751f\u5728\u4e3b\u5185\u5b58\u4e2d\u3002"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"volatile")," \u5e94\u8be5\u5728\u4f55\u65f6\u9002\u7528\u4e8e\u53d8\u91cf\uff1a"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u8be5\u53d8\u91cf\u540c\u65f6\u88ab\u591a\u4e2a\u4efb\u52a1\u8bbf\u95ee\u3002"),(0,r.kt)("li",{parentName:"ol"},"\u8fd9\u4e9b\u8bbf\u95ee\u4e2d\u81f3\u5c11\u6709\u4e00\u4e2a\u662f\u5199\u64cd\u4f5c\u3002"),(0,r.kt)("li",{parentName:"ol"},"\u4f60\u5c1d\u8bd5\u907f\u514d\u540c\u6b65 \uff08\u5728\u73b0\u4ee3 Java \u4e2d\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528\u9ad8\u7ea7\u5de5\u5177\u6765\u907f\u514d\u8fdb\u884c\u540c\u6b65\uff09\u3002")),(0,r.kt)("p",null,"\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5982\u679c\u4f60\u4f7f\u7528\u53d8\u91cf\u4f5c\u4e3a\u505c\u6b62\u4efb\u52a1\u7684\u6807\u5fd7\u503c\u3002\u90a3\u4e48\u8be5\u53d8\u91cf\u81f3\u5c11\u5fc5\u987b\u58f0\u660e\u4e3a ",(0,r.kt)("strong",{parentName:"p"},"volatile")," \uff08\u5c3d\u7ba1\u8fd9\u5e76\u4e0d\u4e00\u5b9a\u80fd\u4fdd\u8bc1\u8fd9\u79cd\u6807\u5fd7\u7684\u7ebf\u7a0b\u5b89\u5168\uff09\u3002\u5426\u5219\uff0c\u5f53\u4e00\u4e2a\u4efb\u52a1\u66f4\u6539\u6807\u5fd7\u503c\u65f6\uff0c\u8fd9\u4e9b\u66f4\u6539\u53ef\u4ee5\u5b58\u50a8\u5728\u672c\u5730\u5904\u7406\u5668\u7f13\u5b58\u4e2d\uff0c\u800c\u4e0d\u4f1a\u5237\u65b0\u5230\u4e3b\u5185\u5b58\u3002\u5f53\u53e6\u4e00\u4e2a\u4efb\u52a1\u67e5\u770b\u6807\u8bb0\u503c\u65f6\uff0c\u5b83\u4e0d\u4f1a\u770b\u5230\u66f4\u6539\u3002\u6211\u66f4\u559c\u6b22\u5728 ",(0,r.kt)("a",{parentName:"p",href:"./Concurrent-Programming"},"\u5e76\u53d1\u7f16\u7a0b")," \u4e2d ",(0,r.kt)("a",{parentName:"p",href:"./Concurrent-Programming#%E7%BB%88%E6%AD%A2%E8%80%97%E6%97%B6%E4%BB%BB%E5%8A%A1"},"\u7ec8\u6b62\u8017\u65f6\u4efb\u52a1")," \u7ae0\u8282\u4e2d\u4f7f\u7528 ",(0,r.kt)("strong",{parentName:"p"},"AtomicBoolean")," \u7c7b\u578b\u4f5c\u4e3a\u6807\u5fd7\u503c\u7684\u529e\u6cd5"),(0,r.kt)("p",null,"\u4efb\u52a1\u5bf9\u5176\u81ea\u8eab\u53d8\u91cf\u6240\u505a\u7684\u4efb\u4f55\u5199\u64cd\u4f5c\u90fd\u59cb\u7ec8\u5bf9\u8be5\u4efb\u52a1\u53ef\u89c1\uff0c\u56e0\u6b64\uff0c\u5982\u679c\u53ea\u5728\u4efb\u52a1\u4e2d\u4f7f\u7528\u53d8\u91cf\uff0c\u4f60\u4e0d\u9700\u8981\u4f7f\u5176\u53d8\u91cf\u58f0\u660e\u4e3a ",(0,r.kt)("strong",{parentName:"p"},"volatile")," \u3002"),(0,r.kt)("p",null,"\u5982\u679c\u5355\u4e2a\u7ebf\u7a0b\u5bf9\u53d8\u91cf\u5199\u5165\u800c\u5176\u4ed6\u7ebf\u7a0b\u53ea\u8bfb\u53d6\u5b83\uff0c\u4f60\u53ef\u4ee5\u653e\u5f03\u8be5\u53d8\u91cf\u58f0\u660e\u4e3a ",(0,r.kt)("strong",{parentName:"p"},"volatile"),"\u3002\u901a\u5e38\uff0c\u5982\u679c\u4f60\u6709\u591a\u4e2a\u7ebf\u7a0b\u5bf9\u53d8\u91cf\u5199\u5165\uff0c",(0,r.kt)("strong",{parentName:"p"},"volatile")," \u65e0\u6cd5\u89e3\u51b3\u4f60\u7684\u95ee\u9898\uff0c\u5e76\u4e14\u4f60\u5fc5\u987b\u4f7f\u7528 ",(0,r.kt)("strong",{parentName:"p"},"synchronized")," \u6765\u9632\u6b62\u7ade\u4e89\u6761\u4ef6\u3002 \u8fd9\u6709\u4e00\u4e2a\u7279\u6b8a\u7684\u4f8b\u5916\uff1a\u53ef\u4ee5\u8ba9\u591a\u4e2a\u7ebf\u7a0b\u5bf9\u8be5\u53d8\u91cf\u5199\u5165\uff0c",(0,r.kt)("em",{parentName:"p"},"\u53ea\u8981\u5b83\u4eec\u4e0d\u9700\u8981\u5148\u8bfb\u53d6\u5b83\u5e76\u4f7f\u7528\u8be5\u503c\u521b\u5efa\u65b0\u503c\u6765\u5199\u5165\u53d8\u91cf")," \u3002\u5982\u679c\u8fd9\u4e9b\u591a\u4e2a\u7ebf\u7a0b\u5728\u7ed3\u679c\u4e2d\u4f7f\u7528\u65e7\u503c\uff0c\u5219\u4f1a\u51fa\u73b0\u7ade\u4e89\u6761\u4ef6\uff0c\u56e0\u4e3a\u5176\u4f59\u4e00\u4e2a\u7ebf\u7a0b\u4e4b\u4e00\u53ef\u80fd\u4f1a\u5728\u4f60\u7684\u7ebf\u7a0b\u8fdb\u884c\u8ba1\u7b97\u65f6\u4fee\u6539\u8be5\u53d8\u91cf\u3002\u5373\u4f7f\u4f60\u5f00\u59cb\u505a\u5bf9\u4e86\uff0c\u60f3\u8c61\u4e00\u4e0b\u5728\u4ee3\u7801\u4fee\u6539\u6216\u7ef4\u62a4\u8fc7\u7a0b\u4e2d\u5fd8\u8bb0\u548c\u5f15\u5165\u4e00\u4e2a\u91cd\u5927\u53d8\u5316\u662f\u591a\u4e48\u5bb9\u6613\uff0c\u6216\u8005\u5bf9\u4e8e\u4e0d\u7406\u89e3\u95ee\u9898\u7684\u4e0d\u540c\u7a0b\u5e8f\u5458\u6765\u8bf4\u662f\u591a\u4e48\u5bb9\u6613\uff08\u8fd9\u5728 Java \u4e2d\u5c24\u5176\u6210\u95ee\u9898\u56e0\u4e3a\u7a0b\u5e8f\u5458\u503e\u5411\u4e8e\u4e25\u91cd\u4f9d\u8d56\u7f16\u8bd1\u65f6\u68c0\u67e5\u6765\u544a\u8bc9\u4ed6\u4eec\uff0c\u4ed6\u4eec\u7684\u4ee3\u7801\u662f\u5426\u6b63\u786e\uff09\u3002"),(0,r.kt)("p",null,"\u91cd\u8981\u7684\u662f\u8981\u7406\u89e3\u539f\u5b50\u6027\u548c\u53ef\u89c1\u6027\u662f\u4e24\u4e2a\u4e0d\u540c\u7684\u6982\u5ff5\u3002\u5728\u975e ",(0,r.kt)("strong",{parentName:"p"},"volatile")," \u53d8\u91cf\u4e0a\u7684\u539f\u5b50\u64cd\u4f5c\u662f\u4e0d\u80fd\u4fdd\u8bc1\u662f\u5426\u5c06\u5176\u5237\u65b0\u5230\u4e3b\u5185\u5b58\u3002"),(0,r.kt)("p",null,"\u540c\u6b65\u4e5f\u4f1a\u8ba9\u4e3b\u5185\u5b58\u5237\u65b0\uff0c\u6240\u4ee5\u5982\u679c\u4e00\u4e2a\u53d8\u91cf\u5b8c\u5168\u7531 ",(0,r.kt)("strong",{parentName:"p"},"synchronized")," \u7684\u65b9\u6cd5\u6216\u4ee3\u7801\u6bb5(\u6216\u8005 ",(0,r.kt)("strong",{parentName:"p"},"java.util.concurrent.atomic")," \u5e93\u91cc\u7c7b\u578b\u4e4b\u4e00)\u6240\u4fdd\u62a4\uff0c\u5219\u4e0d\u9700\u8981\u8ba9\u53d8\u91cf\u7528 ",(0,r.kt)("strong",{parentName:"p"},"volatile"),"\u3002"),(0,r.kt)("h3",{id:"\u91cd\u6392\u4e0e-happen-before-\u539f\u5219"},"\u91cd\u6392\u4e0e ",(0,r.kt)("em",{parentName:"h3"},"Happen-Before")," \u539f\u5219"),(0,r.kt)("p",null,"\u53ea\u8981\u7ed3\u679c\u4e0d\u4f1a\u6539\u53d8\u7a0b\u5e8f\u8868\u73b0\uff0cJava \u53ef\u4ee5\u901a\u8fc7\u91cd\u6392\u6307\u4ee4\u6765\u4f18\u5316\u6027\u80fd\u3002\u7136\u800c\uff0c\u91cd\u6392\u53ef\u80fd\u4f1a\u5f71\u54cd\u672c\u5730\u5904\u7406\u5668\u7f13\u5b58\u4e0e\u4e3b\u5185\u5b58\u4ea4\u4e92\u7684\u65b9\u5f0f\uff0c\u4ece\u800c\u4ea7\u751f\u7ec6\u5fae\u7684\u7a0b\u5e8f bug \u3002\u76f4\u5230 Java 5 \u624d\u7406\u89e3\u5e76\u89e3\u51b3\u4e86\u8fd9\u4e2a\u65e0\u6cd5\u963b\u6b62\u91cd\u6392\u7684\u95ee\u9898\u3002\u73b0\u5728\uff0c",(0,r.kt)("strong",{parentName:"p"},"volatile")," \u5173\u952e\u5b57\u53ef\u4ee5\u963b\u6b62\u91cd\u6392 ",(0,r.kt)("strong",{parentName:"p"},"volatile")," \u53d8\u91cf\u5468\u56f4\u7684\u8bfb\u5199\u6307\u4ee4\u3002\u8fd9\u79cd\u91cd\u6392\u89c4\u5219\u79f0\u4e3a ",(0,r.kt)("em",{parentName:"p"},"happens before")," \u62c5\u4fdd\u539f\u5219 \u3002"),(0,r.kt)("p",null,"\u8fd9\u9879\u539f\u5219\u4fdd\u8bc1\u5728 ",(0,r.kt)("strong",{parentName:"p"},"volatile")," \u53d8\u91cf\u8bfb\u5199\u4e4b\u524d\u53d1\u751f\u7684\u6307\u4ee4\u5148\u4e8e\u5b83\u4eec\u7684\u8bfb\u5199\u4e4b\u524d\u53d1\u751f\u3002\u540c\u6837\uff0c\u4efb\u4f55\u8ddf\u968f ",(0,r.kt)("strong",{parentName:"p"},"volatile")," \u53d8\u91cf\u4e4b\u540e\u8bfb\u5199\u7684\u64cd\u4f5c\u90fd\u4fdd\u8bc1\u53d1\u751f\u5728\u5b83\u4eec\u7684\u8bfb\u5199\u4e4b\u540e\u3002\u4f8b\u5982\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"// lowlevel/ReOrdering.java\n\npublic class ReOrdering implements Runnable {\n  int one, two, three, four, five, six;\n  volatile int volaTile;\n  @Override\n  public void run() {\n    one = 1;\n    two = 2;\n    three = 3;\n    volaTile = 92;\n    int x = four;\n    int y = five;\n    int z = six;\n  }\n}\n")),(0,r.kt)("p",null,"\u4f8b\u5b50\u4e2d ",(0,r.kt)("strong",{parentName:"p"},"one"),"\uff0c",(0,r.kt)("strong",{parentName:"p"},"two"),"\uff0c",(0,r.kt)("strong",{parentName:"p"},"three")," \u53d8\u91cf\u8d4b\u503c\u64cd\u4f5c\u5c31\u53ef\u4ee5\u88ab\u91cd\u6392\uff0c\u53ea\u8981\u5b83\u4eec\u90fd\u53d1\u751f\u5728 ",(0,r.kt)("strong",{parentName:"p"},"volatile")," \u53d8\u91cf\u5199\u64cd\u4f5c\u4e4b\u524d\u3002\u540c\u6837\uff0c\u53ea\u8981 ",(0,r.kt)("strong",{parentName:"p"},"volatile")," \u53d8\u91cf\u5199\u64cd\u4f5c\u53d1\u751f\u5728\u6240\u6709\u8bed\u53e5\u4e4b\u524d\uff0c ",(0,r.kt)("strong",{parentName:"p"},"x"),"\uff0c",(0,r.kt)("strong",{parentName:"p"},"y"),"\uff0c",(0,r.kt)("strong",{parentName:"p"},"z")," \u8bed\u53e5\u53ef\u4ee5\u88ab\u91cd\u6392\u3002\u8fd9\u79cd ",(0,r.kt)("strong",{parentName:"p"},"volatile")," \uff08\u6613\u53d8\u6027\uff09\u64cd\u4f5c\u901a\u5e38\u79f0\u4e3a ",(0,r.kt)("em",{parentName:"p"},"memory barrier")," \uff08\u5185\u5b58\u5c4f\u969c\uff09\u3002 ",(0,r.kt)("em",{parentName:"p"},"happens before")," \u62c5\u4fdd\u539f\u5219\u786e\u4fdd ",(0,r.kt)("strong",{parentName:"p"},"volatile")," \u53d8\u91cf\u7684\u8bfb\u5199\u6307\u4ee4\u4e0d\u80fd\u8de8\u8fc7\u5185\u5b58\u5c4f\u969c\u8fdb\u884c\u91cd\u6392\u3002"),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"happens before")," \u62c5\u4fdd\u539f\u5219\u8fd8\u6709\u53e6\u4e00\u4e2a\u4f5c\u7528\uff1a\u5f53\u7ebf\u7a0b\u5411\u4e00\u4e2a ",(0,r.kt)("strong",{parentName:"p"},"volatile")," \u53d8\u91cf\u5199\u5165\u65f6\uff0c\u5728\u7ebf\u7a0b\u5199\u5165\u4e4b\u524d\u7684\u5176\u4ed6\u6240\u6709\u53d8\u91cf\uff08\u5305\u62ec\u975e ",(0,r.kt)("strong",{parentName:"p"},"volatile")," \u53d8\u91cf\uff09\u4e5f\u4f1a\u5237\u65b0\u5230\u4e3b\u5185\u5b58\u3002\u5f53\u7ebf\u7a0b\u8bfb\u53d6\u4e00\u4e2a ",(0,r.kt)("strong",{parentName:"p"},"volatile")," \u53d8\u91cf\u65f6\uff0c\u5b83\u4e5f\u4f1a\u8bfb\u53d6\u5176\u4ed6\u6240\u6709\u53d8\u91cf\uff08\u5305\u62ec\u975e ",(0,r.kt)("strong",{parentName:"p"},"volatile")," \u53d8\u91cf\uff09\u4e0e ",(0,r.kt)("strong",{parentName:"p"},"volatile")," \u53d8\u91cf\u4e00\u8d77\u5237\u65b0\u5230\u4e3b\u5185\u5b58\u3002\u5c3d\u7ba1\u8fd9\u662f\u4e00\u4e2a\u91cd\u8981\u7684\u7279\u6027\uff0c\u5b83\u89e3\u51b3\u4e86 Java 5 \u7248\u672c\u4e4b\u524d\u51fa\u73b0\u7684\u4e00\u4e9b\u975e\u5e38\u72e1\u733e\u7684 bug \uff0c\u4f46\u662f\u4f60\u4e0d\u5e94\u8be5\u4f9d\u8d56\u8fd9\u9879\u7279\u6027\u6765\u201c\u81ea\u52a8\u201d\u4f7f\u5468\u56f4\u7684\u53d8\u91cf\u53d8\u5f97\u6613\u53d8\u6027 \uff08 ",(0,r.kt)("strong",{parentName:"p"},"volatile")," \uff09\u7684 \u3002\u5982\u679c\u4f60\u5e0c\u671b\u53d8\u91cf\u662f\u6613\u53d8\u6027 \uff08 ",(0,r.kt)("strong",{parentName:"p"},"volatile")," \uff09\u7684\uff0c\u90a3\u4e48\u7ef4\u62a4\u4ee3\u7801\u7684\u4efb\u4f55\u4eba\u90fd\u5e94\u8be5\u6e05\u695a\u8fd9\u4e00\u70b9\u3002"),(0,r.kt)("h3",{id:"\u4ec0\u4e48\u65f6\u5019\u4f7f\u7528-volatile"},"\u4ec0\u4e48\u65f6\u5019\u4f7f\u7528 volatile"),(0,r.kt)("p",null,"\u5bf9\u4e8e Java \u65e9\u671f\u7248\u672c\uff0c\u7f16\u5199\u4e00\u4e2a\u8bc1\u660e\u9700\u8981 ",(0,r.kt)("strong",{parentName:"p"},"volatile")," \u7684\u793a\u4f8b\u5e76\u4e0d\u96be\u3002\u5982\u679c\u4f60\u8fdb\u884c\u641c\u7d22\uff0c\u4f60\u53ef\u4ee5\u627e\u5230\u8fd9\u6837\u7684\u4f8b\u5b50\uff0c\u4f46\u662f\u5982\u679c\u4f60\u5728 Java 8 \u4e2d\u5c1d\u8bd5\u8fd9\u4e9b\u4f8b\u5b50\uff0c\u5b83\u4eec\u5c31\u4e0d\u8d77\u4f5c\u7528\u4e86(\u6211\u6ca1\u6709\u627e\u5230\u4efb\u4f55\u4e00\u4e2a)\u3002\u6211\u52aa\u529b\u5199\u8fd9\u6837\u4e00\u4e2a\u4f8b\u5b50\uff0c\u4f46\u6ca1\u4ec0\u4e48\u7528\u3002\u8fd9\u53ef\u80fd\u539f\u56e0\u662f JVM \u6216\u8005\u786c\u4ef6\uff0c\u6216\u4e24\u8005\u90fd\u5f97\u5230\u4e86\u6539\u8fdb\u3002\u8fd9\u79cd\u6548\u679c\u5bf9\u73b0\u6709\u7684\u5e94\u8be5  ",(0,r.kt)("strong",{parentName:"p"},"volatile")," \uff08\u6613\u53d8\u6027\uff09 \u4f46\u4e0d ",(0,r.kt)("strong",{parentName:"p"},"volatile")," \u7684\u5b58\u50a8\u7684\u7a0b\u5e8f\u662f\u6709\u76ca\u7684\uff1b\u5bf9\u4e8e\u6b64\u7c7b\u7a0b\u5e8f\uff0c\u5931\u8bef\u53d1\u751f\u7684\u9891\u7387\u8981\u4f4e\u5f97\u591a\uff0c\u800c\u4e14\u95ee\u9898\u66f4\u96be\u8ffd\u8e2a\u3002"),(0,r.kt)("p",null,"\u5982\u679c\u4f60\u5c1d\u8bd5\u4f7f\u7528 ",(0,r.kt)("strong",{parentName:"p"},"volatile")," \uff0c\u4f60\u53ef\u80fd\u66f4\u5e94\u8be5\u5c1d\u8bd5\u8ba9\u4e00\u4e2a\u53d8\u91cf\u7ebf\u7a0b\u5b89\u5168\u800c\u4e0d\u662f\u5f15\u8d77\u540c\u6b65\u7684\u6210\u672c\u3002\u56e0\u4e3a ",(0,r.kt)("strong",{parentName:"p"},"volatile")," \u4f7f\u7528\u8d77\u6765\u975e\u5e38\u5fae\u5999\u548c\u68d8\u624b\uff0c\u6240\u4ee5\u6211\u5efa\u8bae\u6839\u672c\u4e0d\u8981\u4f7f\u7528\u5b83;\u76f8\u53cd\uff0c\u8bf7\u4f7f\u7528\u672c\u9644\u5f55\u540e\u9762\u4ecb\u7ecd\u7684 ",(0,r.kt)("strong",{parentName:"p"},"java.util.concurrent.atomic")," \u91cc\u9762\u7c7b\u4e4b\u4e00\u3002\u5b83\u4eec\u4ee5\u6bd4\u540c\u6b65\u4f4e\u5f97\u591a\u7684\u6210\u672c\u63d0\u4f9b\u4e86\u5b8c\u5168\u7684\u7ebf\u7a0b\u5b89\u5168\u6027\u3002"),(0,r.kt)("p",null,"\u5982\u679c\u4f60\u6b63\u5728\u5c1d\u8bd5\u8c03\u8bd5\u5176\u4ed6\u4eba\u7684\u5e76\u53d1\u4ee3\u7801\uff0c\u8bf7\u9996\u5148\u67e5\u627e\u4f7f\u7528 ",(0,r.kt)("strong",{parentName:"p"},"volatile")," \u7684\u4ee3\u7801\u5e76\u5c06\u5176\u66ff\u6362\u4e3a",(0,r.kt)("strong",{parentName:"p"},"Atomic")," \u53d8\u91cf\u3002\u9664\u975e\u4f60\u786e\u5b9a\u7a0b\u5e8f\u5458\u5bf9\u5e76\u53d1\u6027\u6709\u5f88\u9ad8\u7684\u7406\u89e3\uff0c\u5426\u5219\u5b83\u4eec\u5f88\u53ef\u80fd\u4f1a\u8bef\u7528 ",(0,r.kt)("strong",{parentName:"p"},"volatile")," \u3002"),(0,r.kt)("h2",{id:"\u539f\u5b50\u6027"},"\u539f\u5b50\u6027"),(0,r.kt)("p",null,"\u5728 Java \u7ebf\u7a0b\u7684\u8ba8\u8bba\u4e2d\uff0c\u7ecf\u5e38\u53cd\u590d\u63d0\u4ea4\u4f46\u4e0d\u6b63\u786e\u7684\u77e5\u8bc6\u662f\uff1a\u201c\u539f\u5b50\u64cd\u4f5c\u4e0d\u9700\u8981\u540c\u6b65\u201d\u3002 \u4e00\u4e2a ",(0,r.kt)("em",{parentName:"p"},"\u539f\u5b50\u64cd\u4f5c")," \u662f\u4e0d\u80fd\u88ab\u7ebf\u7a0b\u8c03\u5ea6\u673a\u5236\u4e2d\u65ad\u7684\u64cd\u4f5c\uff1b\u4e00\u65e6\u64cd\u4f5c\u5f00\u59cb\uff0c\u90a3\u4e48\u5b83\u4e00\u5b9a\u53ef\u4ee5\u5728\u53ef\u80fd\u53d1\u751f\u7684\u201c\u4e0a\u4e0b\u6587\u5207\u6362\u201d\u4e4b\u524d\uff08\u5207\u6362\u5230\u5176\u4ed6\u7ebf\u7a0b\u6267\u884c\uff09\u6267\u884c\u5b8c\u6bd5\u3002\u4f9d\u8d56\u4e8e\u539f\u5b50\u6027\u662f\u5f88\u68d8\u624b\u4e14\u5f88\u5371\u9669\u7684\uff0c\u5982\u679c\u4f60\u662f\u4e00\u4e2a\u5e76\u53d1\u7f16\u7a0b\u4e13\u5bb6\uff0c\u6216\u8005\u4f60\u5f97\u5230\u4e86\u6765\u81ea\u8fd9\u6837\u7684\u4e13\u5bb6\u7684\u5e2e\u52a9\uff0c\u4f60\u624d\u5e94\u8be5\u4f7f\u7528\u539f\u5b50\u6027\u6765\u4ee3\u66ff\u540c\u6b65\uff0c\u5982\u679c\u4f60\u8ba4\u4e3a\u81ea\u5df1\u8db3\u591f\u806a\u660e\u53ef\u4ee5\u5e94\u4ed8\u8fd9\u79cd\u73a9\u706b\u4f3c\u7684\u60c5\u51b5\uff0c\u90a3\u4e48\u8bf7\u63a5\u53d7\u4e0b\u9762\u7684\u6d4b\u8bd5\uff1a"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Goetz \u6d4b\u8bd5\uff1a\u5982\u679c\u4f60\u53ef\u4ee5\u7f16\u5199\u7528\u4e8e\u73b0\u4ee3\u5fae\u5904\u7406\u5668\u7684\u9ad8\u6027\u80fd JVM \uff0c\u90a3\u4e48\u5c31\u6709\u8d44\u683c\u8003\u8651\u662f\u5426\u53ef\u4ee5\u907f\u514d\u540c\u6b65",(0,r.kt)("sup",{parentName:"p",id:"fnref-4"},(0,r.kt)("a",{parentName:"sup",href:"#fn-4",className:"footnote-ref"},"4"))," \u3002")),(0,r.kt)("p",null,"\u4e86\u89e3\u539f\u5b50\u6027\u662f\u5f88\u6709\u7528\u7684\uff0c\u5e76\u4e14\u77e5\u9053\u5b83\u4e0e\u5176\u4ed6\u9ad8\u7ea7\u6280\u672f\u4e00\u8d77\u7528\u4e8e\u5b9e\u73b0\u4e00\u4e9b\u66f4\u52a0\u5de7\u5999\u7684  ",(0,r.kt)("strong",{parentName:"p"},"java.util.concurrent")," \u5e93\u7ec4\u4ef6\u3002 \u4f46\u662f\u8981\u575a\u51b3\u62b5\u5236\u81ea\u5df1\u4f9d\u8d56\u5b83\u7684\u51b2\u52a8\u3002"),(0,r.kt)("p",null,"\u539f\u5b50\u6027\u53ef\u4ee5\u5e94\u7528\u4e8e\u9664 ",(0,r.kt)("strong",{parentName:"p"},"long")," \u548c ",(0,r.kt)("strong",{parentName:"p"},"double")," \u4e4b\u5916\u7684\u6240\u6709\u57fa\u672c\u7c7b\u578b\u4e4b\u4e0a\u7684 \u201c\u7b80\u5355\u64cd\u4f5c\u201d\u3002\u5bf9\u4e8e\u8bfb\u5199\u548c\u5199\u5165\u9664 ",(0,r.kt)("strong",{parentName:"p"},"long")," \u548c ",(0,r.kt)("strong",{parentName:"p"},"double")," \u4e4b\u5916\u7684\u57fa\u672c\u7c7b\u578b\u53d8\u91cf\u8fd9\u6837\u7684\u64cd\u4f5c\uff0c\u53ef\u4ee5\u4fdd\u8bc1\u5b83\u4eec\u4f5c\u4e3a\u4e0d\u53ef\u5206 (\u539f\u5b50) \u7684\u64cd\u4f5c\u6267\u884c\u3002"),(0,r.kt)("p",null,"\u56e0\u4e3a\u539f\u5b50\u64cd\u4f5c\u4e0d\u80fd\u88ab\u7ebf\u7a0b\u673a\u5236\u4e2d\u65ad\u3002\u4e13\u5bb6\u7a0b\u5e8f\u5458\u53ef\u4ee5\u5229\u7528\u8fd9\u4e2a\u6765\u7f16\u5199\u65e0\u9501\u4ee3\u7801\uff08",(0,r.kt)("em",{parentName:"p"},"lock-free code"),"\uff09\uff0c\u8fd9\u4e9b\u4ee3\u7801\u4e0d\u9700\u8981\u88ab\u540c\u6b65\u3002\u4f46\u5373\u4f7f\u8fd9\u6837\u4e5f\u8fc7\u4e8e\u7b80\u5355\u5316\u4e86\u3002\u6709\u65f6\u5019\uff0c\u751a\u81f3\u770b\u8d77\u6765\u5e94\u8be5\u662f\u5b89\u5168\u7684\u539f\u5b50\u64cd\u4f5c\uff0c\u5b9e\u9645\u4e0a\u4e5f\u53ef\u80fd\u4e0d\u5b89\u5168\u3002\u672c\u4e66\u7684\u8bfb\u8005\u901a\u5e38\u4e0d\u4f1a\u901a\u8fc7\u524d\u9762\u63d0\u5230\u7684 Goetz \u6d4b\u8bd5\uff0c\u56e0\u6b64\u4e5f\u5c31\u4e0d\u5177\u5907\u7528\u539f\u5b50\u64cd\u4f5c\u6765\u66ff\u6362\u540c\u6b65\u7684\u80fd\u529b\u3002\u5c1d\u8bd5\u7740\u79fb\u9664\u540c\u6b65\u901a\u5e38\u662f\u4e00\u79cd\u8868\u793a\u4e0d\u6210\u719f\u4f18\u5316\u7684\u4fe1\u53f7\uff0c\u5e76\u4e14\u4f1a\u7ed9\u4f60\u5e26\u6765\u5927\u91cf\u7684\u9ebb\u70e6\uff0c\u53ef\u80fd\u4e0d\u4f1a\u83b7\u5f97\u592a\u591a\u6216\u4efb\u4f55\u7684\u597d\u5904\u3002"),(0,r.kt)("p",null,"\u5728\u591a\u6838\u5904\u7406\u5668\u7cfb\u7edf\uff0c\u76f8\u5bf9\u4e8e\u5355\u6838\u5904\u7406\u5668\u800c\u8a00\uff0c\u53ef\u89c1\u6027\u95ee\u9898\u8fdc\u6bd4\u539f\u5b50\u6027\u95ee\u9898\u591a\u5f97\u591a\u3002\u4e00\u4e2a\u4efb\u52a1\u6240\u505a\u7684\u4fee\u6539\uff0c\u5373\u4f7f\u5b83\u4eec\u662f\u539f\u5b50\u6027\u7684\uff0c\u4e5f\u53ef\u80fd\u5bf9\u5176\u4ed6\u4efb\u52a1\u4e0d\u53ef\u89c1\uff08\u4f8b\u5982\uff0c\u4fee\u6539\u53ea\u662f\u6682\u65f6\u6027\u5b58\u50a8\u5728\u672c\u5730\u5904\u7406\u5668\u7f13\u5b58\u4e2d\uff09\uff0c\u56e0\u6b64\u4e0d\u540c\u7684\u4efb\u52a1\u5bf9\u5e94\u7528\u7684\u72b6\u6001\u6709\u4e0d\u540c\u7684\u89c6\u56fe\u3002\u53e6\u4e00\u65b9\u9762\uff0c\u540c\u6b65\u673a\u5236\u5f3a\u5236\u591a\u6838\u5904\u7406\u5668\u7cfb\u7edf\u4e0a\u7684\u4e00\u4e2a\u4efb\u52a1\u505a\u51fa\u7684\u4fee\u6539\u5fc5\u987b\u5728\u5e94\u7528\u7a0b\u5e8f\u4e2d\u662f\u53ef\u89c1\u7684\u3002\u5982\u679c\u6ca1\u6709\u540c\u6b65\u673a\u5236\uff0c\u90a3\u4e48\u4fee\u6539\u65f6\u53ef\u89c1\u6027\u5c06\u65e0\u6cd5\u786e\u8ba4\u3002"),(0,r.kt)("p",null,"\u4ec0\u4e48\u624d\u5c5e\u4e8e\u539f\u5b50\u64cd\u4f5c\u65f6\uff1f\u5bf9\u4e8e\u5c5e\u6027\u4e2d\u7684\u503c\u505a\u8d4b\u503c\u548c\u8fd4\u56de\u64cd\u4f5c\u901a\u5e38\u90fd\u662f\u539f\u5b50\u6027\u7684\uff0c\u4f46\u662f\u5728 C++ \u4e2d\uff0c\u751a\u81f3\u4e0b\u9762\u7684\u64cd\u4f5c\u90fd\u53ef\u80fd\u662f\u539f\u5b50\u6027\u7684\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-c++"},"i++; // Might be atomic in C++\ni += 2; // Might be atomic in C++\n")),(0,r.kt)("p",null,"\u4f46\u662f\u5728 C++ \u4e2d\uff0c\u8fd9\u53d6\u51b3\u4e8e\u7f16\u8bd1\u5668\u548c\u5904\u7406\u5668\u3002\u4f60\u65e0\u6cd5\u7f16\u5199\u51fa\u4f9d\u8d56\u4e8e\u539f\u5b50\u6027\u7684 C++ \u8de8\u5e73\u53f0\u4ee3\u7801\uff0c\u56e0\u4e3a C++ ",(0,r.kt)("sup",{parentName:"p",id:"fnref-5"},(0,r.kt)("a",{parentName:"sup",href:"#fn-5",className:"footnote-ref"},"5")),"\u6ca1\u6709\u50cf Java \u90a3\u6837\u7684\u4e00\u81f4 ",(0,r.kt)("em",{parentName:"p"},"\u5185\u5b58\u6a21\u578b")," \uff08memory model\uff09\u3002"),(0,r.kt)("p",null,"\u5728 Java \u4e2d\uff0c\u4e0a\u9762\u7684\u64cd\u4f5c\u80af\u5b9a\u4e0d\u662f\u539f\u5b50\u6027\u7684\uff0c\u6b63\u5982\u4e0b\u9762\u7684\u65b9\u6cd5\u4ea7\u751f\u7684 JVM \u6307\u4ee4\u4e2d\u53ef\u4ee5\u770b\u5230\u7684\u90a3\u6837\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'// lowlevel/NotAtomic.java\n// {javap -c NotAtomic}\n// {VisuallyInspectOutput}\n\npublic class NotAtomic {\n  int i;\n  void f1() { i++; }\n  void f2() { i += 3; }\n}\n/* Output:\nCompiled from "NotAtomic.java"\npublic class NotAtomic {\n  int i;\n\n  public NotAtomic();\n    Code:\n       0: aload_0\n       1: invokespecial #1 // Method\njava/lang/Object."<init>":()V\n       4: return\n\n  void f1();\n    Code:\n       0: aload_0\n       1: dup\n       2: getfield      #2 // Field\ni:I\n       5: iconst_1\n       6: iadd\n       7: putfield      #2 // Field\ni:I\n      10: return\n\n  void f2();\n    Code:\n       0: aload_0\n       1: dup\n       2: getfield      #2 // Field\ni:I\n       5: iconst_3\n       6: iadd\n       7: putfield      #2 // Field\ni:I\n      10: return\n}\n*/\n')),(0,r.kt)("p",null,"\u6bcf\u6761\u6307\u4ee4\u90fd\u4f1a\u4ea7\u751f\u4e00\u4e2a \u201cget\u201d \u548c \u201cput\u201d\uff0c\u5b83\u4eec\u4e4b\u95f4\u8fd8\u6709\u4e00\u4e9b\u5176\u4ed6\u6307\u4ee4\u3002\u56e0\u6b64\u5728\u83b7\u53d6\u6307\u4ee4\u548c\u653e\u7f6e\u6307\u4ee4\u4e4b\u95f4\uff0c\u53e6\u6709\u4e00\u4e2a\u4efb\u52a1\u53ef\u80fd\u4f1a\u4fee\u6539\u8fd9\u4e2a\u5c5e\u6027\uff0c\u6240\u6709\uff0c\u8fd9\u4e9b\u64cd\u4f5c\u4e0d\u662f\u539f\u5b50\u6027\u7684\u3002"),(0,r.kt)("p",null,"\u8ba9\u6211\u4eec\u901a\u8fc7\u5b9a\u4e49\u4e00\u4e2a\u62bd\u8c61\u7c7b\u6765\u6d4b\u8bd5\u539f\u5b50\u6027\u7684\u6982\u5ff5\uff0c\u8fd9\u4e2a\u62bd\u8c61\u7c7b\u7684\u65b9\u6cd5\u662f\u5c06\u4e00\u4e2a\u6574\u6570\u7c7b\u578b\u8fdb\u884c\u5076\u6570\u81ea\u589e\uff0c\u5e76\u4e14 ",(0,r.kt)("inlineCode",{parentName:"p"},"run()")," \u4e0d\u65ad\u5730\u8c03\u7528\u8fd9\u4e2a\u65b9\u6cd5:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"// lowlevel/IntTestable.java\nimport java.util.function.*;\n\npublic abstract class\nIntTestable implements Runnable, IntSupplier {\n  abstract void evenIncrement();\n  @Override\n  public void run() {\n    while(true)\n      evenIncrement();\n  }\n}\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"IntSupplier")," \u662f\u4e00\u4e2a\u5e26 ",(0,r.kt)("inlineCode",{parentName:"p"},"getAsInt()")," \u65b9\u6cd5\u7684\u51fd\u6570\u5f0f\u63a5\u53e3\u3002"),(0,r.kt)("p",null,"\u73b0\u5728\u6211\u4eec\u53ef\u4ee5\u521b\u5efa\u4e00\u4e2a\u6d4b\u8bd5\uff0c\u5b83\u4f5c\u4e3a\u4e00\u4e2a\u72ec\u7acb\u7684\u4efb\u52a1\u542f\u52a8 ",(0,r.kt)("inlineCode",{parentName:"p"},"run()")," \u65b9\u6cd5 \uff0c\u7136\u540e\u83b7\u53d6\u503c\u6765\u68c0\u67e5\u5b83\u4eec\u662f\u5426\u4e3a\u5076\u6570:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'// lowlevel/Atomicity.java\nimport java.util.concurrent.*;\nimport onjava.TimedAbort;\n\npublic class Atomicity {\n  public static void test(IntTestable it) {\n    new TimedAbort(4, "No failures found");\n    CompletableFuture.runAsync(it);\n    while(true) {\n      int val = it.getAsInt();\n      if(val % 2 != 0) {\n        System.out.println("failed with: " + val);\n        System.exit(0);\n      }\n    }\n  }\n}\n')),(0,r.kt)("p",null,"\u5f88\u5bb9\u6613\u76f2\u76ee\u5730\u5e94\u7528\u539f\u5b50\u6027\u7684\u6982\u5ff5\u3002\u5728\u8fd9\u91cc\uff0c",(0,r.kt)("inlineCode",{parentName:"p"},"getAsInt()")," \u4f3c\u4e4e\u662f\u5b89\u5168\u7684\u539f\u5b50\u6027\u65b9\u6cd5\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"// lowlevel/UnsafeReturn.java\nimport java.util.function.*;\nimport java.util.concurrent.*;\n\npublic class UnsafeReturn extends IntTestable {\n  private int i = 0;\n  public int getAsInt() { return i; }\n  public synchronized void evenIncrement() {\n    i++; i++;\n  }\n  public static void main(String[] args) {\n    Atomicity.test(new UnsafeReturn());\n  }\n}\n/* Output:\nfailed with: 79\n*/\n")),(0,r.kt)("p",null,"\u4f46\u662f\uff0c ",(0,r.kt)("inlineCode",{parentName:"p"},"Atomicity.test()")," \u65b9\u6cd5\u8fd8\u662f\u51fa\u73b0\u6709\u975e\u5076\u6570\u7684\u5931\u8d25\u3002\u5c3d\u7ba1\uff0c\u8fd4\u56de ",(0,r.kt)("strong",{parentName:"p"},"i")," \u53d8\u91cf\u786e\u5b9e\u662f\u539f\u5b50\u64cd\u4f5c\uff0c\u4f46\u662f\u540c\u6b65\u7f3a\u5931\u5141\u8bb8\u4e86\u5728\u5bf9\u8c61\u5904\u4e8e\u4e0d\u7a33\u5b9a\u7684\u4e2d\u95f4\u72b6\u6001\u65f6\u8bfb\u53d6\u503c\u3002\u6700\u91cd\u8981\u7684\u662f\uff0c\u7531\u4e8e ",(0,r.kt)("strong",{parentName:"p"},"i")," \u4e5f\u4e0d\u662f ",(0,r.kt)("strong",{parentName:"p"},"volatile")," \u53d8\u91cf\uff0c\u6240\u4ee5\u5b58\u5728\u53ef\u89c1\u6027\u95ee\u9898\u3002\u5305\u62ec ",(0,r.kt)("inlineCode",{parentName:"p"},"getValue()")," \u548c ",(0,r.kt)("inlineCode",{parentName:"p"},"evenIncrement()")," \u90fd\u5fc5\u987b\u540c\u6b65(\u8fd9\u4e5f\u987e\u53ca\u5230\u6ca1\u6709\u4f7f\u7528 ",(0,r.kt)("strong",{parentName:"p"},"volatile")," \u4fee\u9970\u7684 ",(0,r.kt)("strong",{parentName:"p"},"i")," \u53d8\u91cf):"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"// lowlevel/SafeReturn.java\nimport java.util.function.*;\nimport java.util.concurrent.*;\n\npublic class SafeReturn extends IntTestable {\n  private int i = 0;\n  public synchronized int getAsInt() { return i; }\n  public synchronized void evenIncrement() {\n    i++; i++;\n  }\n  public static void main(String[] args) {\n    Atomicity.test(new SafeReturn());\n  }\n}\n/* Output:\nNo failures found\n*/\n")),(0,r.kt)("p",null,"\u53ea\u6709\u5e76\u53d1\u7f16\u7a0b\u4e13\u5bb6\u6709\u80fd\u529b\u53bb\u5c1d\u8bd5\u505a\u50cf\u524d\u9762\u4f8b\u5b50\u60c5\u51b5\u7684\u4f18\u5316\uff1b\u518d\u6b21\u5f3a\u8c03\uff0c\u8bf7\u9075\u5faa Brain \u7684\u540c\u6b65\u6cd5\u5219\u3002"),(0,r.kt)("h3",{id:"josh-\u7684\u5e8f\u5217\u53f7"},"Josh \u7684\u5e8f\u5217\u53f7"),(0,r.kt)("p",null,"\u4f5c\u4e3a\u7b2c\u4e8c\u4e2a\u793a\u4f8b\uff0c\u8003\u8651\u67d0\u4e9b\u66f4\u7b80\u5355\u7684\u4e1c\u897f\uff1a\u521b\u5efa\u4e00\u4e2a\u4ea7\u751f\u5e8f\u5217\u53f7\u7684\u7c7b\uff0c\u7075\u611f\u542f\u53d1\u4e8e Joshua Bloch \u7684 ",(0,r.kt)("em",{parentName:"p"},"Effective Java Programming Language Guide")," (Addison-Wesley \u51fa\u7248\u793e, 2001) \u7b2c 190 \u9875\u3002\u6bcf\u6b21\u8c03\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"nextSerialNumber()")," \u90fd\u5fc5\u987b\u8fd4\u56de\u552f\u4e00\u503c\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"// lowlevel/SerialNumbers.java\n\npublic class SerialNumbers {\n  private volatile int serialNumber = 0;\n  public int nextSerialNumber() {\n    return serialNumber++; // Not thread-safe\n  }\n}\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"SerialNumbers"),"  \u662f\u4f60\u53ef\u4ee5\u60f3\u8c61\u5230\u6700\u7b80\u5355\u7684\u7c7b\uff0c\u5982\u679c\u4f60\u5177\u5907 C++ \u6216\u8005\u5176\u4ed6\u5e95\u5c42\u7684\u77e5\u8bc6\u80cc\u666f\uff0c\u4f60\u53ef\u80fd\u4f1a\u8ba4\u4e3a\u81ea\u589e\u662f\u4e00\u4e2a\u539f\u5b50\u64cd\u4f5c\uff0c\u56e0\u4e3a C++ \u7684\u81ea\u589e\u64cd\u4f5c\u901a\u5e38\u88ab\u5355\u4e2a\u5fae\u5904\u7406\u5668\u6307\u4ee4\u6240\u5b9e\u73b0\uff08\u5c3d\u7ba1\u4e0d\u662f\u4ee5\u4efb\u4f55\u4e00\u81f4\uff0c\u53ef\u9760\uff0c\u8de8\u5e73\u53f0\u7684\u65b9\u5f0f\uff09\u3002\u4f46\u662f\uff0c\u6b63\u5982\u524d\u9762\u6240\u63d0\u5230\u7684\uff0cJava \u81ea\u589e\u64cd\u4f5c\u4e0d\u662f\u539f\u5b50\u6027\u7684\uff0c\u5e76\u4e14\u64cd\u4f5c\u540c\u65f6\u6d89\u53ca\u8bfb\u53d6\u548c\u5199\u5165\uff0c\u56e0\u6b64\u5373\u4f7f\u5728\u8fd9\u6837\u4e00\u4e2a\u7b80\u5355\u7684\u64cd\u4f5c\u4e2d\uff0c\u4e5f\u5b58\u5728\u6709\u7ebf\u7a0b\u95ee\u9898\u7684\u7a7a\u95f4\u3002"),(0,r.kt)("p",null,"\u6211\u4eec\u5728\u8fd9\u91cc\u52a0\u5165 volatile \uff0c\u770b\u770b\u5b83\u662f\u5426\u6709\u5e2e\u52a9\u3002\u7136\u800c\uff0c\u771f\u6b63\u7684\u95ee\u9898\u662f ",(0,r.kt)("inlineCode",{parentName:"p"},"nextSerialNumber()")," \u65b9\u6cd5\u5728\u4e0d\u8fdb\u884c\u7ebf\u7a0b\u540c\u6b65\u7684\u60c5\u51b5\u4e0b\u8bbf\u95ee\u5171\u4eab\u7684\u53ef\u53d8\u53d8\u91cf\u503c\u3002"),(0,r.kt)("p",null,"\u4e3a\u4e86\u6d4b\u8bd5 ",(0,r.kt)("strong",{parentName:"p"},"SerialNumbers"),"\uff0c\u6211\u4eec\u5c06\u521b\u5efa\u4e00\u4e2a\u4e0d\u4f1a\u8017\u5c3d\u5185\u5b58\u7684\u96c6\u5408\uff0c\u5047\u5982\u9700\u8981\u5f88\u957f\u65f6\u95f4\u6765\u68c0\u6d4b\u95ee\u9898\u3002\u8fd9\u91cc\u5c55\u793a\u7684 ",(0,r.kt)("strong",{parentName:"p"},"CircularSet")," \u91cd\u7528\u4e86\u5b58\u50a8 ",(0,r.kt)("strong",{parentName:"p"},"int")," \u53d8\u91cf\u7684\u5185\u5b58\uff0c\u6700\u7ec8\u65b0\u503c\u4f1a\u8986\u76d6\u65e7\u503c(\u590d\u5236\u7684\u901f\u5ea6\u901a\u5e38\u53d1\u751f\u8db3\u591f\u5feb\uff0c\u4f60\u4e5f\u53ef\u4ee5\u4f7f\u7528  ",(0,r.kt)("strong",{parentName:"p"},"java.util.Set")," \u6765\u4ee3\u66ff):"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"// lowlevel/CircularSet.java\n// Reuses storage so we don't run out of memory\nimport java.util.*;\n\npublic class CircularSet {\n  private int[] array;\n  private int size;\n  private int index = 0;\n  public CircularSet(int size) {\n    this.size = size;\n    array = new int[size];\n    // Initialize to a value not produced\n    // by SerialNumbers:\n    Arrays.fill(array, -1);\n  }\n  public synchronized void add(int i) {\n    array[index] = i;\n    // Wrap index and write over old elements:\n    index = ++index % size;\n  }\n  public synchronized boolean contains(int val) {\n    for(int i = 0; i < size; i++)\n      if(array[i] == val) return true;\n    return false;\n  }\n}\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"add()")," \u548c ",(0,r.kt)("inlineCode",{parentName:"p"},"contains()")," \u65b9\u6cd5\u662f\u7ebf\u7a0b\u540c\u6b65\u7684\uff0c\u4ee5\u9632\u6b62\u7ebf\u7a0b\u51b2\u7a81\u3002\nThe add() and contains() methods are synchronized to prevent thread collisions."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"SerialNumberChecker")," \u7c7b\u5305\u542b\u4e00\u4e2a\u5b58\u50a8\u6700\u8fd1\u5e8f\u5217\u53f7\u7684 ",(0,r.kt)("strong",{parentName:"p"},"CircularSet")," \u53d8\u91cf\uff0c\u4ee5\u53ca\u4e00\u4e2a\u586b\u5145\u6570\u503c\u7ed9 ",(0,r.kt)("strong",{parentName:"p"},"CircularSet"),"  \u548c\u786e\u4fdd\u5b83\u91cc\u9762\u7684\u5e8f\u5217\u53f7\u662f\u552f\u4e00\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"run()")," \u65b9\u6cd5\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'// lowlevel/SerialNumberChecker.java\n// Test SerialNumbers implementations for thread-safety\nimport java.util.concurrent.*;\nimport onjava.Nap;\n\npublic class SerialNumberChecker implements Runnable {\n  private CircularSet serials = new CircularSet(1000);\n  private SerialNumbers producer;\n  public SerialNumberChecker(SerialNumbers producer) {\n    this.producer = producer;\n  }\n  @Override\n  public void run() {\n    while(true) {\n      int serial = producer.nextSerialNumber();\n      if(serials.contains(serial)) {\n        System.out.println("Duplicate: " + serial);\n        System.exit(0);\n      }\n      serials.add(serial);\n    }\n  }\n  static void test(SerialNumbers producer) {\n    for(int i = 0; i < 10; i++)\n      CompletableFuture.runAsync(\n        new SerialNumberChecker(producer));\n    new Nap(4, "No duplicates detected");\n  }\n}\n')),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"test()")," \u65b9\u6cd5\u521b\u5efa\u591a\u4e2a\u4efb\u52a1\u6765\u7ade\u4e89\u5355\u72ec\u7684 ",(0,r.kt)("strong",{parentName:"p"},"SerialNumbers")," \u5bf9\u8c61\u3002\u8fd9\u65f6\u53c2\u4e8e\u7ade\u4e89\u7684\u7684 SerialNumberChecker \u4efb\u52a1\u4eec\u5c31\u4f1a\u8bd5\u56fe\u751f\u6210\u91cd\u590d\u7684\u5e8f\u5217\u53f7\uff08\u8fd9\u60c5\u51b5\u5728\u5177\u6709\u66f4\u591a\u5185\u6838\u5904\u7406\u5668\u7684\u673a\u5668\u4e0a\u53d1\u751f\u5f97\u66f4\u5feb\uff09\u3002"),(0,r.kt)("p",null,"\u5f53\u6211\u4eec\u6d4b\u8bd5\u57fa\u672c\u7684 ",(0,r.kt)("strong",{parentName:"p"},"SerialNumbers")," \u7c7b\uff0c\u5b83\u4f1a\u5931\u8d25\uff08\u4ea7\u751f\u91cd\u590d\u5e8f\u5217\u53f7\uff09\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"// lowlevel/SerialNumberTest.java\n\npublic class SerialNumberTest {\n  public static void main(String[] args) {\n    SerialNumberChecker.test(new SerialNumbers());\n  }\n}\n/* Output:\nDuplicate: 148044\n*/\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"volatile")," \u5728\u8fd9\u91cc\u6ca1\u6709\u5e2e\u52a9\u3002\u8981\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u5c06 ",(0,r.kt)("strong",{parentName:"p"},"synchronized")," \u5173\u952e\u5b57\u6dfb\u52a0\u5230 ",(0,r.kt)("inlineCode",{parentName:"p"},"nextSerialNumber()")," \u65b9\u6cd5 :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"// lowlevel/SynchronizedSerialNumbers.java\n\npublic class\nSynchronizedSerialNumbers extends SerialNumbers {\n  private int serialNumber = 0;\n  public synchronized int nextSerialNumber() {\n    return serialNumber++;\n  }\n  public static void main(String[] args) {\n    SerialNumberChecker.test(\n      new SynchronizedSerialNumbers());\n  }\n}\n/* Output:\nNo duplicates detected\n*/\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"volatile")," \u4e0d\u518d\u662f\u5fc5\u9700\u7684\uff0c\u56e0\u4e3a ",(0,r.kt)("strong",{parentName:"p"},"synchronized")," \u5173\u952e\u5b57\u4fdd\u8bc1\u4e86 volatile \uff08\u6613\u53d8\u6027\uff09 \u7684\u7279\u6027\u3002"),(0,r.kt)("p",null,"\u8bfb\u53d6\u548c\u8d4b\u503c\u539f\u8bed\u5e94\u8be5\u662f\u5b89\u5168\u7684\u539f\u5b50\u64cd\u4f5c\u3002\u7136\u540e\uff0c\u6b63\u5982\u5728 ",(0,r.kt)("strong",{parentName:"p"},"UnsafeReturn.java")," \u4e2d\u6240\u770b\u5230\uff0c\u4f7f\u7528\u539f\u5b50\u64cd\u4f5c\u8bbf\u95ee\u5904\u4e8e\u4e0d\u7a33\u5b9a\u4e2d\u95f4\u72b6\u6001\u7684\u5bf9\u8c61\u4ecd\u7136\u5f88\u5bb9\u6613\u3002\u5bf9\u8fd9\u4e2a\u95ee\u9898\u505a\u51fa\u5047\u8bbe\u65e2\u68d8\u624b\u53c8\u5371\u9669\u3002\u6700\u660e\u667a\u7684\u505a\u6cd5\u5c31\u662f\u9075\u5faa Brian \u7684\u540c\u6b65\u89c4\u5219(\u5982\u679c\u53ef\u4ee5\uff0c\u9996\u5148\u4e0d\u8981\u5171\u4eab\u53d8\u91cf)\u3002"),(0,r.kt)("h3",{id:"\u539f\u5b50\u7c7b"},"\u539f\u5b50\u7c7b"),(0,r.kt)("p",null,"Java 5 \u5f15\u5165\u4e86\u4e13\u7528\u7684\u539f\u5b50\u53d8\u91cf\u7c7b\uff0c\u4f8b\u5982 ",(0,r.kt)("strong",{parentName:"p"},"AtomicInteger"),"\u3001",(0,r.kt)("strong",{parentName:"p"},"AtomicLong"),"\u3001",(0,r.kt)("strong",{parentName:"p"},"AtomicReference")," \u7b49\u3002\u8fd9\u4e9b\u63d0\u4f9b\u4e86\u539f\u5b50\u6027\u5347\u7ea7\u3002\u8fd9\u4e9b\u5feb\u901f\u3001\u65e0\u9501\u7684\u64cd\u4f5c\uff0c\u5b83\u4eec\u662f\u5229\u7528\u4e86\u73b0\u4ee3\u5904\u7406\u5668\u4e0a\u53ef\u7528\u7684\u673a\u5668\u7ea7\u539f\u5b50\u6027\u3002"),(0,r.kt)("p",null,"\u4e0b\u9762\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 ",(0,r.kt)("strong",{parentName:"p"},"atomicinteger")," \u91cd\u5199 ",(0,r.kt)("strong",{parentName:"p"},"unsafereturn.java")," \u793a\u4f8b\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"// lowlevel/AtomicIntegerTest.java\nimport java.util.concurrent.*;\nimport java.util.concurrent.atomic.*;\nimport java.util.*;\nimport onjava.*;\n\npublic class AtomicIntegerTest extends IntTestable {\n  private AtomicInteger i = new AtomicInteger(0);\n  public int getAsInt() { return i.get(); }\n  public void evenIncrement() { i.addAndGet(2); }\n  public static void main(String[] args) {\n    Atomicity.test(new AtomicIntegerTest());\n  }\n}\n/* Output:\nNo failures found\n*/\n")),(0,r.kt)("p",null,"\u73b0\u5728\uff0c\u6211\u4eec\u901a\u8fc7\u4f7f\u7528 ",(0,r.kt)("strong",{parentName:"p"},"AtomicInteger")," \u6765\u6d88\u9664\u4e86 ",(0,r.kt)("strong",{parentName:"p"},"synchronized")," \u5173\u952e\u5b57\u3002"),(0,r.kt)("p",null,"\u4e0b\u9762\u4f7f\u7528 ",(0,r.kt)("strong",{parentName:"p"},"AtomicInteger")," \u6765\u91cd\u5199 ",(0,r.kt)("strong",{parentName:"p"},"SynchronizedEvenProducer.java")," \u793a\u4f8b\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"// lowlevel/AtomicEvenProducer.java\n// Atomic classes: occasionally useful in regular code\nimport java.util.concurrent.atomic.*;\n\npublic class AtomicEvenProducer extends IntGenerator {\n  private AtomicInteger currentEvenValue =\n    new AtomicInteger(0);\n  @Override\n  public int next() {\n    return currentEvenValue.addAndGet(2);\n  }\n  public static void main(String[] args) {\n    EvenChecker.test(new AtomicEvenProducer());\n  }\n}\n/* Output:\nNo odd numbers discovered\n*/\n")),(0,r.kt)("p",null,"\u518d\u6b21\uff0c\u4f7f\u7528 ",(0,r.kt)("strong",{parentName:"p"},"AtomicInteger")," \u6d88\u9664\u4e86\u5bf9\u6240\u6709\u5176\u4ed6\u540c\u6b65\u65b9\u5f0f\u7684\u9700\u8981\u3002"),(0,r.kt)("p",null,"\u4e0b\u9762\u662f\u4e00\u4e2a\u4f7f\u7528 ",(0,r.kt)("strong",{parentName:"p"},"AtomicInteger")," \u5b9e\u73b0 ",(0,r.kt)("strong",{parentName:"p"},"SerialNumbers")," \u7684\u4f8b\u5b50:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"// lowlevel/AtomicSerialNumbers.java\nimport java.util.concurrent.atomic.*;\n\npublic class\nAtomicSerialNumbers extends SerialNumbers {\n  private AtomicInteger serialNumber =\n    new AtomicInteger();\n  public int nextSerialNumber() {\n    return serialNumber.getAndIncrement();\n  }\n  public static void main(String[] args) {\n    SerialNumberChecker.test(\n      new AtomicSerialNumbers());\n  }\n}\n/* Output:\nNo duplicates detected\n*/\n")),(0,r.kt)("p",null,"\u8fd9\u4e9b\u90fd\u662f\u5bf9\u5355\u4e00\u5b57\u6bb5\u7684\u7b80\u5355\u793a\u4f8b\uff1b \u5f53\u4f60\u521b\u5efa\u66f4\u590d\u6742\u7684\u7c7b\u65f6\uff0c\u4f60\u5fc5\u987b\u786e\u5b9a\u54ea\u4e9b\u5b57\u6bb5\u9700\u8981\u4fdd\u62a4\uff0c\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u4f60\u53ef\u80fd\u4ecd\u7136\u6700\u540e\u5728\u65b9\u6cd5\u4e0a\u4f7f\u7528 ",(0,r.kt)("strong",{parentName:"p"},"synchronized")," \u5173\u952e\u5b57\u3002"),(0,r.kt)("h2",{id:"\u4e34\u754c\u533a"},"\u4e34\u754c\u533a"),(0,r.kt)("p",null,"\u6709\u65f6\uff0c\u4f60\u53ea\u662f\u60f3\u9632\u6b62\u591a\u7ebf\u7a0b\u8bbf\u95ee\u65b9\u6cd5\u4e2d\u7684\u90e8\u5206\u4ee3\u7801\uff0c\u800c\u4e0d\u662f\u6574\u4e2a\u65b9\u6cd5\u3002\u8981\u9694\u79bb\u7684\u4ee3\u7801\u90e8\u5206\u79f0\u4e3a\u4e34\u754c\u533a\uff0c\u5b83\u4f7f\u7528\u6211\u4eec\u7528\u4e8e\u4fdd\u62a4\u6574\u4e2a\u65b9\u6cd5\u76f8\u540c\u7684 ",(0,r.kt)("strong",{parentName:"p"},"synchronized")," \u5173\u952e\u5b57\u521b\u5efa\uff0c\u4f46\u4f7f\u7528\u4e0d\u540c\u7684\u8bed\u6cd5\u3002\u8bed\u6cd5\u5982\u4e0b\uff0c ",(0,r.kt)("strong",{parentName:"p"},"synchronized")," \u6307\u5b9a\u67d0\u4e2a\u5bf9\u8c61\u4f5c\u4e3a\u9501\u7528\u4e8e\u540c\u6b65\u63a7\u5236\u82b1\u62ec\u53f7\u5185\u7684\u4ee3\u7801\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"synchronized(syncObject) {\n  // This code can be accessed\n  // by only one task at a time\n}\n")),(0,r.kt)("p",null,"\u8fd9\u4e5f\u88ab\u79f0\u4e3a ",(0,r.kt)("em",{parentName:"p"},"\u540c\u6b65\u63a7\u5236\u5757")," \uff08synchronized block\uff09\uff1b\u5728\u8fdb\u5165\u6b64\u6bb5\u4ee3\u7801\u524d\uff0c\u5fc5\u987b\u5f97\u5230 ",(0,r.kt)("strong",{parentName:"p"},"syncObject")," \u5bf9\u8c61\u7684\u9501\u3002\u5982\u679c\u4e00\u4e9b\u5176\u4ed6\u4efb\u52a1\u5df2\u7ecf\u5f97\u5230\u8fd9\u4e2a\u9501\uff0c\u90a3\u4e48\u5c31\u5f97\u7b49\u5230\u9501\u88ab\u91ca\u653e\u4ee5\u540e\uff0c\u624d\u80fd\u8fdb\u5165\u4e34\u754c\u533a\u3002\u5f53\u53d1\u751f\u8fd9\u79cd\u60c5\u51b5\u65f6\uff0c\u5c1d\u8bd5\u83b7\u53d6\u8be5\u9501\u7684\u4efb\u52a1\u5c31\u4f1a\u6302\u8d77\u3002\u7ebf\u7a0b\u8c03\u5ea6\u4f1a\u5b9a\u671f\u56de\u6765\u5e76\u68c0\u67e5\u9501\u662f\u5426\u5df2\u7ecf\u91ca\u653e\uff1b\u5982\u679c\u91ca\u653e\u4e86\u9501\u5219\u5524\u9192\u4efb\u52a1\u3002"),(0,r.kt)("p",null,"\u4f7f\u7528\u540c\u6b65\u63a7\u5236\u5757\u800c\u4e0d\u662f\u540c\u6b65\u63a7\u5236\u6574\u4e2a\u65b9\u6cd5\u7684\u4e3b\u8981\u52a8\u673a\u662f\u6027\u80fd\uff08\u6709\u65f6\uff0c\u7b97\u6cd5\u786e\u5b9e\u806a\u660e\uff0c\u4f46\u8fd8\u662f\u8981\u7279\u522b\u8b66\u60d5\u6765\u81ea\u5e76\u53d1\u6027\u95ee\u9898\u4e0a\u7684\u806a\u660e\uff09\u3002\u4e0b\u9762\u7684\u793a\u4f8b\u6f14\u793a\u4e86\u540c\u6b65\u63a7\u5236\u4ee3\u7801\u5757\u800c\u4e0d\u662f\u6574\u4e2a\u65b9\u6cd5\u53ef\u4ee5\u4f7f\u65b9\u6cd5\u66f4\u5bb9\u6613\u88ab\u5176\u4ed6\u4efb\u52a1\u8bbf\u95ee\u3002\u8be5\u793a\u4f8b\u4f1a\u7edf\u8ba1\u6210\u529f\u8bbf\u95ee ",(0,r.kt)("inlineCode",{parentName:"p"},"method()")," \u7684\u8ba1\u6570\u5e76\u4e14\u53d1\u8d77\u4e00\u4e9b\u4efb\u52a1\u6765\u5c1d\u8bd5\u7ade\u4e89\u8c03\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"method()")," \u65b9\u6cd5\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'// lowlevel/SynchronizedComparison.java\n// speeds up access.\nimport java.util.*;\nimport java.util.stream.*;\nimport java.util.concurrent.*;\nimport java.util.concurrent.atomic.*;\nimport onjava.Nap;\n\nabstract class Guarded {\n  AtomicLong callCount = new AtomicLong();\n  public abstract void method();\n  @Override\n  public String toString() {\n    return getClass().getSimpleName() +\n      ": " + callCount.get();\n  }\n}\n\nclass SynchronizedMethod extends Guarded {\n  public synchronized void method() {\n    new Nap(0.01);\n    callCount.incrementAndGet();\n  }\n}\n\nclass CriticalSection extends Guarded {\n  public void method() {\n    new Nap(0.01);\n    synchronized(this) {\n      callCount.incrementAndGet();\n    }\n  }\n}\n\nclass Caller implements Runnable {\n  private Guarded g;\n  Caller(Guarded g) { this.g = g; }\n  private AtomicLong successfulCalls =\n    new AtomicLong();\n  private AtomicBoolean stop =\n    new AtomicBoolean(false);\n  @Override\n  public void run() {\n    new Timer().schedule(new TimerTask() {\n      public void run() { stop.set(true); }\n    }, 2500);\n    while(!stop.get()) {\n      g.method();\n      successfulCalls.getAndIncrement();\n    }\n    System.out.println(\n      "-> " + successfulCalls.get());\n  }\n}\n\npublic class SynchronizedComparison {\n  static void test(Guarded g) {\n    List<CompletableFuture<Void>> callers =\n      Stream.of(\n        new Caller(g),\n        new Caller(g),\n        new Caller(g),\n        new Caller(g))\n        .map(CompletableFuture::runAsync)\n        .collect(Collectors.toList());\n    callers.forEach(CompletableFuture::join);\n    System.out.println(g);\n  }\n  public static void main(String[] args) {\n    test(new CriticalSection());\n    test(new SynchronizedMethod());\n  }\n}\n/* Output:\n-> 243\n-> 243\n-> 243\n-> 243\nCriticalSection: 972\n-> 69\n-> 61\n-> 83\n-> 36\nSynchronizedMethod: 249\n*/\n')),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Guarded")," \u7c7b\u8d1f\u8d23\u8ddf\u8e2a ",(0,r.kt)("strong",{parentName:"p"},"callCount")," \u4e2d\u6210\u529f\u8c03\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"method()"),"  \u7684\u6b21\u6570\u3002",(0,r.kt)("strong",{parentName:"p"},"SynchronizedMethod")," \u7684\u65b9\u5f0f\u662f\u540c\u6b65\u63a7\u5236\u6574\u4e2a ",(0,r.kt)("inlineCode",{parentName:"p"},"method")," \u65b9\u6cd5\uff0c\u800c ",(0,r.kt)("strong",{parentName:"p"},"CriticalSection")," \u7684\u65b9\u5f0f\u662f\u4f7f\u7528\u540c\u6b65\u63a7\u5236\u5757\u6765\u4ec5\u540c\u6b65 ",(0,r.kt)("inlineCode",{parentName:"p"},"method")," \u65b9\u6cd5\u7684\u4e00\u90e8\u5206\u4ee3\u7801\u3002\u8fd9\u6837\uff0c\u8017\u65f6\u7684 ",(0,r.kt)("strong",{parentName:"p"},"Nap")," \u5bf9\u8c61\u53ef\u4ee5\u88ab\u6392\u9664\u5230\u540c\u6b65\u63a7\u5236\u5757\u5916\u3002\u8f93\u51fa\u4f1a\u663e\u793a ",(0,r.kt)("strong",{parentName:"p"},"CriticalSection")," \u4e2d\u53ef\u7528\u7684 ",(0,r.kt)("inlineCode",{parentName:"p"},"method()")," \u6709\u591a\u5c11\u3002"),(0,r.kt)("p",null,"\u8bf7\u8bb0\u4f4f\uff0c\u4f7f\u7528\u540c\u6b65\u63a7\u5236\u5757\u662f\u6709\u98ce\u9669\uff1b\u5b83\u8981\u6c42\u4f60\u786e\u5207\u77e5\u9053\u540c\u6b65\u63a7\u5236\u5757\u5916\u7684\u975e\u540c\u6b65\u4ee3\u7801\u662f\u5b9e\u9645\u4e0a\u8981\u7ebf\u7a0b\u5b89\u5168\u7684\u3002"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Caller")," \u662f\u5c1d\u8bd5\u5728\u7ed9\u5b9a\u7684\u65f6\u95f4\u5468\u671f\u5185\u5c3d\u53ef\u80fd\u591a\u5730\u8c03\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"method()")," \u65b9\u6cd5\uff08\u5e76\u62a5\u544a\u8c03\u7528\u6b21\u6570\uff09\u7684\u4efb\u52a1\u3002\u4e3a\u4e86\u6784\u5efa\u8fd9\u4e2a\u65f6\u95f4\u5468\u671f\uff0c\u6211\u4eec\u4f1a\u4f7f\u7528\u867d\u7136\u6709\u70b9\u8fc7\u65f6\u4f46\u4ecd\u7136\u53ef\u4ee5\u5f88\u597d\u5730\u5de5\u4f5c\u7684 ",(0,r.kt)("strong",{parentName:"p"},"java.util.Timer")," \u7c7b\u3002\u6b64\u7c7b\u63a5\u6536\u4e00\u4e2a ",(0,r.kt)("strong",{parentName:"p"},"TimerTask")," \u53c2\u6570, \u4f46\u8be5\u53c2\u6570\u5e76\u4e0d\u662f\u51fd\u6570\u5f0f\u63a5\u53e3\uff0c\u6240\u4ee5\u6211\u4eec\u4e0d\u80fd\u4f7f\u7528 ",(0,r.kt)("strong",{parentName:"p"},"lambda")," \u8868\u8fbe\u5f0f\uff0c\u5fc5\u987b\u663e\u5f0f\u521b\u5efa\u8be5\u7c7b\u5bf9\u8c61\uff08\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u4f7f\u7528\u533f\u540d\u5185\u90e8\u7c7b\uff09\u3002\u5f53\u8d85\u65f6\u7684\u65f6\u5019\uff0c\u5b9a\u65f6\u5bf9\u8c61\u5c06\u8bbe\u7f6e ",(0,r.kt)("strong",{parentName:"p"},"AtomicBoolean")," \u7c7b\u578b\u7684 ",(0,r.kt)("strong",{parentName:"p"},"stop")," \u5b57\u6bb5\u4e3a true \uff0c\u8fd9\u6837\u5faa\u73af\u5c31\u4f1a\u9000\u51fa\u3002"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"test()")," \u65b9\u6cd5\u63a5\u6536\u4e00\u4e2a ",(0,r.kt)("strong",{parentName:"p"},"Guarded")," \u7c7b\u5bf9\u8c61\u5e76\u521b\u5efa\u56db\u4e2a ",(0,r.kt)("strong",{parentName:"p"},"Caller")," \u4efb\u52a1\u3002\u6240\u6709\u8fd9\u4e9b\u4efb\u52a1\u90fd\u6dfb\u52a0\u5230\u540c\u4e00\u4e2a ",(0,r.kt)("strong",{parentName:"p"},"Guarded")," \u5bf9\u8c61\u4e0a\uff0c\u56e0\u6b64\u5b83\u4eec\u7ade\u4e89\u6765\u83b7\u53d6\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"method()")," \u65b9\u6cd5\u7684\u9501\u3002"),(0,r.kt)("p",null,"\u4f60\u901a\u5e38\u4f1a\u770b\u5230\u4ece\u4e00\u6b21\u8fd0\u884c\u5230\u4e0b\u4e00\u6b21\u8fd0\u884c\u7684\u8f93\u51fa\u53d8\u5316\u3002\u7ed3\u679c\u8868\u660e\uff0c ",(0,r.kt)("strong",{parentName:"p"},"CriticalSection")," \u65b9\u5f0f\u6bd4\u8d77 ",(0,r.kt)("strong",{parentName:"p"},"SynchronizedMethod")," \u65b9\u5f0f\u5141\u8bb8\u66f4\u591a\u5730\u8bbf\u95ee ",(0,r.kt)("inlineCode",{parentName:"p"},"method()")," \u65b9\u6cd5\u3002\u8fd9\u901a\u5e38\u662f\u4f7f\u7528 ",(0,r.kt)("strong",{parentName:"p"},"synchronized")," \u5757\u53d6\u4ee3\u540c\u6b65\u63a7\u5236\u6574\u4e2a\u65b9\u6cd5\u7684\u539f\u56e0\uff1a\u5141\u8bb8\u5176\u4ed6\u4efb\u52a1\u66f4\u591a\u8bbf\u95ee(\u53ea\u8981\u8fd9\u6837\u505a\u662f\u7ebf\u7a0b\u5b89\u5168\u7684)\u3002"),(0,r.kt)("h3",{id:"\u5728\u5176\u4ed6\u5bf9\u8c61\u4e0a\u540c\u6b65"},"\u5728\u5176\u4ed6\u5bf9\u8c61\u4e0a\u540c\u6b65"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"synchronized")," \u5757\u5fc5\u987b\u7ed9\u5b9a\u4e00\u4e2a\u5728\u5176\u4e0a\u8fdb\u884c\u540c\u6b65\u7684\u5bf9\u8c61\u3002\u5e76\u4e14\u6700\u5408\u7406\u7684\u65b9\u5f0f\u662f\uff0c\u4f7f\u7528\u5176\u65b9\u6cd5\u6b63\u5728\u88ab\u8c03\u7528\u7684\u5f53\u524d\u5bf9\u8c61\uff1a ",(0,r.kt)("strong",{parentName:"p"},"synchronized(this)"),"\uff0c\u8fd9\u6b63\u662f\u524d\u9762\u793a\u4f8b\u4e2d ",(0,r.kt)("strong",{parentName:"p"},"CriticalSection")," \u91c7\u53d6\u7684\u65b9\u5f0f\u3002\u5728\u8fd9\u79cd\u65b9\u5f0f\u4e2d\uff0c\u5f53 ",(0,r.kt)("strong",{parentName:"p"},"synchronized")," \u5757\u83b7\u5f97\u9501\u7684\u65f6\u5019\uff0c\u90a3\u4e48\u8be5\u5bf9\u8c61\u5176\u4ed6\u7684 ",(0,r.kt)("strong",{parentName:"p"},"synchronized")," \u65b9\u6cd5\u548c\u4e34\u754c\u533a\u5c31\u4e0d\u80fd\u88ab\u8c03\u7528\u4e86\u3002\u56e0\u6b64\uff0c\u5728\u8fdb\u884c\u540c\u6b65\u65f6\uff0c\u4e34\u754c\u533a\u7684\u4f5c\u7528\u662f\u51cf\u5c0f\u540c\u6b65\u7684\u8303\u56f4\u3002"),(0,r.kt)("p",null,"\u6709\u65f6\u5fc5\u987b\u5728\u53e6\u4e00\u4e2a\u5bf9\u8c61\u4e0a\u540c\u6b65\uff0c\u4f46\u662f\u5982\u679c\u4f60\u8981\u8fd9\u6837\u505a\uff0c\u5c31\u5fc5\u987b\u786e\u4fdd\u6240\u6709\u76f8\u5173\u7684\u4efb\u52a1\u90fd\u662f\u5728\u540c\u4e00\u4e2a\u4efb\u52a1\u4e0a\u540c\u6b65\u7684\u3002\u4e0b\u9762\u7684\u793a\u4f8b\u6f14\u793a\u4e86\u5f53\u5bf9\u8c61\u4e2d\u7684\u65b9\u6cd5\u5728\u4e0d\u540c\u7684\u9501\u4e0a\u540c\u6b65\u65f6\uff0c\u4e24\u4e2a\u4efb\u52a1\u53ef\u4ee5\u540c\u65f6\u8fdb\u5165\u540c\u4e00\u5bf9\u8c61\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'// lowlevel/SyncOnObject.java\n// Synchronizing on another object\nimport java.util.*;\nimport java.util.stream.*;\nimport java.util.concurrent.*;\nimport onjava.Nap;\n\nclass DualSynch {\n  ConcurrentLinkedQueue<String> trace =\n    new ConcurrentLinkedQueue<>();\n  public synchronized void f(boolean nap) {\n    for(int i = 0; i < 5; i++) {\n      trace.add(String.format("f() " + i));\n      if(nap) new Nap(0.01);\n    }\n  }\n  private Object syncObject = new Object();\n  public void g(boolean nap) {\n    synchronized(syncObject) {\n      for(int i = 0; i < 5; i++) {\n        trace.add(String.format("g() " + i));\n        if(nap) new Nap(0.01);\n      }\n    }\n  }\n}\n\npublic class SyncOnObject {\n  static void test(boolean fNap, boolean gNap) {\n    DualSynch ds = new DualSynch();\n    List<CompletableFuture<Void>> cfs =\n      Arrays.stream(new Runnable[] {\n        () -> ds.f(fNap), () -> ds.g(gNap) })\n        .map(CompletableFuture::runAsync)\n        .collect(Collectors.toList());\n    cfs.forEach(CompletableFuture::join);\n    ds.trace.forEach(System.out::println);\n  }\n  public static void main(String[] args) {\n    test(true, false);\n    System.out.println("****");\n    test(false, true);\n  }\n}\n/* Output:\nf() 0\ng() 0\ng() 1\ng() 2\ng() 3\ng() 4\nf() 1\nf() 2\nf() 3\nf() 4\n****\nf() 0\ng() 0\nf() 1\nf() 2\nf() 3\nf() 4\ng() 1\ng() 2\ng() 3\ng() 4\n*/\n')),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"DualSync.f()")," \u65b9\u6cd5\uff08\u901a\u8fc7\u540c\u6b65\u6574\u4e2a\u65b9\u6cd5\uff09\u5728 ",(0,r.kt)("strong",{parentName:"p"},"this")," \u4e0a\u540c\u6b65\uff0c\u800c ",(0,r.kt)("inlineCode",{parentName:"p"},"g()")," \u65b9\u6cd5\u6709\u4e00\u4e2a\u5728 ",(0,r.kt)("strong",{parentName:"p"},"syncObject")," \u4e0a\u540c\u6b65\u7684 ",(0,r.kt)("strong",{parentName:"p"},"synchronized")," \u5757\u3002\u56e0\u6b64\uff0c\u8fd9\u4e24\u4e2a\u540c\u6b65\u662f\u4e92\u76f8\u72ec\u7acb\u7684\u3002\u5728 ",(0,r.kt)("inlineCode",{parentName:"p"},"test()")," \u65b9\u6cd5\u4e2d\u8fd0\u884c\u7684\u4e24\u4e2a\u8c03\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"f()")," \u548c ",(0,r.kt)("inlineCode",{parentName:"p"},"g()")," \u65b9\u6cd5\u7684\u72ec\u7acb\u4efb\u52a1\u6f14\u793a\u4e86\u8fd9\u4e00\u70b9\u3002",(0,r.kt)("strong",{parentName:"p"},"fNap")," \u548c ",(0,r.kt)("strong",{parentName:"p"},"gNap")," \u6807\u5fd7\u53d8\u91cf\u5206\u522b\u6307\u793a ",(0,r.kt)("inlineCode",{parentName:"p"},"f()")," \u548c ",(0,r.kt)("inlineCode",{parentName:"p"},"g()")," \u662f\u5426\u5e94\u8be5\u5728\u5176 ",(0,r.kt)("strong",{parentName:"p"},"for")," \u5faa\u73af\u4e2d\u8c03\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"Nap()")," \u65b9\u6cd5\u3002\u4f8b\u5982\uff0c\u5f53 f() \u7ebf\u7a0b\u4f11\u7720\u65f6 \uff0c\u8be5\u7ebf\u7a0b\u7ee7\u7eed\u6301\u6709\u5b83\u7684\u9501\uff0c\u4f46\u662f\u4f60\u53ef\u4ee5\u770b\u5230\u8fd9\u5e76\u4e0d\u963b\u6b62\u8c03\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"g()")," \uff0c\u53cd\u4e4b\u4ea6\u7136\u3002"),(0,r.kt)("h3",{id:"\u4f7f\u7528\u663e\u5f0f\u9501\u5bf9\u8c61"},"\u4f7f\u7528\u663e\u5f0f\u9501\u5bf9\u8c61"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"java.util.concurrent")," \u5e93\u5305\u542b\u5728 ",(0,r.kt)("strong",{parentName:"p"},"java.util.concurrent.locks")," \u4e2d\u5b9a\u4e49\u7684\u663e\u793a\u4e92\u65a5\u9501\u673a\u5236\u3002 \u5fc5\u987b\u663e\u5f0f\u5730\u521b\u5efa\uff0c\u9501\u5b9a\u548c\u89e3\u9501 ",(0,r.kt)("strong",{parentName:"p"},"Lock")," \u5bf9\u8c61\uff0c\u56e0\u6b64\u5b83\u4ea7\u51fa\u7684\u4ee3\u7801\u6ca1\u6709\u5185\u7f6e ",(0,r.kt)("strong",{parentName:"p"},"synchronized")," \u5173\u952e\u5b57\u90a3\u4e48\u4f18\u96c5\u3002\u7136\u800c\uff0c\u5b83\u5728\u89e3\u51b3\u67d0\u4e9b\u7c7b\u578b\u7684\u95ee\u9898\u65f6\u66f4\u52a0\u7075\u6d3b\u3002\u4e0b\u9762\u662f\u4f7f\u7528\u663e\u5f0f ",(0,r.kt)("strong",{parentName:"p"},"Lock")," \u5bf9\u8c61\u91cd\u5199 ",(0,r.kt)("strong",{parentName:"p"},"SynchronizedEvenProducer.java")," \u4ee3\u7801\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"// lowlevel/MutexEvenProducer.java\n// Preventing thread collisions with mutexes\nimport java.util.concurrent.locks.*;\nimport onjava.Nap;\n\npublic class MutexEvenProducer extends IntGenerator {\n  private int currentEvenValue = 0;\n  private Lock lock = new ReentrantLock();\n  @Override\n  public int next() {\n    lock.lock();\n    try {\n      ++currentEvenValue;\n      new Nap(0.01); // Cause failure faster\n      ++currentEvenValue;\n      return currentEvenValue;\n    } finally {\n      lock.unlock();\n    }\n  }\n  public static void main(String[] args) {\n    EvenChecker.test(new MutexEvenProducer());\n  }\n}\n/*\nNo odd numbers discovered\n*/\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"MutexEvenProducer")," \u6dfb\u52a0\u4e00\u4e2a\u540d\u4e3a ",(0,r.kt)("strong",{parentName:"p"},"lock")," \u7684\u4e92\u65a5\u9501\u5e76\u5728 ",(0,r.kt)("inlineCode",{parentName:"p"},"next()")," \u4e2d\u4f7f\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"lock()")," \u548c ",(0,r.kt)("inlineCode",{parentName:"p"},"unlock()")," \u65b9\u6cd5\u521b\u5efa\u4e00\u4e2a\u4e34\u754c\u533a\u3002\u5f53\u4f60\u4f7f\u7528 ",(0,r.kt)("strong",{parentName:"p"},"Lock")," \u5bf9\u8c61\u65f6\uff0c\u4f7f\u7528\u4e0b\u9762\u663e\u793a\u7684\u4e60\u60ef\u7528\u6cd5\u5f88\u91cd\u8981\uff1a\u5728\u8c03\u7528 ",(0,r.kt)("inlineCode",{parentName:"p"},"Lock()")," \u4e4b\u540e\uff0c\u4f60\u5fc5\u987b\u653e\u7f6e ",(0,r.kt)("strong",{parentName:"p"},"try-finally")," \u8bed\u53e5\uff0c\u8be5\u8bed\u53e5\u5728 ",(0,r.kt)("strong",{parentName:"p"},"finally")," \u5b50\u53e5\u4e2d\u5e26\u6709 ",(0,r.kt)("inlineCode",{parentName:"p"},"unlock()")," \u65b9\u6cd5 - \u8fd9\u662f\u786e\u4fdd\u9501\u603b\u662f\u88ab\u91ca\u653e\u7684\u60df\u4e00\u65b9\u6cd5\u3002\u6ce8\u610f\uff0c",(0,r.kt)("strong",{parentName:"p"},"return")," \u8bed\u53e5\u5fc5\u987b\u51fa\u73b0\u5728 ",(0,r.kt)("strong",{parentName:"p"},"try")," \u5b50\u53e5\u4e2d\uff0c\u4ee5\u786e\u4fdd ",(0,r.kt)("strong",{parentName:"p"},"unlock()")," \u4e0d\u4f1a\u8fc7\u65e9\u53d1\u751f\u5e76\u5c06\u6570\u636e\u66b4\u9732\u7ed9\u7b2c\u4e8c\u4e2a\u4efb\u52a1\u3002"),(0,r.kt)("p",null,"\u5c3d\u7ba1 ",(0,r.kt)("strong",{parentName:"p"},"try-finally")," \u6bd4\u8d77\u4f7f\u7528 ",(0,r.kt)("strong",{parentName:"p"},"synchronized")," \u5173\u952e\u5b57\u9700\u8981\u7528\u5f97\u66f4\u591a\u4ee3\u7801\uff0c\u4f46\u5b83\u4e5f\u4ee3\u8868\u4e86\u663e\u5f0f\u9501\u5bf9\u8c61\u7684\u4f18\u52bf\u4e4b\u4e00\u3002\u5982\u679c\u4f7f\u7528 ",(0,r.kt)("strong",{parentName:"p"},"synchronized")," \u5173\u952e\u5b57\u5931\u8d25\uff0c\u5c31\u4f1a\u629b\u51fa\u5f02\u5e38\uff0c\u4f46\u662f\u4f60\u6ca1\u6709\u673a\u4f1a\u8fdb\u884c\u4efb\u4f55\u6e05\u7406\u4ee5\u4fdd\u6301\u7cfb\u7edf\u5904\u4e8e\u826f\u597d\u72b6\u6001\u3002\u800c\u4f7f\u7528\u663e\u5f0f\u9501\u5bf9\u8c61\uff0c\u53ef\u4ee5\u4f7f\u7528 ",(0,r.kt)("strong",{parentName:"p"},"finally")," \u5b50\u53e5\u5728\u7cfb\u7edf\u4e2d\u7ef4\u62a4\u9002\u5f53\u7684\u72b6\u6001\u3002"),(0,r.kt)("p",null,"\u4e00\u822c\u6765\u8bf4\uff0c\u5f53\u4f60\u4f7f\u7528 ",(0,r.kt)("strong",{parentName:"p"},"synchronized")," \u7684\u65f6\u5019\uff0c\u9700\u8981\u7f16\u5199\u7684\u4ee3\u7801\u66f4\u5c11\uff0c\u5e76\u4e14\u7528\u6237\u51fa\u9519\u7684\u673a\u4f1a\u4e5f\u5927\u5927\u51cf\u5c11\uff0c\u56e0\u6b64\u901a\u5e38\u53ea\u5728\u89e3\u51b3\u7279\u6b8a\u95ee\u9898\u65f6\u4f7f\u7528\u663e\u5f0f\u9501\u5bf9\u8c61\u3002\u4f8b\u5982\uff0c\u4f7f\u7528 ",(0,r.kt)("strong",{parentName:"p"},"synchronized")," \u5173\u952e\u5b57\uff0c\u4f60\u4e0d\u80fd\u5c1d\u8bd5\u83b7\u5f97\u9501\u5e76\u8ba9\u5176\u5931\u8d25\uff0c\u6216\u8005\u4f60\u5728\u4e00\u6bb5\u65f6\u95f4\u5185\u5c1d\u8bd5\u83b7\u5f97\u9501\uff0c\u7136\u540e\u653e\u5f03 - \u4e3a\u6b64\uff0c\u4f60\u5fc5\u987b\u4f7f\u7528\u8fd9\u4e2a\u5e76\u53d1\u5e93\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'// lowlevel/AttemptLocking.java\n// Locks in the concurrent library allow you\n// to give up on trying to acquire a lock\nimport java.util.concurrent.*;\nimport java.util.concurrent.locks.*;\nimport onjava.Nap;\n\npublic class AttemptLocking {\n  private ReentrantLock lock = new ReentrantLock();\n  public void untimed() {\n    boolean captured = lock.tryLock();\n    try {\n      System.out.println("tryLock(): " + captured);\n    } finally {\n      if(captured)\n        lock.unlock();\n    }\n  }\n  public void timed() {\n    boolean captured = false;\n    try {\n      captured = lock.tryLock(2, TimeUnit.SECONDS);\n    } catch(InterruptedException e) {\n      throw new RuntimeException(e);\n    }\n    try {\n      System.out.println(\n        "tryLock(2, TimeUnit.SECONDS): " + captured);\n    } finally {\n      if(captured)\n        lock.unlock();\n    }\n  }\n  public static void main(String[] args) {\n    final AttemptLocking al = new AttemptLocking();\n    al.untimed(); // True -- lock is available\n    al.timed();   // True -- lock is available\n    // Now create a second task to grab the lock:\n    CompletableFuture.runAsync( () -> {\n        al.lock.lock();\n        System.out.println("acquired");\n    });\n    new Nap(0.1);  // Give the second task a chance\n    al.untimed(); // False -- lock grabbed by task\n    al.timed();   // False -- lock grabbed by task\n  }\n}\n/* Output:\ntryLock(): true\ntryLock(2, TimeUnit.SECONDS): true\nacquired\ntryLock(): false\ntryLock(2, TimeUnit.SECONDS): false\n*/\n')),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"ReentrantLock")," \u53ef\u4ee5\u5c1d\u8bd5\u6216\u8005\u653e\u5f03\u83b7\u53d6\u9501\uff0c\u56e0\u6b64\u5982\u679c\u67d0\u4e9b\u4efb\u52a1\u5df2\u7ecf\u62e5\u6709\u9501\uff0c\u4f60\u53ef\u4ee5\u51b3\u5b9a\u653e\u5f03\u5e76\u6267\u884c\u5176\u4ed6\u64cd\u4f5c\uff0c\u800c\u4e0d\u662f\u4e00\u76f4\u7b49\u5230\u9501\u91ca\u653e\uff0c\u5c31\u50cf ",(0,r.kt)("inlineCode",{parentName:"p"},"untimed()")," \u65b9\u6cd5\u90a3\u6837\u3002\u800c\u5728 ",(0,r.kt)("inlineCode",{parentName:"p"},"timed()")," \u65b9\u6cd5\u4e2d\uff0c\u5219\u5c1d\u8bd5\u83b7\u53d6\u53ef\u80fd\u5728 2 \u79d2\u540e\u6ca1\u6210\u529f\u800c\u653e\u5f03\u7684\u9501\u3002\u5728 ",(0,r.kt)("inlineCode",{parentName:"p"},"main()")," \u65b9\u6cd5\u4e2d\uff0c\u4e00\u4e2a\u5355\u72ec\u7684\u7ebf\u7a0b\u88ab\u533f\u540d\u7c7b\u6240\u521b\u5efa\uff0c\u5e76\u4e14\u5b83\u4f1a\u83b7\u5f97\u9501\uff0c\u56e0\u6b64\u8ba9 ",(0,r.kt)("inlineCode",{parentName:"p"},"untimed()")," \u548c ",(0,r.kt)("inlineCode",{parentName:"p"},"timed() ")," \u65b9\u6cd5\u6709\u4e1c\u897f\u53ef\u4ee5\u53bb\u7ade\u4e89\u3002"),(0,r.kt)("p",null,"\u663e\u5f0f\u9501\u6bd4\u8d77\u5185\u7f6e\u540c\u6b65\u9501\u63d0\u4f9b\u66f4\u7ec6\u7c92\u5ea6\u7684\u52a0\u9501\u548c\u89e3\u9501\u63a7\u5236\u3002\u8fd9\u5bf9\u4e8e\u5b9e\u73b0\u4e13\u95e8\u7684\u540c\u6b65\u5e76\u53d1\u7ed3\u6784\uff0c\u6bd4\u5982\u7528\u4e8e\u904d\u5386\u94fe\u8868\u8282\u70b9\u7684 ",(0,r.kt)("em",{parentName:"p"},"\u4ea4\u66ff\u9501")," ( ",(0,r.kt)("em",{parentName:"p"},"hand-over-hand locking")," ) \uff0c\u4e5f\u79f0\u4e3a ",(0,r.kt)("em",{parentName:"p"},"\u9501\u8026\u5408")," \uff08 ",(0,r.kt)("em",{parentName:"p"},"lock coupling")," \uff09- \u8be5\u904d\u5386\u4ee3\u7801\u8981\u6c42\u5fc5\u987b\u5728\u5f53\u524d\u8282\u70b9\u7684\u89e3\u9501\u4e4b\u524d\u6355\u83b7\u4e0b\u4e00\u4e2a\u8282\u70b9\u7684\u9501\u3002"),(0,r.kt)("h2",{id:"\u5e93\u7ec4\u4ef6"},"\u5e93\u7ec4\u4ef6"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"java.util.concurrent")," \u5e93\u63d0\u4f9b\u5927\u91cf\u65e8\u5728\u89e3\u51b3\u5e76\u53d1\u95ee\u9898\u7684\u7c7b\uff0c\u53ef\u4ee5\u5e2e\u52a9\u4f60\u751f\u6210\u66f4\u7b80\u5355\uff0c\u66f4\u9c81\u68d2\u7684\u5e76\u53d1\u7a0b\u5e8f\u3002\u4f46\u8bf7\u6ce8\u610f\uff0c\u8fd9\u4e9b\u5de5\u5177\u662f\u6bd4\u8d77\u5e76\u884c\u6d41\u548c ",(0,r.kt)("strong",{parentName:"p"},"CompletableFuture")," \u66f4\u5e95\u5c42\u7684\u673a\u5236\u3002"),(0,r.kt)("p",null,"\u5728\u672c\u8282\u4e2d\uff0c\u6211\u4eec\u5c06\u770b\u4e00\u4e9b\u4f7f\u7528\u4e0d\u540c\u7ec4\u4ef6\u7684\u793a\u4f8b\uff0c\u7136\u540e\u8ba8\u8bba\u4e00\u4e0b ",(0,r.kt)("em",{parentName:"p"},"lock-free"),"\uff08\u65e0\u9501\uff09 \u5e93\u7ec4\u4ef6\u662f\u5982\u4f55\u5de5\u4f5c\u7684\u3002"),(0,r.kt)("h3",{id:"delayqueue"},"DelayQueue"),(0,r.kt)("p",null,"\u8fd9\u662f\u4e00\u4e2a\u65e0\u754c\u963b\u585e\u961f\u5217 \uff08 ",(0,r.kt)("strong",{parentName:"p"},"BlockingQueue")," \uff09\uff0c\u7528\u4e8e\u653e\u7f6e\u5b9e\u73b0\u4e86 ",(0,r.kt)("strong",{parentName:"p"},"Delayed")," \u63a5\u53e3\u7684\u5bf9\u8c61\uff0c\u5176\u4e2d\u7684\u5bf9\u8c61\u53ea\u80fd\u5728\u5176\u5230\u671f\u65f6\u624d\u80fd\u4ece\u961f\u5217\u4e2d\u53d6\u8d70\u3002\u8fd9\u79cd\u961f\u5217\u662f\u6709\u5e8f\u7684\uff0c\u56e0\u6b64\u961f\u9996\u5bf9\u8c61\u7684\u5ef6\u8fdf\u5230\u671f\u7684\u65f6\u95f4\u6700\u957f\u3002\u5982\u679c\u6ca1\u6709\u4efb\u4f55\u5ef6\u8fdf\u5230\u671f\uff0c\u90a3\u4e48\u5c31\u4e0d\u4f1a\u6709\u961f\u9996\u5143\u7d20\uff0c\u5e76\u4e14 ",(0,r.kt)("inlineCode",{parentName:"p"},"poll()")," \u5c06\u8fd4\u56de ",(0,r.kt)("strong",{parentName:"p"},"null"),"\uff08\u6b63\u56e0\u4e3a\u8fd9\u6837\uff0c\u4f60\u4e0d\u80fd\u5c06 ",(0,r.kt)("strong",{parentName:"p"},"null")," \u653e\u7f6e\u5230\u8fd9\u79cd\u961f\u5217\u4e2d\uff09\u3002"),(0,r.kt)("p",null,"\u4e0b\u9762\u662f\u4e00\u4e2a\u793a\u4f8b\uff0c\u5176\u4e2d\u7684 ",(0,r.kt)("strong",{parentName:"p"},"Delayed")," \u5bf9\u8c61\u81ea\u8eab\u5c31\u662f\u4efb\u52a1\uff0c\u800c ",(0,r.kt)("strong",{parentName:"p"},"DelayedTaskConsumer")," \u5c06\u6700\u201c\u7d27\u6025\u201d\u7684\u4efb\u52a1\uff08\u5230\u671f\u65f6\u95f4\u6700\u957f\u7684\u4efb\u52a1\uff09\u4ece\u961f\u5217\u4e2d\u53d6\u51fa\uff0c\u7136\u540e\u8fd0\u884c\u5b83\u3002\u6ce8\u610f\u7684\u662f\u8fd9\u6837 ",(0,r.kt)("strong",{parentName:"p"},"DelayQueue")," \u5c31\u6210\u4e3a\u4e86\u4f18\u5148\u7ea7\u961f\u5217\u7684\u4e00\u79cd\u53d8\u4f53\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'// lowlevel/DelayQueueDemo.java\nimport java.util.*;\nimport java.util.stream.*;\nimport java.util.concurrent.*;\nimport static java.util.concurrent.TimeUnit.*;\n\nclass DelayedTask implements Runnable, Delayed {\n  private static int counter = 0;\n  private final int id = counter++;\n  private final int delta;\n  private final long trigger;\n  protected static List<DelayedTask> sequence =\n    new ArrayList<>();\n  DelayedTask(int delayInMilliseconds) {\n    delta = delayInMilliseconds;\n    trigger = System.nanoTime() +\n      NANOSECONDS.convert(delta, MILLISECONDS);\n    sequence.add(this);\n  }\n  @Override\n  public long getDelay(TimeUnit unit) {\n    return unit.convert(\n      trigger - System.nanoTime(), NANOSECONDS);\n  }\n  @Override\n  public int compareTo(Delayed arg) {\n    DelayedTask that = (DelayedTask)arg;\n    if(trigger < that.trigger) return -1;\n    if(trigger > that.trigger) return 1;\n    return 0;\n  }\n  @Override\n  public void run() {\n    System.out.print(this + " ");\n  }\n  @Override\n  public String toString() {\n    return\n      String.format("[%d] Task %d", delta, id);\n  }\n  public String summary() {\n    return String.format("(%d:%d)", id, delta);\n  }\n  public static class EndTask extends DelayedTask {\n    EndTask(int delay) { super(delay); }\n    @Override\n    public void run() {\n      sequence.forEach(dt ->\n        System.out.println(dt.summary()));\n    }\n  }\n}\n\npublic class DelayQueueDemo {\n  public static void\n  main(String[] args) throws Exception {\n    DelayQueue<DelayedTask> tasks =\n      Stream.concat( // Random delays:\n        new Random(47).ints(20, 0, 4000)\n          .mapToObj(DelayedTask::new),\n        // Add the summarizing task:\n        Stream.of(new DelayedTask.EndTask(4000)))\n      .collect(Collectors\n        .toCollection(DelayQueue::new));\n    while(tasks.size() > 0)\n      tasks.take().run();\n  }\n}\n/* Output:\n[128] Task 12 [429] Task 6 [551] Task 13 [555] Task 2\n[693] Task 3 [809] Task 15 [961] Task 5 [1258] Task 1\n[1258] Task 20 [1520] Task 19 [1861] Task 4 [1998] Task\n17 [2200] Task 8 [2207] Task 10 [2288] Task 11 [2522]\nTask 9 [2589] Task 14 [2861] Task 18 [2868] Task 7\n[3278] Task 16 (0:4000)\n(1:1258)\n(2:555)\n(3:693)\n(4:1861)\n(5:961)\n(6:429)\n(7:2868)\n(8:2200)\n(9:2522)\n(10:2207)\n(11:2288)\n(12:128)\n(13:551)\n(14:2589)\n(15:809)\n(16:3278)\n(17:1998)\n(18:2861)\n(19:1520)\n(20:1258)\n*/\n')),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"DelayedTask")," \u5305\u542b\u4e00\u4e2a\u79f0\u4e3a ",(0,r.kt)("strong",{parentName:"p"},"sequence")," \u7684 ",(0,r.kt)("strong",{parentName:"p"},"List","<","DelayedTask",">")," \uff0c\u5b83\u4fdd\u5b58\u4e86\u4efb\u52a1\u88ab\u521b\u5efa\u7684\u987a\u5e8f\uff0c\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u6392\u5e8f\u662f\u6309\u7167\u5b9e\u9645\u53d1\u751f\u7684\u987a\u5e8f\u6267\u884c\u7684\u3002"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Delay")," \u63a5\u53e3\u6709\u4e00\u4e2a\u65b9\u6cd5\uff0c ",(0,r.kt)("inlineCode",{parentName:"p"},"getDelay()")," \uff0c \u8be5\u65b9\u6cd5\u7528\u6765\u544a\u77e5\u5ef6\u8fdf\u5230\u671f\u6709\u591a\u957f\u65f6\u95f4\uff0c\u6216\u8005\u5ef6\u8fdf\u5728\u591a\u957f\u65f6\u95f4\u4e4b\u524d\u5df2\u7ecf\u5230\u671f\u4e86\u3002\u8fd9\u4e2a\u65b9\u6cd5\u5f3a\u5236\u6211\u4eec\u53bb\u4f7f\u7528 ",(0,r.kt)("strong",{parentName:"p"},"TimeUnit")," \u7c7b\uff0c\u56e0\u4e3a\u8fd9\u5c31\u662f\u53c2\u6570\u7c7b\u578b\u3002\u8fd9\u4f1a\u4ea7\u751f\u4e00\u4e2a\u975e\u5e38\u65b9\u4fbf\u7684\u7c7b\uff0c\u56e0\u4e3a\u4f60\u53ef\u4ee5\u5f88\u5bb9\u6613\u5730\u8f6c\u6362\u5355\u4f4d\u800c\u65e0\u9700\u4f5c\u4efb\u4f55\u58f0\u660e\u3002\u4f8b\u5982\uff0c",(0,r.kt)("strong",{parentName:"p"},"delta")," \u7684\u503c\u662f\u4ee5\u6beb\u79d2\u4e3a\u5355\u4f4d\u5b58\u50a8\u7684\uff0c\u4f46\u662f ",(0,r.kt)("inlineCode",{parentName:"p"},"System.nanoTime()")," \u4ea7\u751f\u7684\u65f6\u95f4\u5219\u662f\u4ee5\u7eb3\u79d2\u4e3a\u5355\u4f4d\u7684\u3002\u4f60\u53ef\u4ee5\u8f6c\u6362 ",(0,r.kt)("strong",{parentName:"p"},"delta")," \u7684\u503c\uff0c\u65b9\u6cd5\u662f\u58f0\u660e\u5b83\u7684\u5355\u4f4d\u4ee5\u53ca\u4f60\u5e0c\u671b\u4ee5\u4ec0\u4e48\u5355\u4f4d\u6765\u8868\u793a\uff0c\u5c31\u50cf\u4e0b\u9762\u8fd9\u6837\uff1a"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"NANOSECONDS.convert(delta, MILLISECONDS);\n")),(0,r.kt)("p",null,"\u5728 ",(0,r.kt)("inlineCode",{parentName:"p"},"getDelay()")," \u4e2d\uff0c \u6240\u5e0c\u671b\u7684\u5355\u4f4d\u662f\u4f5c\u4e3a ",(0,r.kt)("strong",{parentName:"p"},"unit")," \u53c2\u6570\u4f20\u9012\u8fdb\u6765\u7684\uff0c\u4f60\u4f7f\u7528\u5b83\u5c06\u5f53\u524d\u65f6\u95f4\u4e0e\u89e6\u53d1\u65f6\u95f4\u4e4b\u95f4\u7684\u5dee\u8f6c\u6362\u4e3a\u8c03\u7528\u8005\u8981\u6c42\u7684\u5355\u4f4d\uff0c\u800c\u65e0\u9700\u77e5\u9053\u8fd9\u4e9b\u5355\u4f4d\u662f\u4ec0\u4e48\uff08\u8fd9\u662f",(0,r.kt)("em",{parentName:"p"},"\u7b56\u7565"),"\u8bbe\u8ba1\u6a21\u5f0f\u7684\u4e00\u4e2a\u7b80\u5355\u793a\u4f8b\uff0c\u5728\u8fd9\u79cd\u6a21\u5f0f\u4e2d\uff0c\u7b97\u6cd5\u7684\u4e00\u90e8\u5206\u662f\u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\u8fdb\u6765\u7684\uff09\u3002"),(0,r.kt)("p",null,"\u4e3a\u4e86\u6392\u5e8f\uff0c ",(0,r.kt)("strong",{parentName:"p"},"Delayed")," \u63a5\u53e3\u8fd8\u7ee7\u627f\u4e86 ",(0,r.kt)("strong",{parentName:"p"},"Comparable")," \u63a5\u53e3\uff0c\u56e0\u6b64\u5fc5\u987b\u5b9e\u73b0 ",(0,r.kt)("inlineCode",{parentName:"p"},"compareTo()")," , \u4f7f\u5176\u53ef\u4ee5\u4ea7\u751f\u5408\u7406\u7684\u6bd4\u8f83\u3002"),(0,r.kt)("p",null,"\u4ece\u8f93\u51fa\u4e2d\u53ef\u4ee5\u770b\u5230\uff0c\u4efb\u52a1\u521b\u5efa\u7684\u987a\u5e8f\u5bf9\u6267\u884c\u987a\u5e8f\u6ca1\u6709\u4efb\u4f55\u5f71\u54cd - \u76f8\u53cd\uff0c\u4efb\u52a1\u662f\u6309\u7167\u6240\u671f\u671b\u7684\u5ef6\u8fdf\u987a\u5e8f\u6240\u6267\u884c\u7684\u3002"),(0,r.kt)("h3",{id:"priorityblockingqueue"},"PriorityBlockingQueue"),(0,r.kt)("p",null,"\u8fd9\u662f\u4e00\u4e2a\u5f88\u57fa\u7840\u7684\u4f18\u5148\u7ea7\u961f\u5217\uff0c\u5b83\u5177\u6709\u53ef\u963b\u585e\u7684\u8bfb\u53d6\u64cd\u4f5c\u3002\u5728\u4e0b\u9762\u7684\u793a\u4f8b\u4e2d\uff0c ",(0,r.kt)("strong",{parentName:"p"},"Prioritized")," \u5bf9\u8c61\u4f1a\u88ab\u8d4b\u4e88\u4f18\u5148\u7ea7\u7f16\u53f7\u3002\u51e0\u4e2a ",(0,r.kt)("strong",{parentName:"p"},"Producer")," \u4efb\u52a1\u7684\u5b9e\u4f8b\u4f1a\u63d2\u5165 ",(0,r.kt)("strong",{parentName:"p"},"Prioritized")," \u5bf9\u8c61\u5230 ",(0,r.kt)("strong",{parentName:"p"},"PriorityBlockingQueue")," \u4e2d\uff0c\u4f46\u63d2\u5165\u4e4b\u95f4\u4f1a\u6709\u968f\u673a\u5ef6\u65f6\u3002\u7136\u540e\uff0c\u5355\u4e2a ",(0,r.kt)("strong",{parentName:"p"},"Consumer")," \u4efb\u52a1\u5728\u6267\u884c ",(0,r.kt)("inlineCode",{parentName:"p"},"take()")," \u65f6\u4f1a\u663e\u793a\u591a\u4e2a\u9009\u9879\uff0c",(0,r.kt)("strong",{parentName:"p"},"PriorityBlockingQueue")," \u4f1a\u5c06\u5f53\u524d\u5177\u6709\u6700\u9ad8\u4f18\u5148\u7ea7\u7684 ",(0,r.kt)("strong",{parentName:"p"},"Prioritized")," \u5bf9\u8c61\u63d0\u4f9b\u7ed9\u5b83\u3002"),(0,r.kt)("p",null,"\u5728 ",(0,r.kt)("strong",{parentName:"p"},"Prioritized")," \u4e2d\u7684\u9759\u6001\u53d8\u91cf ",(0,r.kt)("strong",{parentName:"p"},"counter")," \u662f ",(0,r.kt)("strong",{parentName:"p"},"AtomicInteger")," \u7c7b\u578b\u3002\u8fd9\u662f\u5fc5\u8981\u7684\uff0c\u56e0\u4e3a\u6709\u591a\u4e2a ",(0,r.kt)("strong",{parentName:"p"},"Producer")," \u5e76\u884c\u8fd0\u884c\uff1b\u5982\u679c\u4e0d\u662f ",(0,r.kt)("strong",{parentName:"p"},"AtomicInteger")," \u7c7b\u578b\uff0c\u4f60\u5c06\u4f1a\u770b\u5230\u91cd\u590d\u7684 ",(0,r.kt)("strong",{parentName:"p"},"id")," \u53f7\u3002 \u8fd9\u4e2a\u95ee\u9898\u5728 ",(0,r.kt)("a",{parentName:"p",href:"./Concurrent-Programming"},"\u5e76\u53d1\u7f16\u7a0b")," \u7684 ",(0,r.kt)("a",{parentName:"p",href:"./Concurrent-Programming"},"\u6784\u9020\u51fd\u6570\u975e\u7ebf\u7a0b\u5b89\u5168")," \u4e00\u8282\u4e2d\u8ba8\u8bba\u8fc7\u3002"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'// lowlevel/PriorityBlockingQueueDemo.java\nimport java.util.*;\nimport java.util.stream.*;\nimport java.util.concurrent.*;\nimport java.util.concurrent.atomic.*;\nimport onjava.Nap;\n\nclass Prioritized implements Comparable<Prioritized>  {\n  private static AtomicInteger counter =\n    new AtomicInteger();\n  private final int id = counter.getAndIncrement();\n  private final int priority;\n  private static List<Prioritized> sequence =\n    new CopyOnWriteArrayList<>();\n  Prioritized(int priority) {\n    this.priority = priority;\n    sequence.add(this);\n  }\n  @Override\n  public int compareTo(Prioritized arg) {\n    return priority < arg.priority ? 1 :\n      (priority > arg.priority ? -1 : 0);\n  }\n  @Override\n  public String toString() {\n    return String.format(\n      "[%d] Prioritized %d", priority, id);\n  }\n  public void displaySequence() {\n    int count = 0;\n    for(Prioritized pt : sequence) {\n      System.out.printf("(%d:%d)", pt.id, pt.priority);\n      if(++count % 5 == 0)\n        System.out.println();\n    }\n  }\n  public static class EndSentinel extends Prioritized {\n    EndSentinel() { super(-1); }\n  }\n}\n\nclass Producer implements Runnable {\n  private static AtomicInteger seed =\n    new AtomicInteger(47);\n  private SplittableRandom rand =\n    new SplittableRandom(seed.getAndAdd(10));\n  private Queue<Prioritized> queue;\n  Producer(Queue<Prioritized> q) {\n    queue = q;\n  }\n  @Override\n  public void run() {\n    rand.ints(10, 0, 20)\n      .mapToObj(Prioritized::new)\n      .peek(p -> new Nap(rand.nextDouble() / 10))\n      .forEach(p -> queue.add(p));\n    queue.add(new Prioritized.EndSentinel());\n  }\n}\n\nclass Consumer implements Runnable {\n  private PriorityBlockingQueue<Prioritized> q;\n  private SplittableRandom rand =\n    new SplittableRandom(47);\n  Consumer(PriorityBlockingQueue<Prioritized> q) {\n    this.q = q;\n  }\n  @Override\n  public void run() {\n    while(true) {\n      try {\n        Prioritized pt = q.take();\n        System.out.println(pt);\n        if(pt instanceof Prioritized.EndSentinel) {\n          pt.displaySequence();\n          break;\n        }\n        new Nap(rand.nextDouble() / 10);\n      } catch(InterruptedException e) {\n        throw new RuntimeException(e);\n      }\n    }\n  }\n}\n\npublic class PriorityBlockingQueueDemo {\n  public static void main(String[] args) {\n    PriorityBlockingQueue<Prioritized> queue =\n      new PriorityBlockingQueue<>();\n    CompletableFuture.runAsync(new Producer(queue));\n    CompletableFuture.runAsync(new Producer(queue));\n    CompletableFuture.runAsync(new Producer(queue));\n    CompletableFuture.runAsync(new Consumer(queue))\n      .join();\n  }\n}\n/* Output:\n[15] Prioritized 2\n[17] Prioritized 1\n[17] Prioritized 5\n[16] Prioritized 6\n[14] Prioritized 9\n[12] Prioritized 0\n[11] Prioritized 4\n[11] Prioritized 12\n[13] Prioritized 13\n[12] Prioritized 16\n[14] Prioritized 18\n[15] Prioritized 23\n[18] Prioritized 26\n[16] Prioritized 29\n[12] Prioritized 17\n[11] Prioritized 30\n[11] Prioritized 24\n[10] Prioritized 15\n[10] Prioritized 22\n[8] Prioritized 25\n[8] Prioritized 11\n[8] Prioritized 10\n[6] Prioritized 31\n[3] Prioritized 7\n[2] Prioritized 20\n[1] Prioritized 3\n[0] Prioritized 19\n[0] Prioritized 8\n[0] Prioritized 14\n[0] Prioritized 21\n[-1] Prioritized 28\n(0:12)(2:15)(1:17)(3:1)(4:11)\n(5:17)(6:16)(7:3)(8:0)(9:14)\n(10:8)(11:8)(12:11)(13:13)(14:0)\n(15:10)(16:12)(17:12)(18:14)(19:0)\n(20:2)(21:0)(22:10)(23:15)(24:11)\n(25:8)(26:18)(27:-1)(28:-1)(29:16)\n(30:11)(31:6)(32:-1)\n*/\n')),(0,r.kt)("p",null,"\u4e0e\u524d\u9762\u7684\u793a\u4f8b\u4e00\u6837\uff0c",(0,r.kt)("strong",{parentName:"p"},"Prioritized")," \u5bf9\u8c61\u7684\u521b\u5efa\u987a\u5e8f\u5728 ",(0,r.kt)("strong",{parentName:"p"},"sequence")," \u7684 ",(0,r.kt)("strong",{parentName:"p"},"list")," \u5bf9\u8c61\u4e0a\u6240\u8bb0\u5165\uff0c\u4ee5\u4fbf\u4e0e\u5b9e\u9645\u6267\u884c\u987a\u5e8f\u8fdb\u884c\u6bd4\u8f83\u3002 ",(0,r.kt)("strong",{parentName:"p"},"EndSentinel")," \u662f\u7528\u4e8e\u544a\u77e5 ",(0,r.kt)("strong",{parentName:"p"},"Consumer")," \u5bf9\u8c61\u5173\u95ed\u7684\u7279\u6b8a\u7c7b\u578b\u3002"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Producer")," \u4f7f\u7528 ",(0,r.kt)("strong",{parentName:"p"},"AtomicInteger")," \u53d8\u91cf\u4e3a ",(0,r.kt)("strong",{parentName:"p"},"SplittableRandom")," \u8bbe\u7f6e\u968f\u673a\u751f\u6210\u79cd\u5b50\uff0c\u4ee5\u4fbf\u4e0d\u540c\u7684 ",(0,r.kt)("strong",{parentName:"p"},"Producer")," \u751f\u6210\u4e0d\u540c\u7684\u961f\u5217\u3002 \u8fd9\u662f\u5fc5\u9700\u7684\uff0c\u56e0\u4e3a\u591a\u4e2a\u751f\u4ea7\u8005\u5e76\u884c\u521b\u5efa\uff0c\u5982\u679c\u4e0d\u662f\u8fd9\u6837\uff0c\u521b\u5efa\u8fc7\u7a0b\u5e76\u4e0d\u4f1a\u662f\u7ebf\u7a0b\u5b89\u5168\u7684\u3002"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Producer")," \u548c ",(0,r.kt)("strong",{parentName:"p"},"Consumer")," \u901a\u8fc7 ",(0,r.kt)("strong",{parentName:"p"},"PriorityBlockingQueue")," \u76f8\u4e92\u8fde\u63a5\u3002\u56e0\u4e3a\u963b\u585e\u961f\u5217\u7684\u6027\u8d28\u63d0\u4f9b\u4e86\u6240\u6709\u5fc5\u8981\u7684\u540c\u6b65\uff0c\u56e0\u4e3a\u963b\u585e\u961f\u5217\u7684\u6027\u8d28\u63d0\u4f9b\u4e86\u6240\u6709\u5fc5\u8981\u7684\u540c\u6b65\uff0c\u8bf7\u6ce8\u610f\uff0c\u663e\u5f0f\u540c\u6b65\u662f\u5e76\u4e0d\u9700\u8981\u7684 \u2014 \u4ece\u961f\u5217\u4e2d\u8bfb\u53d6\u6570\u636e\u65f6\uff0c\u4f60\u4e0d\u7528\u8003\u8651\u961f\u5217\u4e2d\u662f\u5426\u6709\u4efb\u4f55\u5143\u7d20\uff0c\u56e0\u4e3a\u961f\u5217\u5728\u6ca1\u6709\u5143\u7d20\u65f6\u5c06\u963b\u585e\u8bfb\u53d6\u3002"),(0,r.kt)("h3",{id:"\u65e0\u9501\u96c6\u5408"},"\u65e0\u9501\u96c6\u5408"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"./Collections"},"\u96c6\u5408")," \u7ae0\u8282\u5f3a\u8c03\u96c6\u5408\u662f\u57fa\u672c\u7684\u7f16\u7a0b\u5de5\u5177\uff0c\u8fd9\u4e5f\u8981\u6c42\u5305\u542b\u5e76\u53d1\u6027\u3002\u56e0\u6b64\uff0c\u65e9\u671f\u7684\u96c6\u5408\u6bd4\u5982 ",(0,r.kt)("strong",{parentName:"p"},"Vector")," \u548c ",(0,r.kt)("strong",{parentName:"p"},"Hashtable")," \u6709\u8bb8\u591a\u4f7f\u7528 ",(0,r.kt)("strong",{parentName:"p"},"synchronized")," \u673a\u5236\u7684\u65b9\u6cd5\u3002\u5f53\u8fd9\u4e9b\u96c6\u5408\u4e0d\u662f\u5728\u591a\u7ebf\u7a0b\u5e94\u7528\u4e2d\u4f7f\u7528\u65f6\uff0c\u8fd9\u5c31\u5bfc\u81f4\u4e86\u4e0d\u53ef\u63a5\u6536\u7684\u5f00\u9500\u3002\u5728 Java 1.2 \u7248\u672c\u4e2d\uff0c\u65b0\u7684\u96c6\u5408\u5e93\u662f\u975e\u540c\u6b65\u7684\uff0c\u800c\u7ed9 ",(0,r.kt)("strong",{parentName:"p"},"Collection")," \u7c7b\u8d4b\u4e88\u4e86\u5404\u79cd ",(0,r.kt)("strong",{parentName:"p"},"static")," ",(0,r.kt)("strong",{parentName:"p"},"synchronized")," \u4fee\u9970\u7684\u65b9\u6cd5\u6765\u540c\u6b65\u4e0d\u540c\u7684\u96c6\u5408\u7c7b\u578b\u3002\u867d\u7136\u8fd9\u662f\u4e00\u4e2a\u6539\u8fdb\uff0c\u56e0\u4e3a\u5b83\u8ba9\u4f60\u53ef\u4ee5\u9009\u62e9\u662f\u5426\u5bf9\u96c6\u5408\u4f7f\u7528\u540c\u6b65\uff0c\u4f46\u662f\u5f00\u9500\u4ecd\u7136\u57fa\u4e8e\u540c\u6b65\u9501\u5b9a\u3002 Java 5 \u7248\u672c\u6dfb\u52a0\u65b0\u7684\u96c6\u5408\u7c7b\u578b\uff0c\u4e13\u95e8\u7528\u4e8e\u589e\u52a0\u7ebf\u7a0b\u5b89\u5168\u6027\u80fd\uff0c\u4f7f\u7528\u5de7\u5999\u7684\u6280\u672f\u6765\u6d88\u9664\u9501\u5b9a\u3002"),(0,r.kt)("p",null,"\u65e0\u9501\u96c6\u5408\u6709\u4e00\u4e2a\u6709\u8da3\u7684\u7279\u6027\uff1a\u53ea\u8981\u8bfb\u53d6\u8005\u4ec5\u80fd\u770b\u5230\u5df2\u5b8c\u6210\u4fee\u6539\u7684\u7ed3\u679c\uff0c\u5bf9\u96c6\u5408\u7684\u4fee\u6539\u5c31\u53ef\u4ee5\u540c\u65f6\u53d1\u751f\u5728\u8bfb\u53d6\u53d1\u751f\u65f6\u3002\u8fd9\u662f\u901a\u8fc7\u4e00\u4e9b\u7b56\u7565\u5b9e\u73b0\u7684\u3002\u4e3a\u4e86\u8ba9\u4f60\u4e86\u89e3\u5b83\u4eec\u662f\u5982\u4f55\u5de5\u4f5c\u7684\uff0c\u6211\u4eec\u6765\u770b\u770b\u5176\u4e2d\u7684\u4e00\u4e9b\u3002"),(0,r.kt)("h4",{id:"\u590d\u5236\u7b56\u7565"},"\u590d\u5236\u7b56\u7565"),(0,r.kt)("p",null,"\u4f7f\u7528\u201c\u590d\u5236\u201d\u7b56\u7565\uff0c\u4fee\u6539\u662f\u5728\u6570\u636e\u7ed3\u6784\u4e00\u90e8\u5206\u7684\u5355\u72ec\u526f\u672c\uff08\u6216\u6709\u65f6\u662f\u6574\u4e2a\u6570\u636e\u7684\u526f\u672c\uff09\u4e0a\u8fdb\u884c\u7684\uff0c\u5e76\u4e14\u5728\u6574\u4e2a\u4fee\u6539\u8fc7\u7a0b\u671f\u95f4\u8fd9\u4e2a\u526f\u672c\u662f\u4e0d\u53ef\u89c1\u7684\u3002\u4ec5\u5f53\u4fee\u6539\u5b8c\u6210\u65f6\uff0c\u4fee\u6539\u540e\u7684\u7ed3\u6784\u624d\u4e0e\u201c\u4e3b\u201d\u6570\u636e\u7ed3\u6784\u5b89\u5168\u5730\u4ea4\u6362\uff0c\u7136\u540e\u8bfb\u53d6\u8005\u624d\u4f1a\u770b\u5230\u4fee\u6539\u3002"),(0,r.kt)("p",null,"\u5728 ",(0,r.kt)("strong",{parentName:"p"},"CopyOnWriteArrayList")," \uff0c\u5199\u5165\u64cd\u4f5c\u4f1a\u590d\u5236\u6574\u4e2a\u5e95\u5c42\u6570\u7ec4\u3002\u4fdd\u7559\u539f\u6765\u7684\u6570\u7ec4\uff0c\u4ee5\u4fbf\u5728\u4fee\u6539\u590d\u5236\u7684\u6570\u7ec4\u65f6\u53ef\u4ee5\u7ebf\u7a0b\u5b89\u5168\u5730\u8fdb\u884c\u8bfb\u53d6\u3002\u5f53\u4fee\u6539\u5b8c\u6210\u540e\uff0c\u539f\u5b50\u64cd\u4f5c\u4f1a\u5c06\u5176\u4ea4\u6362\u5230\u65b0\u6570\u7ec4\u4e2d\uff0c\u4ee5\u4fbf\u65b0\u7684\u8bfb\u53d6\u64cd\u4f5c\u80fd\u591f\u770b\u5230\u65b0\u6570\u7ec4\u5185\u5bb9\u3002 ",(0,r.kt)("strong",{parentName:"p"},"CopyOnWriteArrayList")," \u7684\u5176\u4e2d\u4e00\u4e2a\u597d\u5904\u662f\uff0c\u5f53\u591a\u4e2a\u8fed\u4ee3\u5668\u904d\u5386\u548c\u4fee\u6539\u5217\u8868\u65f6\uff0c\u5b83\u4e0d\u4f1a\u629b\u51fa ",(0,r.kt)("strong",{parentName:"p"},"ConcurrentModificationException")," \u5f02\u5e38\uff0c\u56e0\u6b64\u4f60\u4e0d\u7528\u5c31\u50cf\u8fc7\u53bb\u5fc5\u987b\u505a\u7684\u90a3\u6837\uff0c\u7f16\u5199\u7279\u6b8a\u7684\u4ee3\u7801\u6765\u9632\u6b62\u6b64\u7c7b\u5f02\u5e38\u3002"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"CopyOnWriteArraySet")," \u4f7f\u7528 ",(0,r.kt)("strong",{parentName:"p"},"CopyOnWriteArrayList")," \u6765\u5b9e\u73b0\u5176\u65e0\u9501\u884c\u4e3a\u3002"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"ConcurrentHashMap")," \u548c ",(0,r.kt)("strong",{parentName:"p"},"ConcurrentLinkedQueue")," \u4f7f\u7528\u7c7b\u4f3c\u7684\u6280\u672f\u6765\u5141\u8bb8\u5e76\u53d1\u8bfb\u5199\uff0c\u4f46\u662f\u53ea\u590d\u5236\u548c\u4fee\u6539\u96c6\u5408\u7684\u4e00\u90e8\u5206\uff0c\u800c\u4e0d\u662f\u6574\u4e2a\u96c6\u5408\u3002\u7136\u800c\uff0c\u8bfb\u53d6\u8005\u4ecd\u7136\u4e0d\u4f1a\u770b\u5230\u4efb\u4f55\u4e0d\u5b8c\u6574\u7684\u4fee\u6539\u3002",(0,r.kt)("strong",{parentName:"p"},"ConcurrentHashMap")," ",(0,r.kt)("strong",{parentName:"p"},"\u4e0d\u4f1a\u629b\u51faconcurrentmodificationexception")," \u5f02\u5e38\u3002"),(0,r.kt)("h4",{id:"\u6bd4\u8f83\u5e76\u4ea4\u6362-cas"},"\u6bd4\u8f83\u5e76\u4ea4\u6362 (CAS)"),(0,r.kt)("p",null,"\u5728 \u6bd4\u8f83\u5e76\u4ea4\u6362 (CAS) \u4e2d\uff0c\u4f60\u4ece\u5185\u5b58\u4e2d\u83b7\u53d6\u4e00\u4e2a\u503c\uff0c\u5e76\u5728\u8ba1\u7b97\u65b0\u503c\u65f6\u4fdd\u7559\u539f\u59cb\u503c\u3002\u7136\u540e\u4f7f\u7528 CAS \u6307\u4ee4\uff0c\u5b83\u5c06\u539f\u59cb\u503c\u4e0e\u5f53\u524d\u5185\u5b58\u4e2d\u7684\u503c\u8fdb\u884c\u6bd4\u8f83\uff0c\u5982\u679c\u8fd9\u4e24\u4e2a\u503c\u662f\u76f8\u7b49\u7684\uff0c\u5219\u5c06\u5185\u5b58\u4e2d\u7684\u65e7\u503c\u66ff\u6362\u4e3a\u8ba1\u7b97\u65b0\u503c\u7684\u7ed3\u679c\uff0c\u6240\u6709\u64cd\u4f5c\u90fd\u5728\u4e00\u4e2a\u539f\u5b50\u64cd\u4f5c\u4e2d\u5b8c\u6210\u3002\u5982\u679c\u539f\u59cb\u503c\u6bd4\u8f83\u5931\u8d25\uff0c\u5219\u4e0d\u4f1a\u8fdb\u884c\u4ea4\u6362\uff0c\u56e0\u4e3a\u8fd9\u610f\u5473\u7740\u53e6\u4e00\u4e2a\u7ebf\u7a0b\u540c\u65f6\u4fee\u6539\u4e86\u5185\u5b58\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u4f60\u7684\u4ee3\u7801\u5fc5\u987b\u518d\u6b21\u5c1d\u8bd5\uff0c\u83b7\u53d6\u4e00\u4e2a\u65b0\u7684\u539f\u59cb\u503c\u5e76\u91cd\u590d\u8be5\u64cd\u4f5c\u3002"),(0,r.kt)("p",null,"\u5982\u679c\u5185\u5b58\u4ec5\u8f7b\u91cf\u7ade\u4e89\uff0cCAS\u64cd\u4f5c\u51e0\u4e4e\u603b\u662f\u5728\u6ca1\u6709\u91cd\u590d\u5c1d\u8bd5\u7684\u60c5\u51b5\u4e0b\u5b8c\u6210\uff0c\u56e0\u6b64\u5b83\u975e\u5e38\u5feb\u3002\u76f8\u53cd\uff0c",(0,r.kt)("strong",{parentName:"p"},"synchronized")," \u64cd\u4f5c\u9700\u8981\u8003\u8651\u6bcf\u6b21\u83b7\u53d6\u548c\u91ca\u653e\u9501\u7684\u6210\u672c\uff0c\u8fd9\u8981\u6602\u8d35\u5f97\u591a\uff0c\u800c\u4e14\u6ca1\u6709\u989d\u5916\u7684\u597d\u5904\u3002\u968f\u7740\u5185\u5b58\u7ade\u4e89\u7684\u589e\u52a0\uff0c\u4f7f\u7528 CAS \u7684\u64cd\u4f5c\u4f1a\u53d8\u6162\uff0c\u56e0\u4e3a\u5b83\u5fc5\u987b\u66f4\u9891\u7e41\u5730\u91cd\u590d\u81ea\u5df1\u7684\u64cd\u4f5c\uff0c\u4f46\u8fd9\u662f\u5bf9\u66f4\u591a\u8d44\u6e90\u7ade\u4e89\u7684\u52a8\u6001\u54cd\u5e94\u3002\u8fd9\u786e\u5b9e\u662f\u4e00\u79cd\u4f18\u96c5\u7684\u65b9\u6cd5\u3002"),(0,r.kt)("p",null,"\u6700\u91cd\u8981\u7684\u662f\uff0c\u8bb8\u591a\u73b0\u4ee3\u5904\u7406\u5668\u7684\u6c47\u7f16\u8bed\u8a00\u4e2d\u90fd\u6709\u4e00\u6761 CAS \u6307\u4ee4\uff0c\u5e76\u4e14\u4e5f\u88ab JVM \u4e2d\u7684 CAS \u64cd\u4f5c(\u4f8b\u5982 ",(0,r.kt)("strong",{parentName:"p"},"Atomic")," \u7c7b\u4e2d\u7684\u64cd\u4f5c)\u6240\u4f7f\u7528\u3002CAS \u6307\u4ee4\u5728\u786c\u4ef6\u5c42\u9762\u4e2d\u662f\u539f\u5b50\u6027\u7684\uff0c\u5e76\u4e14\u4e0e\u4f60\u6240\u671f\u671b\u7684\u64cd\u4f5c\u4e00\u6837\u5feb\u3002"),(0,r.kt)("h2",{id:"\u672c\u7ae0\u5c0f\u7ed3"},"\u672c\u7ae0\u5c0f\u7ed3"),(0,r.kt)("p",null,"\u672c\u9644\u5f55\u4e3b\u8981\u662f\u4e3a\u4e86\u8ba9\u4f60\u5728\u9047\u5230\u5e95\u5c42\u5e76\u53d1\u4ee3\u7801\u65f6\u80fd\u5bf9\u6b64\u6709\u4e00\u5b9a\u7684\u4e86\u89e3\uff0c\u5c3d\u7ba1\u672c\u6587\u8fd8\u8fdc\u6ca1\u5bf9\u8fd9\u4e2a\u4e3b\u9898\u8fdb\u884c\u5168\u9762\u7684\u8ba8\u8bba\u3002\u4e3a\u6b64\uff0c\u4f60\u9700\u8981\u5148\u4ece\u9605\u8bfb\u7531 Brian Goetz, Tim Peierls, Joshua Bloch, Joseph Bowbeer, David Holmes, and Doug Lea (Addison-Wesley \u51fa\u7248\u793e, 2006)\u6240\u8457\u4f5c\u7684 ",(0,r.kt)("em",{parentName:"p"},"Java Concurrency in Practice")," \uff08\u56fd\u5185\u8bd1\u540d\uff1aJava\u5e76\u53d1\u7f16\u7a0b\u5b9e\u6218\uff09\u5f00\u59cb\u4e86\u89e3\u3002\u7406\u60f3\u60c5\u51b5\u4e0b\uff0c\u8fd9\u672c\u4e66\u4f1a\u5b8c\u5168\u5413\u8dd1\u4f60\u5728 Java \u4e2d\u5c1d\u8bd5\u53bb\u7f16\u5199\u5e95\u5c42\u5e76\u53d1\u4ee3\u7801\u3002\u5982\u679c\u6ca1\u6709\uff0c\u90a3\u4e48\u4f60\u51e0\u4e4e\u80af\u5b9a\u60a3\u4e0a\u4e86\u8fbe\u514b\u6548\u5e94(DunningKruger Effect)\uff0c\u8fd9\u662f\u4e00\u79cd\u8ba4\u77e5\u504f\u5dee\uff0c\u201c\u4f60\u77e5\u9053\u7684\u8d8a\u5c11\uff0c\u5bf9\u81ea\u5df1\u7684\u80fd\u529b\u5c31\u8d8a\u6709\u4fe1\u5fc3\u201d\u3002\u8bf7\u8bb0\u4f4f\uff0c\u5f53\u524d\u7684\u8bed\u8a00\u8bbe\u8ba1\u4eba\u5458\u4ecd\u7136\u5728\u6e05\u7406\u65e9\u671f\u8bed\u8a00\u8bbe\u8ba1\u4eba\u5458\u8fc7\u4e8e\u81ea\u4fe1\u9020\u6210\u7684\u6df7\u4e71(\u4f8b\u5982\uff0c\u67e5\u770b Thread \u7c7b\u4e2d\u6709\u591a\u5c11\u65b9\u6cd5\u88ab\u5f03\u7528\uff0c\u800c volatile \u76f4\u5230 Java 5 \u624d\u6b63\u786e\u5de5\u4f5c)\u3002"),(0,r.kt)("p",null,"\u4ee5\u4e0b\u662f\u5e76\u53d1\u7f16\u7a0b\u7684\u6b65\u9aa4:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u4e0d\u8981\u4f7f\u7528\u5b83\u3002\u60f3\u4e00\u4e9b\u5176\u4ed6\u65b9\u6cd5\u6765\u4f7f\u4f60\u5199\u7684\u7a0b\u5e8f\u53d8\u7684\u66f4\u5feb\u3002"),(0,r.kt)("li",{parentName:"ol"},"\u5982\u679c\u4f60\u5fc5\u987b\u4f7f\u7528\u5b83\uff0c\u8bf7\u4f7f\u7528\u5728 ",(0,r.kt)("a",{parentName:"li",href:"./Concurrent-Programming"},"\u5e76\u53d1\u7f16\u7a0b")," - parallel Streams and CompletableFutures \u4e2d\u5c55\u793a\u7684\u73b0\u4ee3\u9ad8\u7ea7\u5de5\u5177\u3002"),(0,r.kt)("li",{parentName:"ol"},"\u4e0d\u8981\u5728\u4efb\u52a1\u95f4\u5171\u4eab\u53d8\u91cf\uff0c\u5728\u4efb\u52a1\u4e4b\u95f4\u5fc5\u987b\u4f20\u9012\u7684\u4efb\u4f55\u4fe1\u606f\u90fd\u5e94\u8be5\u4f7f\u7528 Java.util.concurrent \u5e93\u4e2d\u7684\u5e76\u53d1\u6570\u636e\u7ed3\u6784\u3002"),(0,r.kt)("li",{parentName:"ol"},"\u5982\u679c\u5fc5\u987b\u5728\u4efb\u52a1\u4e4b\u95f4\u5171\u4eab\u53d8\u91cf\uff0c\u8bf7\u4f7f\u7528 java.util.concurrent.atomic \u91cc\u9762\u5176\u4e2d\u4e00\u79cd\u7c7b\u578b\uff0c\u6216\u5728\u4efb\u4f55\u76f4\u63a5\u6216\u95f4\u63a5\u8bbf\u95ee\u8fd9\u4e9b\u53d8\u91cf\u7684\u65b9\u6cd5\u4e0a\u5e94\u7528 synchronized\u3002 \u5f53\u4f60\u4e0d\u8fd9\u6837\u505a\u65f6\uff0c\u5f88\u5bb9\u6613\u88ab\u611a\u5f04\uff0c\u4ee5\u4e3a\u4f60\u5df2\u7ecf\u628a\u6240\u6709\u4e1c\u897f\u90fd\u5305\u62ec\u5728\u5185\u3002 \u8bf4\u771f\u7684\uff0c\u5c1d\u8bd5\u4f7f\u7528\u6b65\u9aa4 3\u3002"),(0,r.kt)("li",{parentName:"ol"},"\u5982\u679c\u6b65\u9aa4 4 \u4ea7\u751f\u7684\u7ed3\u679c\u592a\u6162\uff0c\u4f60\u53ef\u4ee5\u5c1d\u8bd5\u4f7f\u7528volatile \u6216\u5176\u4ed6\u6280\u672f\u6765\u8c03\u6574\u4ee3\u7801\uff0c\u4f46\u662f\u5982\u679c\u4f60\u6b63\u5728\u9605\u8bfb\u672c\u4e66\u5e76\u8ba4\u4e3a\u4f60\u5df2\u7ecf\u51c6\u5907\u597d\u5c1d\u8bd5\u8fd9\u4e9b\u65b9\u6cd5\uff0c\u90a3\u4e48\u4f60\u5c31\u8d85\u51fa\u4e86\u4f60\u7684\u6df1\u5ea6\u3002 \u8fd4\u56de\u6b65\u9aa4\uff031\u3002")),(0,r.kt)("p",null,"\u901a\u5e38\u53ef\u4ee5\u53ea\u4f7f\u7528 java.util.concurrent \u5e93\u7ec4\u4ef6\u6765\u7f16\u5199\u5e76\u53d1\u7a0b\u5e8f\uff0c\u5b8c\u5168\u907f\u514d\u6765\u81ea\u5e94\u7528 volatile \u548c synchronized \u7684\u6311\u6218\u3002\u6ce8\u610f\uff0c\u6211\u53ef\u4ee5\u901a\u8fc7 ",(0,r.kt)("a",{parentName:"p",href:"./Concurrent-Programming"},"\u5e76\u53d1\u7f16\u7a0b"),"  \u4e2d\u7684\u793a\u4f8b\u6765\u505a\u5230\u8fd9\u4e00\u70b9\u3002"),(0,r.kt)("div",{className:"footnotes"},(0,r.kt)("hr",{parentName:"div"}),(0,r.kt)("ol",{parentName:"div"},(0,r.kt)("li",{parentName:"ol",id:"fn-1"},"\u5728\u67d0\u4e9b\u5e73\u53f0\u4e0a\uff0c\u7279\u522b\u662f Windows \uff0c\u9ed8\u8ba4\u503c\u53ef\u80fd\u975e\u5e38\u96be\u4ee5\u67e5\u660e\u3002\u4f60\u53ef\u4ee5\u4f7f\u7528 -Xss \u6807\u5fd7\u8c03\u6574\u5806\u6808\u5927\u5c0f\u3002",(0,r.kt)("a",{parentName:"li",href:"#fnref-1",className:"footnote-backref"},"\u21a9")),(0,r.kt)("li",{parentName:"ol",id:"fn-2"},"\u5f15\u81ea Brian Goetz, Java Concurrency in Practice \u4e00\u4e66\u7684\u4f5c\u8005 , \u8be5\u4e66\u7531 Brian Goetz, Tim Peierls, Joshua Bloch, Joseph Bowbeer, David Holmes, and Doug Lea \u8054\u5408\u8457\u4f5c (Addison-Wesley \u51fa\u7248\u793e, 2006)\u3002\u21a9",(0,r.kt)("a",{parentName:"li",href:"#fnref-2",className:"footnote-backref"},"\u21a9")),(0,r.kt)("li",{parentName:"ol",id:"fn-3"},"\u8bf7\u6ce8\u610f\uff0c\u572864\u4f4d\u5904\u7406\u5668\u4e0a\u53ef\u80fd\u4e0d\u4f1a\u53d1\u751f\u8fd9\u79cd\u60c5\u51b5\uff0c\u4ece\u800c\u6d88\u9664\u4e86\u8fd9\u4e2a\u95ee\u9898\u3002",(0,r.kt)("a",{parentName:"li",href:"#fnref-3",className:"footnote-backref"},"\u21a9")),(0,r.kt)("li",{parentName:"ol",id:"fn-4"},"\u8fd9\u4e2a\u6d4b\u8bd5\u7684\u63a8\u8bba\u662f\uff0c\u201c\u5982\u679c\u67d0\u4eba\u8868\u793a\u7ebf\u7a0b\u662f\u5bb9\u6613\u5e76\u4e14\u7b80\u5355\u7684\uff0c\u8bf7\u786e\u4fdd\u8fd9\u4e2a\u4eba\u6ca1\u6709\u5bf9\u4f60\u7684\u9879\u76ee\u505a\u51fa\u91cd\u8981\u7684\u51b3\u7b56\u3002\u5982\u679c\u90a3\u4e2a\u4eba\u5df2\u7ecf\u505a\u51fa\uff0c\u90a3\u4e48\u4f60\u5c31\u5df2\u7ecf\u9677\u5165\u9ebb\u70e6\u4e4b\u4e2d\u4e86\u3002\u201d",(0,r.kt)("a",{parentName:"li",href:"#fnref-4",className:"footnote-backref"},"\u21a9")),(0,r.kt)("li",{parentName:"ol",id:"fn-5"},"\u8fd9\u5728\u5373\u5c06\u4ea7\u751f\u7684 C++ \u7684\u6807\u51c6\u4e2d\u5f97\u5230\u4e86\u8865\u6551\u3002",(0,r.kt)("a",{parentName:"li",href:"#fnref-5",className:"footnote-backref"},"\u21a9")))))}s.isMDXComponent=!0}}]);