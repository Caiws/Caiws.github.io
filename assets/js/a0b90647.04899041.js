"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[8046],{3905:(e,t,r)=>{r.d(t,{Zo:()=>c,kt:()=>h});var a=r(7294);function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){n(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},o=Object.keys(e);for(a=0;a<o.length;a++)r=o[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)r=o[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var l=a.createContext({}),u=function(e){var t=a.useContext(l),r=t;return e&&(r="function"==typeof e?e(t):i(i({},t),e)),r},c=function(e){var t=u(e.components);return a.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var r=e.components,n=e.mdxType,o=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),m=u(r),h=n,f=m["".concat(l,".").concat(h)]||m[h]||p[h]||o;return r?a.createElement(f,i(i({ref:t},c),{},{components:r})):a.createElement(f,i({ref:t},c))}));function h(e,t){var r=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var o=r.length,i=new Array(o);i[0]=m;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:n,i[1]=s;for(var u=2;u<o;u++)i[u]=r[u];return a.createElement.apply(null,i)}return a.createElement.apply(null,r)}m.displayName="MDXCreateElement"},3339:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>p,frontMatter:()=>o,metadata:()=>s,toc:()=>u});var a=r(7462),n=(r(7294),r(3905));const o={},i=void 0,s={unversionedId:"Books/EffectiveJava3/Chapter-8/Chapter-8-Item-53-Use-varargs-judiciously",id:"Books/EffectiveJava3/Chapter-8/Chapter-8-Item-53-Use-varargs-judiciously",title:"Chapter-8-Item-53-Use-varargs-judiciously",description:"Chapter 8. Methods\uff08\u65b9\u6cd5\uff09",source:"@site/docs/Books/EffectiveJava3/Chapter-8/Chapter-8-Item-53-Use-varargs-judiciously.md",sourceDirName:"Books/EffectiveJava3/Chapter-8",slug:"/Books/EffectiveJava3/Chapter-8/Chapter-8-Item-53-Use-varargs-judiciously",permalink:"/docs/Books/EffectiveJava3/Chapter-8/Chapter-8-Item-53-Use-varargs-judiciously",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Books/EffectiveJava3/Chapter-8/Chapter-8-Item-53-Use-varargs-judiciously.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Chapter-8-Item-52-Use-overloading-judiciously",permalink:"/docs/Books/EffectiveJava3/Chapter-8/Chapter-8-Item-52-Use-overloading-judiciously"},next:{title:"Chapter-8-Item-54-Return-empty-collections-or-arrays-not-nulls",permalink:"/docs/Books/EffectiveJava3/Chapter-8/Chapter-8-Item-54-Return-empty-collections-or-arrays-not-nulls"}},l={},u=[{value:"Chapter 8. Methods\uff08\u65b9\u6cd5\uff09",id:"chapter-8-methods\u65b9\u6cd5",level:2},{value:"Item 53: Use varargs judiciously\uff08\u660e\u667a\u5730\u4f7f\u7528\u53ef\u53d8\u53c2\u6570\uff09",id:"item-53-use-varargs-judiciously\u660e\u667a\u5730\u4f7f\u7528\u53ef\u53d8\u53c2\u6570",level:3}],c={toc:u};function p(e){let{components:t,...r}=e;return(0,n.kt)("wrapper",(0,a.Z)({},c,r,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h2",{id:"chapter-8-methods\u65b9\u6cd5"},"Chapter 8. Methods\uff08\u65b9\u6cd5\uff09"),(0,n.kt)("h3",{id:"item-53-use-varargs-judiciously\u660e\u667a\u5730\u4f7f\u7528\u53ef\u53d8\u53c2\u6570"},"Item 53: Use varargs judiciously\uff08\u660e\u667a\u5730\u4f7f\u7528\u53ef\u53d8\u53c2\u6570\uff09"),(0,n.kt)("p",null,"Varargs methods, formally known as variable arity methods ","[JLS, 8.4.1]",", accept zero or more arguments of a specified type. The varargs facility works by first creating an array whose size is the number of arguments passed at the call site, then putting the argument values into the array, and finally passing the array to the method."),(0,n.kt)("p",null,"\u53ef\u53d8\u53c2\u6570\u65b9\u6cd5\u7684\u6b63\u5f0f\u540d\u79f0\u662f variable arity methods ","[JLS, 8.4.1]","\uff0c\u5b83\u63a5\u53d7\u6307\u5b9a\u7c7b\u578b\u7684\u96f6\u4e2a\u6216\u591a\u4e2a\u53c2\u6570\u3002\u53ef\u53d8\u53c2\u6570\u9996\u5148\u521b\u5efa\u4e00\u4e2a\u6570\u7ec4\uff0c\u5176\u5927\u5c0f\u662f\u5728\u8c03\u7528\u70b9\u4e0a\u4f20\u9012\u7684\u53c2\u6570\u6570\u91cf\uff0c\u7136\u540e\u5c06\u53c2\u6570\u503c\u653e\u5165\u6570\u7ec4\uff0c\u6700\u540e\u5c06\u6570\u7ec4\u4f20\u9012\u7ed9\u65b9\u6cd5\u3002"),(0,n.kt)("p",null,"For example, here is a varargs method that takes a sequence of int arguments and returns their sum. As you would expect, the value of sum(1, 2, 3) is 6, and the value of sum() is 0:"),(0,n.kt)("p",null,"\u4f8b\u5982\uff0c\u8fd9\u91cc\u6709\u4e00\u4e2a\u53ef\u53d8\u53c2\u6570\u65b9\u6cd5\uff0c\u5b83\u63a5\u53d7\u4e00\u7cfb\u5217 int \u53c2\u6570\u5e76\u8fd4\u56de\u5b83\u4eec\u7684\u548c\u3002\u5982\u4f60\u6240\u6599\uff0c",(0,n.kt)("inlineCode",{parentName:"p"},"sum(1, 2, 3)")," \u7684\u503c\u4e3a 6\uff0c",(0,n.kt)("inlineCode",{parentName:"p"},"sum()")," \u7684\u503c\u4e3a 0\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre"},"// Simple use of varargs\nstatic int sum(int... args) {\n    int sum = 0;\n    for (int arg : args)\n        sum += arg;\n    return sum;\n}\n")),(0,n.kt)("p",null,"Sometimes it\u2019s appropriate to write a method that requires one or more arguments of some type, rather than zero or more. For example, suppose you want to write a function that computes the minimum of its arguments. This function is not well defined if the client passes no arguments. You could check the array length at runtime:"),(0,n.kt)("p",null,"\u6709\u65f6\uff0c\u7f16\u5199\u4e00\u4e2a\u65b9\u6cd5\u9700\u8981\u4e00\u4e2a\u6216\u591a\u4e2a\u67d0\u79cd\u7c7b\u578b\u7684\u53c2\u6570\uff0c\u800c\u4e0d\u662f\u96f6\u4e2a\u6216\u591a\u4e2a\u53c2\u6570\uff0c\u8fd9\u662f\u5408\u9002\u7684\u3002\u4f8b\u5982\uff0c\u5047\u8bbe\u4f60\u60f3\u7f16\u5199\u4e00\u4e2a\u51fd\u6570\u6765\u8ba1\u7b97\u5176\u53c2\u6570\u7684\u6700\u5c0f\u503c\u3002\u5982\u679c\u5ba2\u6237\u7aef\u4e0d\u4f20\u9012\u53c2\u6570\uff0c\u5219\u6b64\u51fd\u6570\u5b9a\u4e49\u5f97\u4e0d\u597d\u3002\u4f60\u53ef\u4ee5\u5728\u8fd0\u884c\u65f6\u68c0\u67e5\u6570\u7ec4\u957f\u5ea6\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre"},'// The WRONG way to use varargs to pass one or more arguments!\nstatic int min(int... args) {\n    if (args.length == 0)\n        throw new IllegalArgumentException("Too few arguments");\n    int min = args[0];\n    for (int i = 1; i < args.length; i++)\n        if (args[i] < min)\n    min = args[i];\n    return min;\n}\n')),(0,n.kt)("p",null,"This solution has several problems. The most serious is that if the client invokes this method with no arguments, it fails at runtime rather than compile time. Another problem is that it is ugly. You have to include an explicit validity check on args, and you can\u2019t use a for-each loop unless you initialize min to Integer.MAX_VALUE, which is also ugly."),(0,n.kt)("p",null,"\u8fd9\u4e2a\u89e3\u51b3\u65b9\u6848\u6709\u51e0\u4e2a\u95ee\u9898\u3002\u6700\u4e25\u91cd\u7684\u60c5\u51b5\u662f\uff0c\u5982\u679c\u5ba2\u6237\u7aef\u4e0d\u5e26\u53c2\u6570\u8c03\u7528\u6b64\u65b9\u6cd5\uff0c\u90a3\u4e48\u5b83\u5c06\u5728\u8fd0\u884c\u65f6\u800c\u4e0d\u662f\u7f16\u8bd1\u65f6\u5931\u8d25\u3002\u53e6\u4e00\u4e2a\u95ee\u9898\u662f\u5b83\u4e0d\u7f8e\u89c2\u3002\u5fc5\u987b\u5305\u542b\u5bf9 args \u7684\u663e\u5f0f\u6709\u6548\u6027\u68c0\u67e5\uff0c\u5e76\u4e14\u4e0d\u80fd\u4f7f\u7528 for-each \u5faa\u73af\uff0c\u9664\u975e\u5c06 min \u521d\u59cb\u5316\u4e3a Integer.MAX_VALUE\uff0c\u4e5f\u5f88\u4e0d\u7f8e\u89c2\u3002"),(0,n.kt)("p",null,"Luckily there\u2019s a much better way to achieve the desired effect. Declare the method to take two parameters, one normal parameter of the specified type and one varargs parameter of this type. This solution corrects all the deficiencies of the previous one:"),(0,n.kt)("p",null,"\u5e78\u8fd0\u7684\u662f\uff0c\u6709\u4e00\u79cd\u66f4\u597d\u7684\u65b9\u6cd5\u53ef\u4ee5\u8fbe\u5230\u9884\u671f\u7684\u6548\u679c\u3002\u58f0\u660e\u65b9\u6cd5\u83b7\u53d6\u4e24\u4e2a\u53c2\u6570\uff0c\u4e00\u4e2a\u6307\u5b9a\u7c7b\u578b\u7684\u5e38\u89c4\u53c2\u6570\u548c\u4e00\u4e2a\u8be5\u7c7b\u578b\u7684\u53ef\u53d8\u53c2\u6570\u3002\u8fd9\u4e2a\u89e3\u51b3\u65b9\u6848\u5f25\u8865\u4e86\u524d\u4e00\u4e2a\u89e3\u51b3\u65b9\u6848\u7684\u6240\u6709\u4e0d\u8db3\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre"},"// The right way to use varargs to pass one or more arguments\nstatic int min(int firstArg, int... remainingArgs) {\n    int min = firstArg;\n    for (int arg : remainingArgs)\n        if (arg < min)\n    min = arg;\n    return min;\n}\n")),(0,n.kt)("p",null,"As you can see from this example, varargs are effective in circumstances where you want a method with a variable number of arguments. Varargs were designed for printf, which was added to the platform at the same time as varargs, and for the core reflection facility (Item 65), which was retrofitted. Both printf and reflection benefited enormously from varargs."),(0,n.kt)("p",null,"\u4ece\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\u53ef\u4ee5\u770b\u51fa\uff0c\u5728\u65b9\u6cd5\u9700\u8981\u53c2\u6570\u6570\u91cf\u53ef\u53d8\u7684\u60c5\u51b5\u4e0b\uff0c\u53ef\u53d8\u53c2\u6570\u662f\u6709\u6548\u7684\u3002\u53ef\u53d8\u53c2\u6570\u662f\u4e3a printf \u548c\u7ecf\u8fc7\u6539\u9020\u7684\u6838\u5fc3\u53cd\u5c04\u673a\u5236\uff08",(0,n.kt)("a",{parentName:"p",href:"./Chapter-9-Item-65-Prefer-interfaces-to-reflection"},"Item-65"),"\uff09\u800c\u8bbe\u8ba1\u7684\uff0c\u5b83\u4eec\u4e0e\u53ef\u53d8\u53c2\u6570\u540c\u65f6\u88ab\u6dfb\u52a0\u5230 JDK\uff0cprintf \u548c reflection \u90fd\u4ece\u53ef\u53d8\u53c2\u6570\u4e2d\u53d7\u76ca\u532a\u6d45\u3002"),(0,n.kt)("p",null,"Exercise care when using varargs in performance-critical situations. Every invocation of a varargs method causes an array allocation and initialization. If you have determined empirically that you can\u2019t afford this cost but you need the flexibility of varargs, there is a pattern that lets you have your cake and eat it too. Suppose you\u2019ve determined that 95 percent of the calls to a method have three or fewer parameters. Then declare five overloadings of the method, one each with zero through three ordinary parameters, and a single varargs method for use when the number of arguments exceeds three:"),(0,n.kt)("p",null,"\u5728\u6027\u80fd\u5173\u952e\u7684\u60c5\u51b5\u4e0b\u4f7f\u7528\u53ef\u53d8\u53c2\u6570\u65f6\u8981\u5c0f\u5fc3\u3002\u6bcf\u6b21\u8c03\u7528\u53ef\u53d8\u53c2\u6570\u65b9\u6cd5\u90fd\u4f1a\u5bfc\u81f4\u6570\u7ec4\u5206\u914d\u548c\u521d\u59cb\u5316\u3002\u5982\u679c\u4f60\u5df2\u7ecf\u4ece\u7ecf\u9a8c\u4e0a\u786e\u5b9a\u4f60\u8d1f\u62c5\u4e0d\u8d77\u8fd9\u4e2a\u6210\u672c\uff0c\u4f46\u662f\u4f60\u4ecd\u9700\u8981\u53ef\u53d8\u53c2\u6570\u7684\u7075\u6d3b\u6027\uff0c\u90a3\u4e48\u6709\u4e00\u79cd\u6a21\u5f0f\u53ef\u4ee5\u8ba9\u4f60\u9c7c\u4e0e\u718a\u638c\u517c\u5f97\u3002\u5047\u8bbe\u4f60\u5df2\u7ecf\u786e\u5b9a\u5bf9\u65b9\u6cd5 95% \u7684\u8c03\u7528\u53ea\u9700\u8981\u4e09\u4e2a\u6216\u66f4\u5c11\u7684\u53c2\u6570\u3002\u53ef\u4ee5\u58f0\u660e\u8be5\u65b9\u6cd5\u7684 5 \u4e2a\u91cd\u8f7d\uff0c\u6bcf\u4e2a\u91cd\u8f7d 0 \u5230 3 \u4e2a\u666e\u901a\u53c2\u6570\uff0c\u5f53\u53c2\u6570\u6570\u91cf\u8d85\u8fc7 3 \u4e2a\u65f6\u5f15\u5165\u53ef\u53d8\u53c2\u6570\uff1a"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre"},"public void foo() { }\npublic void foo(int a1) { }\npublic void foo(int a1, int a2) { }\npublic void foo(int a1, int a2, int a3) { }\npublic void foo(int a1, int a2, int a3, int... rest) { }\n")),(0,n.kt)("p",null,"Now you know that you\u2019ll pay the cost of the array creation only in the 5 percent of all invocations where the number of parameters exceeds three. Like most performance optimizations, this technique usually isn\u2019t appropriate, but when it is, it\u2019s a lifesaver."),(0,n.kt)("p",null,"\u73b0\u5728\u4f60\u77e5\u9053\uff0c\u5728\u6240\u6709\u53c2\u6570\u6570\u91cf\u8d85\u8fc7 3 \u7684\u8c03\u7528\u4e2d\uff0c\u53ea\u6709 5% \u7684\u8c03\u7528\u9700\u8981\u4ed8\u51fa\u521b\u5efa\u6570\u7ec4\u7684\u6210\u672c\u3002\u4e0e\u5927\u591a\u6570\u6027\u80fd\u4f18\u5316\u4e00\u6837\uff0c\u8fd9\u79cd\u6280\u672f\u4f7f\u7528\u5e76\u4e0d\u5e7f\u6cdb\uff0c\u4f46\u5f53\u5b83\u5408\u9002\u51fa\u73b0\u65f6\uff0c\u5c31\u662f\u4e00\u4e2a\u6551\u661f\u3002"),(0,n.kt)("p",null,"The static factories for EnumSet use this technique to reduce the cost of creating enum sets to a minimum. This was appropriate because it was critical that enum sets provide a performance-competitive replacement for bit fields (Item 36)."),(0,n.kt)("p",null,"EnumSet \u7684\u9759\u6001\u5de5\u5382\u4f7f\u7528\u8fd9\u79cd\u6280\u672f\u5c06\u521b\u5efa\u679a\u4e3e\u96c6\u7684\u6210\u672c\u964d\u5230\u6700\u4f4e\u3002\u8fd9\u662f\u9002\u5f53\u7684\uff0c\u56e0\u4e3a enum \u96c6\u5408\u4e3a\u4f4d\u5b57\u6bb5\u63d0\u4f9b\u5177\u6709\u6027\u80fd\u7ade\u4e89\u529b\u7684\u66ff\u4ee3\u65b9\u6cd5\u662f\u81f3\u5173\u91cd\u8981\u7684\uff08",(0,n.kt)("a",{parentName:"p",href:"./Chapter-6-Item-36-Use-EnumSet-instead-of-bit-fields"},"Item-36"),"\uff09\u3002"),(0,n.kt)("p",null,"In summary, varargs are invaluable when you need to define methods with a variable number of arguments. Precede the varargs parameter with any required parameters, and be aware of the performance consequences of using varargs."),(0,n.kt)("p",null,"\u603b\u4e4b\uff0c\u5f53\u4f60\u9700\u8981\u5b9a\u4e49\u5177\u6709\u4e0d\u786e\u5b9a\u6570\u91cf\u53c2\u6570\u7684\u65b9\u6cd5\u65f6\uff0c\u53ef\u53d8\u53c2\u6570\u662f\u975e\u5e38\u6709\u7528\u7684\u3002\u5728\u53ef\u53d8\u53c2\u6570\u4e4b\u524d\u52a0\u4e0a\u4efb\u4f55\u5fc5\u9700\u7684\u53c2\u6570\uff0c\u5e76\u6ce8\u610f\u4f7f\u7528\u53ef\u53d8\u53c2\u6570\u53ef\u80fd\u4f1a\u5f15\u53d1\u7684\u6027\u80fd\u540e\u679c\u3002"),(0,n.kt)("hr",null),(0,n.kt)("p",null,(0,n.kt)("strong",{parentName:"p"},(0,n.kt)("a",{parentName:"strong",href:"./Chapter-8-Introduction"},"Back to contents of the chapter\uff08\u8fd4\u56de\u7ae0\u8282\u76ee\u5f55\uff09"))),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"Previous Item\uff08\u4e0a\u4e00\u6761\u76ee\uff09\uff1a",(0,n.kt)("a",{parentName:"strong",href:"./Chapter-8-Item-52-Use-overloading-judiciously"},"Item 52: Use overloading judiciously\uff08\u660e\u667a\u5730\u4f7f\u7528\u91cd\u8f7d\uff09"))),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"Next Item\uff08\u4e0b\u4e00\u6761\u76ee\uff09\uff1a",(0,n.kt)("a",{parentName:"strong",href:"./Chapter-8-Item-54-Return-empty-collections-or-arrays-not-nulls"},"Item 54: Return empty collections or arrays not nulls")))))}p.isMDXComponent=!0}}]);